# Дневной лог разработки - 2025-12-08

## UI (оформление)

### Коммит: ba3f222 - "Adopt file prefix naming and rename scripts"
- **Что сделано**: Добавлены правила именования файлов с префиксами, зафиксировано требование поддерживать пул префиксов в `.cursorrules`/`architect.md`, переименованы существующие скрипты под новую схему и обновлён `index.html`.
- **Как сделано**:
  * Пополнены правила коммитов: фиксация имени до коммита, запись описания в дневной лог, добавление хеша после коммита.
  * В `architect.md` описан желаемый пул префиксов и расширено требование его поддерживать.
  * В `.cursorrules` добавлены шаги регламента коммитов и напоминание про префиксы.
  * Переименованы `config.js`, `cmp-*.js`, `app.js` в `cfg-app.js`, `c-ui-*.js`, `app-ui-root.js`; пути обновлены в `index.html`.
- **Функциональность**: Единое соглашение имён упрощает навигацию и будущий рост структуры; регламент коммитов и логирования зафиксирован в правилах.


### Коммит: ae87fbb - "Add lastCommitMessage display and update commit rules"
- **Что сделано**: Добавлено отображение названия последнего коммита в интерфейсе рядом с заголовком, обновлён регламент создания коммитов с выделением шага обновления `lastCommitMessage` в отдельный пункт.
- **Как сделано**:
  * Добавлена переменная `lastCommitMessage` в `core/cfg-app.js` с текущим значением.
  * В `app/app-ui-root.js` добавлено чтение `lastCommitMessage` из конфига и передача в data() приложения.
  * В `index.html` добавлено отображение `lastCommitMessage` под заголовком с иконкой ветки Font Awesome.
  * В `.cursorrules` обновлён регламент коммитов: шаг 3 — обновление `lastCommitMessage` в `core/cfg-app.js`, остальные шаги перенумерованы (4, 5).
- **Функциональность**: Пользователь видит название последнего коммита в интерфейсе; регламент коммитов требует обновлять эту переменную при каждом коммите (шаг 3).


### Коммит: Update commit rules: no immediate hash in log, no amend
- **Что сделано**: Обновлён регламент создания коммитов: запрещено сразу добавлять хеш в лог и использовать `git commit --amend` для этого, так как это создаёт замкнутый круг. Хеши обновляются при ревизии дневного лога.
- **Как сделано**:
  * В шаге 2 регламента добавлено требование указывать в логе только название коммита без хеша.
  * В шаге 5 регламента добавлен запрет на использование `git commit --amend` для добавления хеша и указано, что хеши обновляются при ревизии лога.
  * Обновлён раздел протоколирования: убрано требование всегда указывать хеш, указано, что хеш добавляется при ревизии.
  * Обновлена история изменений предпочтений с уточнением нового регламента.
- **Функциональность**: Регламент коммитов исключает проблему замкнутого круга при добавлении хешей; хеши добавляются отдельно при ревизии дневного лога, что упрощает процесс коммита.


### Коммит: Add password-protected splash screen
- **Что сделано**: Добавлен сплэш-экран с защитой паролем (временно без хеша) для защиты приложения от случайных посетителей.
- **Как сделано**:
  * Компонент `c-ui-splash.js` реализует прямую проверку пароля "2211", а также анимацию сползания и сохранение статуса в sessionStorage.
  * Сплэш-экран отображается в `index.html` поверх страницы с полем ввода и надписью "Code SMS".
  * Компонент был интегрирован в `app-ui-root.js`.
- **Функциональность**: При входе открывается сплэш-экран, ввод "2211" скрывает его, неверный код показывает ошибку. В текущей сессии повторного показа нет.

### Коммит: Ensure splash blocks external requests until unlock
- **Что сделано**: Гарантировал, что сплэш всегда отображается и что внешние запросы (например, CoinGecko) не запускаются до ввода пароля.
- **Как сделано**:
  * Компонент `c-ui-splash.js` больше не использует `sessionStorage` — сплэш всегда стартует при загрузке и отпускает приложение только после правильного кода.
  * В `c-ui-splash` устанавливается `window.appUnlocked` и отправляется событие `app-unlocked`, по которому компоненты начинают свои запросы.
  * В `c-ui-coingecko.js` добавлен слушатель `app-unlocked`, чтобы запросы к CoinGecko запускались только после разблокировки и не происходили под слоем.
  * Удалены попытки использовать sha256, весь UI доступен внутри `#app`, как прописано в правилах.
- **Функциональность**: Сплэш теперь стабильно появляется при любом перезапуске (Ctrl+F5), не пропадает сразу, и пока он отображается, никаких внешних запросов не отправляется. После ввода "2211" приложения запускаются и делают запросы.

### Коммит: f71ee90 - "Auto-focus splash input"
- **Что сделано**: Добавлен автофокус на поле ввода пароля сплэша, чтобы пользователь мог сразу начать ввод.
- **Как сделано**:
  * В `c-ui-splash.js` добавлен метод `focusInput`, который вызывается при монтировании и каждом показе сплэша.
  * Поле ввода получает `ref="passwordField"`, чтобы метод мог управлять фокусом.
- **Функциональность**: При каждом появлении сплэша курсор автоматически падает в поле пароля.

### Коммит: 64c772a - "Treat splash input as PIN"
- **Что сделано**: Парольный сплэш теперь работает как PIN-код — ввод обрабатывается моментально, символы видимы, поле остаётся пустым между запусками.
- **Как сделано**:
  * В `c-ui-splash.js` добавлен `handlePinInput`, который триггерит `checkPassword` сразу после ввода четвёртого символа.
  * Поле стало `type="text"` без placeholder и маски, чтобы вводимые цифры были видимыми и поле всегда начиналось пустым.
  * После разблокировки `window.appUnlocked` переводится в `true`, сплэш скрывается, а остальные компоненты запускают запросы через событие `app-unlocked`.
- **Функциональность**: PIN «2211» срабатывает без Enter, поле очищается/снимается ошибка при неверном вводе; пока сплэш висит, внешние запросы не выполняются.

### Коммит: 495d826 - "Show last commit name on splash"
- **Что сделано**: Перенёс отображение названия последнего пуша внутрь сплэша, прямо под полем PIN.
- **Как сделано**:
  * Убрал `lastCommitMessage` из хедера и добавил `p` с {{ lastCommitMessage }} непосредственно под вводом.
  * Текст стилизован под тёмную тему (`opacity`) и живёт внутри `#app`, как требуют правила.
  * Вывод всегда показывает актуальный `lastCommitMessage`, пока сплэш активен.
- **Функциональность**: Пользователь сразу видит название последнего коммита прямо на экране сплэша.

### Коммит: Allow direct splash password temporarily
- **Что сделано**: Упростили сплэш-экран, пока хеширование не работает с file:// — теперь пароль сравнивается напрямую.
- **Как сделано**:
  * Удалена зависимость от js-sha256 и проверка хеша, пароль сравнивается как строка (\"2211\").
  * Убрали подключение библиотеки из `index.html`, оставили чистую компоненту.
  * Обновлена история изменений, чтобы отметить, что пока пароль вводится напрямую.
- **Функциональность**: Вход работает независимо от поддержки Web Crypto API, сплэш скрывается при вводе \"2211\", сообщение об ошибке появляется только при неверном вводе.

### Коммит: Fix commit hash in history
- **Что сделано**: Исправлен хеш коммита в дневном логе с неправильного `615180b` на корректный `495d826`.
- **Как сделано**:
  * В файле `history/2025/12-08.txt` обновлена запись коммита "Show last commit name on splash" с правильным хешом.
- **Функциональность**: Дневной лог теперь содержит корректный хеш коммита для точной идентификации изменений.

### Коммит: Add mandatory checklist for commit workflow
- **Что сделано**: Усилен регламент коммитов добавлением яркого обязательного чеклиста с 4 шагами, где Шаг 3 (обновление `lastCommitMessage`) выделен как критически важный.
- **Как сделано**:
  * В `.cursorrules` заменён раздел "Шаги (обязательные)" на новый блок "⚠️ ОБЯЗАТЕЛЬНЫЙ ЧЕКЛИСТ ПЕРЕД КАЖДЫМ КОММИТОМ".
  * Шаг 3 выделен жирным текстом, символами предупреждения и множественными напоминаниями о необходимости обновлять `lastCommitMessage` в `core/cfg-app.js`.
  * Добавлены конкретные инструкции: открыть файл, найти строку, заменить значение, добавить в staging.
  * Финальное напоминание: "ЭТОТ ШАГ НЕЛЬЗЯ ПРОПУСКАТЬ!" и "без обновления lastCommitMessage коммит считается неполным".
  * Обновлена переменная `lastCommitMessage` в `core/cfg-app.js` с устаревшего значения на актуальное.
  * Добавлена запись в "Историю изменений предпочтений" о причине усиления правил.
- **Функциональность**: ИИ-агент теперь имеет визуально выделенный пошаговый чеклист, который напоминает об обязательном обновлении `lastCommitMessage` перед каждым коммитом, что гарантирует актуальность отображаемого названия коммита в сплэш-экране.

### Коммит: Add security layer with obfuscation and API key field in splash
- **Что сделано**: Добавлена архитектура безопасности с обфускацией чувствительных данных (PIN, API-ключи), поле ввода API-ключа Perplexity в сплэш-экране, система префиксов `sec-` для security-модулей, правило обратной совместимости данных.
- **Как сделано**:
  * Создана папка `core/security/` и модуль `u-sec-obfuscate.js` с методами обфускации/деобфускации через Base64 (`obfuscate`, `deobfuscate`, `saveSecure`, `loadSecure`, `removeSecure`, `hasSecure`).
  * В `architect.md` добавлен слой `core/security/`, сектор `sec-` в систему префиксов, примеры использования (`u-sec-obfuscate.js`, `cfg-sec-keys.js`).
  * В `c-ui-splash.js` добавлено поле `apiKeyPerplexity` (было `apiKey`) с методами `loadApiKey()`, `saveApiKey()`, обфускацией через `window.securityObfuscate`, PIN теперь хранится обфусцированным.
  * В `index.html` добавлено UI-поле ввода API-ключа в сплэш под полем PIN с кнопкой сохранения и индикатором успеха, подключен скрипт `u-sec-obfuscate.js`.
  * В `c-ui-perplexity-settings.js` обновлено хранение API-ключа через обфусцированное хранилище вместо прямого localStorage.
  * В `c-ui-import-export.js` обновлён формат экспорта до v2.0: чувствительные данные экспортируются обфусцированными в блок `secureData` с полями `pin` и `apiKeyPerplexity`, поддержка импорта v1.0 (legacy, открытый текст) и v2.0 (обфусцированный).
  * В `core/cfg-app.js` добавлены комментарии про обфусцированное хранение через `u-sec-obfuscate.js`.
  * В `.cursorrules` добавлено правило "⚠️ ПРАВИЛО: Обратная совместимость данных" - при изменении структуры сохраненных данных ИИ-агент должен предлагать реализацию обратной совместимости с объяснением рисков и примерами кода.
  * Создан файл `data-app.json` в формате v2.0 с обфусцированными PIN и API-ключом как пример настроек.
  * Переименовано `apiKey` → `apiKeyPerplexity` во всех компонентах для явности и готовности к расширению (другие API).
- **Функциональность**: PIN и API-ключ Perplexity хранятся обфусцированными в localStorage и JSON-экспорте (защита от простого просмотра), пользователь может настроить API-ключ прямо в сплэше при входе, экспорт/импорт настроек поддерживает версионирование (v1.0 legacy, v2.0 обфусцированный), архитектура готова к добавлению других API-ключей (CoinGecko, OpenAI и т.д.), ИИ-агент следует правилу обратной совместимости при работе с данными.

### Коммит: Refactor splash screen into Vue component with x-template
- **Что сделано**: Рефакторинг сплэш-экрана из монолитной разметки в отдельный Vue компонент с использованием x-template подхода для разделения HTML и JavaScript логики.
- **Как сделано**:
  * В `index.html` добавлен `<script type="text/x-template" id="splash-template">` с полной разметкой сплэш-экрана (48 строк), разметка удалена из `#app` и заменена на `<splash-screen :last-commit-message="lastCommitMessage"></splash-screen>`.
  * В `c-ui-splash.js` преобразован из функции, возвращающей объект с data/methods, в полноценный Vue компонент: добавлен `template: '#splash-template'`, `props: { lastCommitMessage }`, `data()` возвращает объект вместо объекта в `data`, константы (`DEFAULT_PIN`, `PIN_LENGTH`, `STORAGE_KEY_PIN`, `STORAGE_KEY_API`) перенесены в `data()` для доступа через `this`.
  * В `app-ui-root.js` удален `window.cmpSplash()` из массива `parts` (больше не мержится в главное приложение), добавлена регистрация компонента через `app.component('splash-screen', window.cmpSplash)` перед монтированием.
  * Компонент теперь полностью инкапсулирован: вся логика сплэша (PIN, API-ключ, анимация) находится внутри компонента, не влияет на остальное приложение.
- **Функциональность**: Сплэш-экран теперь является переиспользуемым Vue компонентом с четким разделением шаблона (HTML в x-template) и логики (JS в компоненте), `index.html` упрощен с 351 до ~300 строк, компонент можно легко переиспользовать в других местах приложения, улучшена читаемость и поддерживаемость кода, HTML шаблон имеет подсветку синтаксиса в IDE.

### Коммит: Unify UX into UI: remove separate UX prefix and section
- **Что сделано**: Объединение UX с UI в единую систему: удален префикс `ux-` из системы именования файлов, секция UX объединена с UI в `.cursorrules`, добавлены пояснения что UX является частью UI.
- **Как сделано**:
  * В `architect.md` удален префикс `ux-` из списка секторов, обновлено описание: `ui-` теперь включает "оформление и взаимодействие/UX", добавлено примечание что UX является неотъемлемой частью UI и веб-компоненты содержат и визуальное оформление, и логику взаимодействия одновременно, поэтому используется единый префикс `ui-` вместо искусственного разделения.
  * В `.cursorrules` объединены секции "UI (оформление)" и "UX (паттерны взаимодействий)" в единую секцию "UI (интерфейс)" с описанием "оформление, взаимодействие (UX), анимации, accessibility", обновлено правило обработки команд: команды `UI:` и `UX:` обе направляются в раздел "UI (интерфейс)", добавлены пояснения в нескольких местах что UX является частью UI, обновлены примеры команд.
  * В `c-ui-splash.js` удалены лишние пустые строки (форматирование кода).
- **Функциональность**: Упрощена система именования файлов - не нужно выбирать между `ui-` и `ux-` префиксами, что соответствует реальности (веб-компоненты неделимы на UI и UX), улучшена читаемость правил в `.cursorrules` (единая секция вместо двух), команды `UX:` продолжают работать но направляются в раздел UI, что логично отражает архитектуру приложения.

## UX (паттерны взаимодействий)


## MM (математическая модель)
