# Дневной лог разработки - 2025-12-08

## UI (оформление)

### Коммит: ba3f222 - "Adopt file prefix naming and rename scripts"
- **Что сделано**: Добавлены правила именования файлов с префиксами, зафиксировано требование поддерживать пул префиксов в `.cursorrules`/`architect.md`, переименованы существующие скрипты под новую схему и обновлён `index.html`.
- **Как сделано**:
  * Пополнены правила коммитов: фиксация имени до коммита, запись описания в дневной лог, добавление хеша после коммита.
  * В `architect.md` описан желаемый пул префиксов и расширено требование его поддерживать.
  * В `.cursorrules` добавлены шаги регламента коммитов и напоминание про префиксы.
  * Переименованы `config.js`, `cmp-*.js`, `app.js` в `cfg-app.js`, `c-ui-*.js`, `app-ui-root.js`; пути обновлены в `index.html`.
- **Функциональность**: Единое соглашение имён упрощает навигацию и будущий рост структуры; регламент коммитов и логирования зафиксирован в правилах.


### Коммит: ae87fbb - "Add lastCommitMessage display and update commit rules"
- **Что сделано**: Добавлено отображение названия последнего коммита в интерфейсе рядом с заголовком, обновлён регламент создания коммитов с выделением шага обновления `lastCommitMessage` в отдельный пункт.
- **Как сделано**:
  * Добавлена переменная `lastCommitMessage` в `core/cfg-app.js` с текущим значением.
  * В `app/app-ui-root.js` добавлено чтение `lastCommitMessage` из конфига и передача в data() приложения.
  * В `index.html` добавлено отображение `lastCommitMessage` под заголовком с иконкой ветки Font Awesome.
  * В `.cursorrules` обновлён регламент коммитов: шаг 3 — обновление `lastCommitMessage` в `core/cfg-app.js`, остальные шаги перенумерованы (4, 5).
- **Функциональность**: Пользователь видит название последнего коммита в интерфейсе; регламент коммитов требует обновлять эту переменную при каждом коммите (шаг 3).


### Коммит: Update commit rules: no immediate hash in log, no amend
- **Что сделано**: Обновлён регламент создания коммитов: запрещено сразу добавлять хеш в лог и использовать `git commit --amend` для этого, так как это создаёт замкнутый круг. Хеши обновляются при ревизии дневного лога.
- **Как сделано**:
  * В шаге 2 регламента добавлено требование указывать в логе только название коммита без хеша.
  * В шаге 5 регламента добавлен запрет на использование `git commit --amend` для добавления хеша и указано, что хеши обновляются при ревизии лога.
  * Обновлён раздел протоколирования: убрано требование всегда указывать хеш, указано, что хеш добавляется при ревизии.
  * Обновлена история изменений предпочтений с уточнением нового регламента.
- **Функциональность**: Регламент коммитов исключает проблему замкнутого круга при добавлении хешей; хеши добавляются отдельно при ревизии дневного лога, что упрощает процесс коммита.


### Коммит: Add password-protected splash screen
- **Что сделано**: Добавлен сплэш-экран с защитой паролем (временно без хеша) для защиты приложения от случайных посетителей.
- **Как сделано**:
  * Компонент `c-ui-splash.js` реализует прямую проверку пароля "2211", а также анимацию сползания и сохранение статуса в sessionStorage.
  * Сплэш-экран отображается в `index.html` поверх страницы с полем ввода и надписью "Code SMS".
  * Компонент был интегрирован в `app-ui-root.js`.
- **Функциональность**: При входе открывается сплэш-экран, ввод "2211" скрывает его, неверный код показывает ошибку. В текущей сессии повторного показа нет.

### Коммит: Ensure splash blocks external requests until unlock
- **Что сделано**: Гарантировал, что сплэш всегда отображается и что внешние запросы (например, CoinGecko) не запускаются до ввода пароля.
- **Как сделано**:
  * Компонент `c-ui-splash.js` больше не использует `sessionStorage` — сплэш всегда стартует при загрузке и отпускает приложение только после правильного кода.
  * В `c-ui-splash` устанавливается `window.appUnlocked` и отправляется событие `app-unlocked`, по которому компоненты начинают свои запросы.
  * В `c-ui-coingecko.js` добавлен слушатель `app-unlocked`, чтобы запросы к CoinGecko запускались только после разблокировки и не происходили под слоем.
  * Удалены попытки использовать sha256, весь UI доступен внутри `#app`, как прописано в правилах.
- **Функциональность**: Сплэш теперь стабильно появляется при любом перезапуске (Ctrl+F5), не пропадает сразу, и пока он отображается, никаких внешних запросов не отправляется. После ввода "2211" приложения запускаются и делают запросы.

### Коммит: f71ee90 - "Auto-focus splash input"
- **Что сделано**: Добавлен автофокус на поле ввода пароля сплэша, чтобы пользователь мог сразу начать ввод.
- **Как сделано**:
  * В `c-ui-splash.js` добавлен метод `focusInput`, который вызывается при монтировании и каждом показе сплэша.
  * Поле ввода получает `ref="passwordField"`, чтобы метод мог управлять фокусом.
- **Функциональность**: При каждом появлении сплэша курсор автоматически падает в поле пароля.

### Коммит: 64c772a - "Treat splash input as PIN"
- **Что сделано**: Парольный сплэш теперь работает как PIN-код — ввод обрабатывается моментально, символы видимы, поле остаётся пустым между запусками.
- **Как сделано**:
  * В `c-ui-splash.js` добавлен `handlePinInput`, который триггерит `checkPassword` сразу после ввода четвёртого символа.
  * Поле стало `type="text"` без placeholder и маски, чтобы вводимые цифры были видимыми и поле всегда начиналось пустым.
  * После разблокировки `window.appUnlocked` переводится в `true`, сплэш скрывается, а остальные компоненты запускают запросы через событие `app-unlocked`.
- **Функциональность**: PIN «2211» срабатывает без Enter, поле очищается/снимается ошибка при неверном вводе; пока сплэш висит, внешние запросы не выполняются.

### Коммит: 495d826 - "Show last commit name on splash"
- **Что сделано**: Перенёс отображение названия последнего пуша внутрь сплэша, прямо под полем PIN.
- **Как сделано**:
  * Убрал `lastCommitMessage` из хедера и добавил `p` с {{ lastCommitMessage }} непосредственно под вводом.
  * Текст стилизован под тёмную тему (`opacity`) и живёт внутри `#app`, как требуют правила.
  * Вывод всегда показывает актуальный `lastCommitMessage`, пока сплэш активен.
- **Функциональность**: Пользователь сразу видит название последнего коммита прямо на экране сплэша.

### Коммит: Allow direct splash password temporarily
- **Что сделано**: Упростили сплэш-экран, пока хеширование не работает с file:// — теперь пароль сравнивается напрямую.
- **Как сделано**:
  * Удалена зависимость от js-sha256 и проверка хеша, пароль сравнивается как строка (\"2211\").
  * Убрали подключение библиотеки из `index.html`, оставили чистую компоненту.
  * Обновлена история изменений, чтобы отметить, что пока пароль вводится напрямую.
- **Функциональность**: Вход работает независимо от поддержки Web Crypto API, сплэш скрывается при вводе \"2211\", сообщение об ошибке появляется только при неверном вводе.

## UX (паттерны взаимодействий)


## MM (математическая модель)
