# Дневной лог разработки - 13 декабря 2025

## UI (оформление)

## UX (паттерны взаимодействий)

## MM (математическая модель)

## Architect (архитектура, настройки)

### Коммит: 405093d - Start of day: 12-13
- **Что сделано**: Открыт новый рабочий день 13 декабря 2025
- **Как сделано**:
  * Проведена проверка документации проекта (`.cursorrules`, `architect.md`, `ui/guide-ii.md`)
  * Проверено состояние репозитория (чистое рабочее дерево, синхронизировано с `origin/master`)
  * Проверены текущие версии зависимостей (Vue.js 3.5.25, Bootstrap 5.3.8, Font Awesome 6.5.1)
  * Добавлено правило об обязательном создании открывающего коммита при открытии нового рабочего дня в `.cursorrules`
  * Создан файл дневного лога `history/2025/12-13.txt`
  * Обновлен `lastCommitMessage` в `core/cfg-app.js` на "Start of day: 12-13"
- **Функциональность**: Зафиксировано начало рабочего дня в истории репозитория, обеспечена преемственность документации и правил работы ИИ-агента

### Коммит: d313503 - Systematize component patterns and approaches
- **Что сделано**: Агрегированы и систематизированы все подходы к компонентам, сформированные за день
- **Как сделано**:
  * Добавлен раздел "Паттерны универсальных компонентов" в `architect.md` с подробным описанием:
    - Компонент `menu-item` (пункт меню) - структура, props, использование
    - Компонент `dropdown-menu` (выпадающее меню) - структура, props, события, клавиатурная навигация
    - Паттерн интеграции компонентов - правила использования универсальных компонентов
    - Стилизация фокуса через рутовые переменные - общая переменная `--color-focus-bg`
    - Единообразные стили пунктов меню - правила стилизации для консистентности
  * Добавлен раздел "Универсальные компоненты меню" в `ui/guide-ii.md` с описанием:
    - Структура и стилизация компонента `menu-item`
    - Клавиатурная навигация и управление курсором в `dropdown-menu`
    - Правила использования универсальных компонентов
  * Обновлен раздел "Доступность" в `ui/guide-ii.md` с информацией о клавиатурной навигации и управлении курсором
  * Обновлены описания компонентов в разделе "Текущее размещение файлов" в `architect.md` со ссылками на новый раздел
- **Функциональность**: Обеспечена полная систематизация и документация всех подходов к компонентам, сформированных за день, для использования в будущих сессиях разработки

### Коммит: 5797a8b - Implement universal menu components (menu-item and dropdown-menu)
- **Что сделано**: Реализованы универсальные компоненты меню и их интеграция во все выпадающие меню приложения
- **Как сделано**:
  * Создан компонент `ui/components/menu-item.js` - универсальный компонент пункта меню с иконкой, командой и индикатором
  * Создан компонент `ui/components/dropdown-menu.js` - универсальный компонент выпадающего меню с клавиатурной навигацией
  * Интегрированы компоненты во все выпадающие меню: счетчик, поиск, архив, контекстное меню, меню сортировки
  * Реализована стилизация фокуса через общую рутовую переменную `--color-focus-bg` для единообразия с выбранными строками таблицы
  * Добавлен prop `trigger-selector` в `dropdown-menu` для автоматической установки `cursor: pointer` на элементах-триггерах
  * Обновлены стили пунктов меню: паддинги на `<span>` элементах, фиксированные ширины для иконок и индикаторов
  * Обновлен `icons-helper.js` для синхронной загрузки иконок (встроен JSON для работы с file://)
  * Расширен `icons-mapping.json` с поддержкой индикаторов (status, navigation)
  * Зарегистрированы компоненты в `app-ui-root.js`
- **Функциональность**: Обеспечено единообразие всех выпадающих меню в приложении, полная клавиатурная навигация, автоматическое управление курсором триггеров, единый стиль фокуса

### Коммит: 56ca9ca - Add rule for commit hash requests in daily log
- **Что сделано**: Добавлено правило о просьбах добавить хеш коммита в дневной лог
- **Как сделано**:
  * Добавлено правило в раздел "ОБЯЗАТЕЛЬНЫЙ ЧЕКЛИСТ ПЕРЕД КАЖДЫМ КОММИТОМ" в `.cursorrules`
  * Правило запрещает изменение дневного лога при просьбах добавить хеш коммита (фразы типа "добросить", "добавить хеш")
  * ИИ-агент должен объяснять, что хеши добавляются только при завершении рабочего дня во время ревизии
  * Исправлено дублирование строки "**Что сделано**" в дневном логе
- **Функциональность**: Предотвращает появление незакоммиченных изменений в дневном логе при просьбах добавить хеш коммита, исключает циклические зависимости

### Коммит: 5673829 - Improve dropdown menu spacing and styling
- **Что сделано**: Улучшена стилизация выпадающих меню и элементов формы: отрицательный гэп между пунктами меню, видимые divider, улучшена стилизация фокуса для чекбоксов и полей ввода
- **Как сделано**:
  * Добавлен отрицательный гэп `-0.5rem` между пунктами меню для более компактного вида
  * Настроены стили divider: `padding-top: 1rem`, `margin: 0.5rem 1rem calc(-1rem - 1px) 1rem` для правильного позиционирования и просвечивания через фон пунктов
  * Divider сделан видимым с `opacity: 0.7` и просвечивает через прозрачный фон пунктов меню (`background-color: transparent`)
  * Восстановлена подсветка при наведении через `var(--color-focus-bg)` для более прозрачной подсветки
  * Убран класс `my-0` из divider в `index.html` (перебивал стили)
  * Убран autofocus с последующим blur в `dropdown-menu.js` для предотвращения выделения первого пункта
  * Убраны все кастомные стили фокуса для чекбоксов, возвращены дефолтные Bootstrap стили (скругленные фокусные рамки)
  * Добавлены глобальные стили фокуса для всех полей ввода (`.form-control:focus`, `.form-select:focus`) с светло-синей обводкой `hsl(210, 100%, 50%)`
  * Отключена тень фокуса для чекбоксов в заголовке таблицы (`th.col-checkbox .form-check-input:focus { box-shadow: none; }`)
- **Функциональность**: Выпадающие меню стали более компактными, divider видимые и просвечивают через фон пунктов, подсветка при наведении более прозрачная. Чекбоксы используют нативные Bootstrap стили со скруглениями, поля ввода имеют светло-синюю обводку при фокусе

### Коммит: d396ac1 - Adjust dropdown shadows and selected row highlight color
- **Что сделано**: Настроены тени выпадающих меню (шире, ниже, более легкая рамка) и цвет подсветки выбранных строк таблицы
- **Как сделано**:
  * Обновлены тени для всех вариантов выпадающих меню (базовый контейнер, инверсная тема для светлой и темной темы):
    - Основная тень: `0 8px 16px -4px` → `0 12px 20px -4px` (еще ниже)
    - Дополнительная тень: `0 4px 12px -2px` → `0 6px 14px -2px` (еще ниже)
    - Рамка (1px тень): прозрачность уменьшена с `0.1` до `0.05` для светлой темы, с `0.3` до `0.15` для темной темы (более легкая)
  * Обновлен цвет подсветки выбранных строк таблицы в `ui/styles/theme-colors.css`:
    - `--color-selected-row-h`: `210` → `200` (синий оттенок)
    - `--color-selected-row-s`: `5%` → `20%` (насыщенность)
    - `--color-selected-row-l`: `0%` → `50%` (яркость)
    - `--color-selected-row-alpha`: `0.02` → `0.05` (5% прозрачности)
    - Итоговый цвет: `hsl(200deg 20% 50% / 5%)`
- **Функциональность**: Тени выпадающих меню стали шире и ниже, рамка более легкая и менее заметная. Подсветка выбранных строк таблицы использует нейтральный серый с легким синеватым оттенком

### Коммит: 3c6ac65 - Refactor archive to favorites system with migration
- **Что сделано**: Полностью переработан концепт архива монет в хранилище избранного с миграцией данных и переименованием всех упоминаний "архив" на "избранное"
- **Как сделано**:
  * **Объединение систем избранного и архива**:
    - Объединены `favoriteCoinIds` и `cgArchivedCoins` в единую систему `cgFavoriteCoins` при загрузке данных
    - Добавлена миграция localStorage: `cgArchivedCoins` → `cgFavoriteCoins` с сохранением обратной совместимости
    - Удалена отдельная система `favoriteCoinIds` (миграция в `cgFavoriteCoins`)
  * **Переименование переменных и методов**:
    - `cgArchivedCoins` → `cgFavoriteCoins`, `archivedCoins` → `favoriteCoins`
    - `showArchiveDropdown` → `showFavoritesDropdown`, `selectedArchivedCoin` → `selectedFavoriteCoin`
    - `archiveCoin()` → `removeFromTable()`, `archiveSelectedCoins()` → `removeSelectedFromTable()`
    - `restoreFromArchiveById()` → `addFavoriteToTableById()`, `restoreFromArchive()` → `addFavoriteToTable()`
    - `syncCoinWithArchive()` → `syncCoinWithFavorites()`, `syncAllCoinsWithArchive()` → `syncAllCoinsWithFavorites()`
    - `getArchivedCoin*()` → `getFavoriteCoin*()`, `isFailedArchivedCoin()` → `isFailedFavoriteCoin()`
    - `toggleArchiveDropdown()` → `toggleFavoritesDropdown()`, `closeArchiveDropdown()` → `closeFavoritesDropdown()`
  * **Обновление логики работы**:
    - Избранное теперь хранилище, а не архив: монета может быть одновременно в таблице и в избранном
    - `syncCoinWithFavorites()` не удаляет из избранного при добавлении в таблицу
    - `addFavoriteToTableById()` проверяет наличие монеты в таблице: если есть - закрывает dropdown (отметка показывается), если нет - добавляет
    - `removeFromTable()` и `removeSelectedFromTable()` удаляют из таблицы и добавляют в избранное
  * **Обновление UI**:
    - "Архив" переименован в "Избранное" в кнопке и выпадающем списке
    - Иконка изменена с `fa-archive` на `fa-star`
    - CSS классы: `.cg-archive-btn` → `.cg-favorites-btn`, `archive-dropdown` → `favorites-dropdown`
    - События/эмиты: `archive-selected-coins` → `remove-selected-coins`, `restore-from-archive` → `add-favorite-to-table`
    - ID элементов: `context-archive` → `context-remove-from-table`, `counter-archive` → `counter-remove-from-table`
    - Тексты меню: "В архив" → "Убрать из таблицы", "Архивировать отмеченные" → "Убрать отмеченные из таблицы"
    - В выпадающем списке избранного показываются отметки для монет, уже находящихся в таблице
  * **Обновление документации**:
    - Переписан раздел "Синхронизация данных между таблицей и архивом" в `architect.md` на "Хранилище избранного и работа с таблицей монет"
    - Обновлены все упоминания архива на избранное в `ui/guide-ii.md` (переписаны целые абзацы)
    - Обновлены комментарии в коде под новую концепцию
    - Убраны все упоминания "архив" из кода, комментариев и документации (кроме истории и иконок для будущей функциональности)
  * **Миграция данных**:
    - При загрузке проверяются оба ключа: `cgArchivedCoins` (старый) и `cgFavoriteCoins` (новый)
    - Если есть старый ключ, но нет нового - данные мигрируются в новый ключ
    - Старый ключ `cgFavoriteCoinIds` также мигрируется в `cgFavoriteCoins` при первом запуске
- **Функциональность**: Избранное теперь работает как хранилище: монеты могут быть одновременно в таблице и в избранном. При клике на пункт избранного монета добавляется в таблицу (если её нет) или показывается отметка (если уже есть). Удаление из таблицы добавляет монету в избранное. Все упоминания "архив" удалены из проекта для избежания путаницы с будущей функциональностью архива

### Коммит: aed417d - Add docs/ to .gitignore and remove tracked files
- **Что сделано**: Добавлена папка `docs/` в `.gitignore` и удалены из индекса Git файлы, которые должны игнорироваться
- **Как сделано**:
  * Добавлена строка `docs/` в `.gitignore` для исключения всей папки с черновиками и документами из отслеживания Git
  * Удален `docs/TODO.TXT` из индекса Git через `git rm --cached docs/TODO.TXT` (файл остался на диске, но больше не отслеживается)
  * Удален `data-app.json` из индекса Git (файл экспорта настроек с пользовательскими данными)
  * Удален `77.json` из индекса Git (файл кэша данных приложения)
- **Функциональность**: Папка `docs/` и файлы с пользовательскими данными/кэшем больше не попадают в репозиторий, что предотвращает коммит личных данных и временных файлов

### Коммит: 10e5000 - Refactor icons system to ui-element-helper with button component and split tooltips
- **Что сделано**: Переименована система иконок в систему UI элементов (ui-element-helper), создан универсальный компонент кнопки, реализованы раздельные tooltips для компонентов, заменены Bootstrap tooltips на браузерные, переведены кнопки хедера на новый компонент
- **Как сделано**:
  * **Переименование системы иконок**:
    - `icons-mapping.json` → `ui-element-mapping.json` (переименован и обновлены все ссылки)
    - `icons-helper.js` → `ui-element-helper.js` (переименован и обновлены все использования)
    - `window.iconsHelper` → `window.uiElementHelper` (обновлены все вызовы в коде)
    - Удалены старые файлы после миграции
  * **Создание компонента button.js**:
    - Универсальный компонент кнопки с иконкой, текстом и индикатором
    - Основан на `uiElementHelper` для получения конфигурации (иконки, labels, tooltips)
    - Полная UI-совместимость с Bootstrap (variants, sizes)
    - Поддержка раздельных tooltips для основной части и индикатора
    - Поддержка состояния загрузки (`loading` prop) с динамическим текстом (`loadingText` prop)
    - Перенос паддингов Bootstrap на дочерние элементы (`.button-main`, `.button-indicator`) для корректной работы tooltips
    - Создан CSS файл `ui/styles/button.css` с правилами переноса паддингов
    - Зарегистрирован в `app-ui-root.js` как `cmp-button`
  * **Обновление menu-item.js**:
    - Использует `uiElementHelper` вместо `iconsHelper`
    - Поддержка раздельных tooltips для основной части (`.menu-item-main`) и индикатора (`.menu-item-indicator`)
    - Перенос паддингов на дочерние элементы для корректной работы tooltips
  * **Обновление CSS**:
    - `ui/styles/dropdown.css`: перенос паддингов на `.menu-item-main` и `.menu-item-indicator`, убраны правила для Bootstrap tooltips
    - `ui/styles/button.css`: создан новый файл с правилами переноса паддингов Bootstrap на дочерние элементы
    - `ui/styles/layout.css`: добавлены правила для адаптивного отображения кнопок (скрытие иконки/текста на разных размерах экрана), добавлены правила для disabled пунктов меню (opacity: 0.5 для иконок)
  * **Замена Bootstrap tooltips на браузерные**:
    - Удалены `data-bs-toggle="tooltip"` и `data-bs-theme` из шаблонов `button-template` и `menu-item-template`
    - Удалены методы `initTooltips()` из компонентов `button.js` и `menu-item.js`
    - Удалены computed свойства `tooltipTheme()` из обоих компонентов
    - Удалены CSS правила для `[data-bs-toggle="tooltip"]`
    - Теперь используются только браузерные tooltips через атрибут `title`
  * **Перевод кнопок хедера на новый компонент**:
    - Кнопка "Избранное" переведена на `cmp-button` с сохранением визуального вида и позиционирования
    - Кнопка "Обновить" переведена на `cmp-button` с поддержкой динамического текста загрузки (показывает количество монет вместо спиннера)
    - Добавлено computed свойство `updateButtonLoadingText` в `header-coins.js` для отображения количества монет при загрузке
    - Исправлена логика отображения текста: при наличии `loadingText` обычный текст полностью скрывается
  * **Исправления стилей**:
    - Убрана ширина иконки с `4em` на `2em` в `.menu-item-icon`
    - Закомментирован отрицательный margin для иконки меню
    - Убран `display: flex` из `.button-main` для центрирования текста
    - Исправлена логика скрытия текста при загрузке: текст не рендерится, если есть `loadingText`
  * **Обновление документации**:
    - `architect.md`: обновлены все упоминания системы иконок на систему UI элементов, добавлена информация о компоненте `button.js`, обновлены описания раздельных tooltips
    - `ui/guide-ii.md`: обновлены описания системы UI элементов, добавлена информация о раздельных tooltips
- **Функциональность**: Система UI элементов (`ui-element-helper`) теперь является единой точкой управления конфигурацией для всех UI элементов (иконки, кнопки, меню). Компонент `button` обеспечивает полную совместимость с Bootstrap и поддержку раздельных tooltips. Кнопки хедера используют новый компонент с сохранением визуального вида. При загрузке данных на кнопке "Обновить" показывается количество монет вместо спиннера. Все tooltips используют браузерный дефолтный механизм вместо Bootstrap

