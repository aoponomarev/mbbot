# Дневной лог разработки - 14 декабря 2025

## UI (оформление)

### Коммит: Fix window.uiElementHelper access in Vue templates and restore icons catalog
- **Что сделано**: Исправлена проблема с доступом к `window.uiElementHelper` в шаблонах Vue, восстановлен каталог иконок и документация из коммита b04fb21
- **Как сделано**:
  * **Восстановление изменений из коммита b04fb21**:
    - Восстановлен файл `ui/assets/icons-review.html` - интерактивный каталог всех иконок проекта
    - Восстановлен файл `ui/assets/icons/icon-cross.svg` - SVG иконка крестика
    - Восстановлены обновления в `ui/config/ui-element-mapping.json` с командами для иконки крестика
    - Восстановлены обновления в `ui/styles/icons.css` со стилями для SVG иконки крестика
    - Восстановлены обновления в `ui/utils/ui-element-helper.js` с функциями для работы с SVG иконками
    - Восстановлены обновления документации в `architect.md` и `ui/guide-ii.md` про каталог иконок
  * **Исправление проблемы window.uiElementHelper**:
    - Добавлены computed свойства в `ui/components/button.js`:
      - `uiElementHelper()` - безопасный доступ к `window.uiElementHelper`
      - `isSVGIcon()` - проверка, является ли иконка SVG
      - `svgIconPath()` - путь к SVG иконке
    - Добавлены computed свойства в `ui/components/menu-item.js`:
      - `uiElementHelper()` - безопасный доступ к `window.uiElementHelper`
      - `isSVGIcon()` - проверка, является ли иконка SVG
      - `svgIconPath()` - путь к SVG иконке
    - Обновлены шаблоны в `index.html`:
      - В шаблоне `button-template` заменены прямые обращения `window.uiElementHelper.isSVGIcon()` и `window.uiElementHelper.getSVGIconPath()` на computed свойства `isSVGIcon` и `svgIconPath`
      - В шаблоне `menu-item-template` заменены прямые обращения `window.uiElementHelper.isSVGIcon()` и `window.uiElementHelper.getSVGIconPath()` на computed свойства `isSVGIcon` и `svgIconPath`
- **Функциональность**: Кнопки и выпадающие списки теперь работают корректно, так как доступ к `window.uiElementHelper` в шаблонах Vue осуществляется через computed свойства, которые безопасно обрабатывают случаи, когда `window` недоступен. Каталог иконок восстановлен и доступен для просмотра всех иконок проекта.

## UX (паттерны взаимодействий)

### Коммит: Fix dropdown menu opening issue and remove debug logging
- **Что сделано**: Исправлена проблема с открытием выпадающего меню кнопки "Избранное" и удалено отладочное логирование
- **Как сделано**:
  * **Исправление проблемы с открытием меню**:
    - Добавлен флаг `isTogglingFavorites` в `ui/components/header-coins.js` для предотвращения двойной обработки события `toggle-favorites-dropdown`
    - Убран модификатор `@click.stop` из шаблона `cmp-button` в `index.html`, так как `stopPropagation()` теперь вызывается явно в обработчике
    - Добавлен явный вызов `event.stopPropagation()` в методе `handleToggleFavoritesDropdown` для предотвращения всплытия события
    - Добавлена задержка 100ms перед сбросом флага `isTogglingFavorites` для предотвращения повторной обработки события
  * **Исправление проблемы с сохранением состояния чекбоксов**:
    - Модифицирован метод `fetchCoinGecko()` в `ui/api/coingecko.js` для фильтрации `selectedCoinIds` на основе вновь загруженных монет вместо полной очистки массива
    - Это сохраняет состояние выбранных чекбоксов для монет, которые остаются в списке после обновления
  * **Исправление проблемы с event.stopPropagation**:
    - Модифицирован метод `handleClick()` в `ui/components/button.js` для передачи нативного объекта события как первого аргумента в `$emit('click')`
    - Добавлен явный вызов `event.stopPropagation()` в `handleClick()` для предотвращения всплытия события
  * **Удаление отладочного логирования**:
    - Удалены все блоки `#region agent log` из `ui/components/button.js`
    - Удалены все блоки `#region agent log` из `ui/components/header-coins.js`
    - Удалены все блоки `#region agent log` из `ui/api/coingecko.js`
    - Удалены все блоки `#region agent log` из `ui/components/dropdown-menu.js`
- **Функциональность**: Выпадающее меню кнопки "Избранное" теперь открывается и закрывается корректно без двойной обработки событий. Состояние чекбоксов сохраняется при обновлении данных. Код очищен от отладочного логирования.

## MM (математическая модель)

## Architect (архитектура, настройки)

### Коммит: Move review files to ui/, remove unused color variable, and update documentation
- **Что сделано**: Перемещены review-файлы из `docs/` в `ui/`, удалена неиспользуемая переменная `--color-primary-muted`, обновлена документация и исправлены несоответствия
- **Как сделано**:
  * **Перемещение review-файлов**:
    - Перемещен `docs/review-manager.js` → `ui/review-manager.js`
    - Перемещен `docs/review-styles.css` → `ui/review-styles.css`
    - Обновлены пути в `ui/assets/icons-review.html` и `ui/styles/colors-review.html` на `../review-manager.js` и `../review-styles.css`
    - Обновлена логика определения путей в `ui/review-manager.js` для корректной навигации между review-файлами
    - Обновлены ссылки в `.cursorrules` на новые пути
  * **Удаление неиспользуемой переменной**:
    - Удалена переменная `--color-primary-muted` и связанные переменные (`--color-primary-muted-h`, `--color-primary-muted-s`, `--color-primary-muted-l`, `--color-primary-muted-rgb`) из `ui/styles/theme-colors.css` (светлая и темная темы)
    - Удалены записи о `--color-primary-muted` и `--color-primary-muted-rgb` из `ui/styles/colors-review.html`
    - Удалена категория "Primary" из выпадающего списка категорий в `ui/styles/colors-review.html` (так как цветов с этой категорией больше нет)
  * **Обновление стилей review-файлов**:
    - Убрана тень (`box-shadow`) у `.review-header` в `ui/review-styles.css`
    - Убран вертикальный гэп (`margin-bottom: 0`) между вкладками и блоком фильтров
    - Убрана внешняя рамка (`border: none`, `box-shadow: none`) у блока фильтров
  * **Обновление документации**:
    - Добавлено описание каталога цветов (`ui/styles/colors-review.html`) в `architect.md` и `ui/guide-ii.md`
    - Добавлено описание системы управления review-файлами (`ui/review-manager.js` и `ui/review-styles.css`) в `architect.md` и `ui/guide-ii.md`
    - Обновлена структура проекта в `architect.md`: добавлены `review-manager.js`, `review-styles.css`, `colors-review.html`
    - Исправлены несоответствия в структуре проекта: добавлены `button.js`, `dropdown-menu.js` в список компонентов и `button.css` в список стилей
    - Добавлено упоминание `ui/styles/button.css` в раздел "Текущее размещение файлов"
- **Функциональность**: Review-файлы теперь находятся в более логичном месте (`ui/`), неиспользуемый код удален, документация актуализирована и соответствует кодовой базе. Интерфейс review-файлов упрощен (убрана тень, рамка фильтров, вертикальный гэп).

### Коммит: Start of day: 12-14
- **Что сделано**: Открыт новый рабочий день 14 декабря 2025
- **Как сделано**:
  * Проведена проверка документации проекта (`.cursorrules`, `architect.md`, `ui/guide-ii.md`)
  * Проверено состояние репозитория (чистое рабочее дерево, синхронизировано с `origin/master`)
  * Проверены текущие версии зависимостей (Vue.js 3.5.25, Bootstrap 5.3.8, Font Awesome 6.5.1)
  * Создан файл дневного лога `history/2025/12-14.txt`
  * Обновлен `lastCommitMessage` в `core/cfg-app.js` на "Start of day: 12-14"
- **Функциональность**: Зафиксировано начало рабочего дня в истории репозитория, обеспечена преемственность документации и правил работы ИИ-агента

