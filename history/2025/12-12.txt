# Дневной лог разработки - 12 декабря 2025

## UI (оформление)

### Коммит: b8c5343 - "Add cell-coin component and favorites system for coins"
- **Что сделано**: Создан переиспользуемый компонент `cell-coin.js` для отображения монет в ячейках таблицы и добавлена система избранного для монет
- **Как сделано**:
  * Создан компонент `ui/components/cell-coin.js` с props: `iconUrl`, `ticker`, `fullName`, `coinId`, `cssClasses`
  * Добавлен x-template `#cell-coin-template` в `index.html` с разметкой для иконки и тикера монеты
  * Компонент эмитит событие `context-menu` при клике и контекстном меню (ПКМ) для интеграции с родительским компонентом
  * Зарегистрирован компонент в `app/app-ui-root.js` как `cell-coin`
  * Заменен `<div class="cg-coin-block">` на `<cell-coin>` в `table-data-template` для использования нового компонента
  * Полное название монеты отображается во всплывающей подсказке через атрибут `title`
  * Поддержка кастомизации через объект `cssClasses` с классами для `cell`, `icon`, `ticker`
- **Функциональность**: Компонент обеспечивает единообразное отображение монет во всех таблицах, обрабатывает клики и контекстное меню, интегрируется с существующей системой контекстного меню

## UX (паттерны взаимодействий)

### Коммит: b8c5343 - "Add cell-coin component and favorites system for coins"
- **Что сделано**: Добавлена система избранного для монет с интеграцией в контекстное меню
- **Как сделано**:
  * Добавлено реактивное свойство `favoriteCoinIds` в `data()` компонента `coingecko.js` с загрузкой из `localStorage` под ключом `cgFavoriteCoinIds`
  * Добавлены методы `isFavorite(coinId)` для проверки статуса избранного и `toggleFavorite(coinId)` для переключения статуса
  * Метод `toggleFavorite` сохраняет изменения в `localStorage` и закрывает контекстное меню после переключения
  * Добавлен пункт "В избранное/Убрать из избранного" в контекстное меню монет в `index.html`
  * Пункт меню отображается с динамической иконкой звездочки (`fa-star`) с цветом `text-warning` для избранных и `text-muted` для не избранных
  * Текст пункта меню динамически меняется в зависимости от статуса избранного
- **Функциональность**: Пользователь может добавлять монеты в избранное и убирать их из избранного через контекстное меню. Состояние избранного сохраняется между сессиями через `localStorage` и автоматически восстанавливается при загрузке приложения

## Architect (архитектура, настройки)

### Коммит: b8c5343 - "Add cell-coin component and favorites system for coins"
- **Что сделано**: Обновлена архитектурная документация с описанием системы компонентов ячеек таблицы и системы избранного
- **Как сделано**:
  * Добавлено описание компонента `cell-coin.js` в раздел "Текущее размещение файлов" в `architect.md`
  * Добавлен новый раздел "Система компонентов ячеек таблицы (Table Cell Components System)" в `architect.md` с описанием архитектурного принципа модульности и переиспользования компонентов для ячеек таблиц
  * Добавлен новый раздел "Система избранного (Favorites System)" в `architect.md` с описанием архитектурного принципа управления пользовательскими предпочтениями для монет
  * Обновлена структура проекта в `architect.md` с добавлением новых компонентов (`cell-num.js`, `cell-row-select.js`, `cell-coin.js`, `header-cell.js`, `header-cell-check.js`, `table-data.js`) в раздел "Структура проекта"
  * Обновлен раздел "Управление списком монет" в `ui/guide-ii.md` с описанием системы избранного и интеграции в контекстное меню
- **Функциональность**: Документация отражает текущее состояние архитектуры проекта, описывает новые системы и их интеграцию с существующими компонентами

## Architect (архитектура, настройки)

### Коммит: 2742f7f - "Add rule for understanding 'внеси в правила' command"
- **Что сделано**: Добавлено правило понимания команды "внеси в правила" с распределением изменений по соответствующим документам
- **Как сделано**:
  * Добавлен раздел "КРИТИЧЕСКИ ВАЖНО - Понимание команды 'внеси в правила'" в секцию "Сопровождение документации проекта" в `.cursorrules`
  * Правило определяет, что при команде "внеси в правила" не следует автоматически предполагать, что речь идет только о `.cursorrules`
  * Правило требует анализа содержания просьбы и определения типа правил (правила работы ИИ-агента → `.cursorrules`, архитектурные правила → `architect.md`, правила UI/UX → `ui/guide-ii.md`, смешанные → декомпозировать и разместить в соответствующих документах)
  * Добавлено краткое напоминание в раздел "Стиль работы" со ссылкой на детальное правило
  * Добавлено в раздел "Текущие предпочтения пользователя" для фиксации предпочтения
  * Добавлена запись в "Историю изменений предпочтений" с датой 2025-12-12
- **Функциональность**: ИИ-агент теперь правильно понимает команду "внеси в правила" и распределяет изменения по соответствующим документам в зависимости от типа правил, обеспечивая правильную классификацию и размещение правил для поддержания структурированности и согласованности документации проекта

## Architect (архитектура, настройки)

### Коммит: de8b2a5 - "Add deterministic hashes for all component instances"
- **Что сделано**: Добавлены детерминированные уникальные хэши для всех экземпляров переиспользуемых компонентов и проведена ревизия всех компонентов
- **Как сделано**:
  * Создана утилита `ui/utils/hash-generator.js` для генерации детерминированных Base58 хэшей из строк
  * Добавлено computed свойство `instanceHash` во все переиспользуемые компоненты:
    - `cell-coin.js`: на основе `coinId` prop
    - `cell-row-select.js`: на основе `rowId` prop
    - `cell-num.js`: на основе `cellId` prop (опционально)
    - `header-cell.js`: на основе `sortField` или `label` prop
    - `header-cell-check.js`: на основе статического идентификатора `'header-cell-check-all'`
    - `sortable-header.js`: на основе `field` prop
    - `table-coin-row.js`: на основе `coin.id` или комбинации `coin.symbol` и `index`
  * Обновлены шаблоны в `index.html` для использования динамического `instanceHash` вместо статических хэшей
  * Добавлено обязательное правило "Детерминированные хэши для экземпляров компонентов" в `architect.md` с описанием требований и примеров
  * Обновлены описания компонентов в `architect.md` с указанием источника `instanceHash`
  * Добавлено описание утилиты `hash-generator.js` в раздел "Текущее размещение файлов" в `architect.md`
  * Обновлена структура проекта в `architect.md` с добавлением `hash-generator.js` в раздел utils
  * Добавлено правило в `.cursorrules` о детерминированных хэшах для экземпляров компонентов
- **Функциональность**: Все экземпляры переиспользуемых компонентов теперь имеют детерминированные уникальные хэши, стабильные между сессиями. Это позволяет стилизовать конкретные экземпляры компонентов через их уникальные классы, обеспечивая возможность кастомной стилизации отдельных экземпляров компонентов

## UI (оформление)

### Коммит: 19ebc7d - "Add colorization, rounding features and color adjustments to cell-num"
- **Что сделано**: Добавлена автоматическая цветизация числовых ячеек на основе знака значения и обновлены цвета danger и success
- **Как сделано**:
  * Добавлен prop `colorize: Boolean` в компонент `cell-num.js` для включения автоматической цветизации
  * Добавлены computed свойства `colorizeClass()` и `colorizeDataAttr()` для определения знака значения (positive/negative/zero)
  * Добавлены CSS правила в `ui/styles/layout.css` для применения цветов к дочерним `<span>` элементам через селекторы `[data-value-sign="positive"]`, `[data-value-sign="negative"]`, `[data-value-sign="zero"]`
  * Добавлены CSS переменные `--color-danger`, `--color-success`, `--color-muted` в `ui/styles/theme-colors.css` для обеих тем (light и dark)
  * Обновлен цвет `--color-danger` на HSL(340, 100%, 40%) для светлой темы и HSL(340, 100%, 60%) для темной темы (малиновый оттенок)
  * Обновлен цвет `--color-success` на HSL(90, 100%, 30%) для светлой темы и HSL(90, 100%, 60%) для темной темы (салатовый оттенок)
  * Добавлен флаг `colorize: true` во все числовые колонки (процентные и CD) в конфигурации `tableColumns` в `coingecko.js`
  * Добавлена логика жирного шрифта для целой части положительных чисел >= 1 при включенной цветизации через класс `fw-bold`
- **Функциональность**: Все числовые колонки автоматически цветизируются: положительные значения (|value| >= 1) получают салатовый цвет, отрицательные (|value| >= 1) получают малиновый цвет, значения близкие к нулю (|value| < 1) получают нейтральный серый цвет. Целая часть положительных чисел >= 1 отображается жирным шрифтом для лучшей визуальной иерархии

## UX (паттерны взаимодействий)

### Коммит: 19ebc7d - "Add colorization, rounding features and color adjustments to cell-num"
- **Что сделано**: Добавлена всплывающая подсказка с точным значением для чисел, округленных до 0
- **Как сделано**:
  * Добавлено computed свойство `tooltipText()` в `cell-num.js` для определения текста всплывающей подсказки
  * Если значение округлилось до 0 (но изначально не было 0), в tooltip показывается точное исходное значение
  * Обновлен шаблон `cell-num-template` в `index.html` для использования `tooltipText` вместо `showTooltip ? value : null`
- **Функциональность**: При наведении на числа, округленные до 0 (с префиксом "~"), пользователь видит точное исходное значение во всплывающей подсказке, что помогает понять реальное значение до округления

## MM (математическая модель)

### Коммит: 19ebc7d - "Add colorization, rounding features and color adjustments to cell-num"
- **Что сделано**: Добавлены функции округления до 0.5, округления больших чисел до целых и префикс "~" для округленных до 0
- **Как сделано**:
  * Добавлен prop `roundToHalf: Boolean` в компонент `cell-num.js` для округления до 0.5 (0.0, 0.5, 1.0, 1.5 и т.д.)
  * Обновлен метод `applyRounding()` для поддержки `roundToHalf` с формулой `Math.round(value * 2) / 2`
  * Добавлено computed свойство `effectivePrecision()` для определения эффективной точности с учетом `roundToHalf` и больших чисел
  * Для чисел с абсолютным значением >= 10 автоматически используется `precision: 0` (округление до целых)
  * Обновлены computed свойства `hasFractionPart()` и `fractionPart()` для использования `effectivePrecision`
  * Добавлена логика в `numberPrefix()` для автоматического добавления префикса "~" если значение округлилось до 0 (но изначально не было 0)
  * Добавлен флаг `roundToHalf: true` во все числовые колонки (процентные и CD) в конфигурации `tableColumns` в `coingecko.js`
  * Обновлен метод `formatDecimal()` для использования `effectivePrecision`
- **Функциональность**: Числовые колонки округляются до 0.5 для значений < 10, большие числа (|value| >= 10) округляются до целых, числа округленные до 0 получают префикс "~" для индикации приблизительного значения

## Architect (архитектура, настройки)

### Коммит: 19ebc7d - "Add colorization, rounding features and color adjustments to cell-num"
- **Что сделано**: Обновлена конфигурация колонок таблицы с добавлением флагов цветизации и округления
- **Как сделано**:
  * Добавлены флаги `colorize: true` и `roundToHalf: true` в объекты `format` всех процентных колонок (1h, 24h, 7d, 14d, 30d, 200d) в `tableColumns` в `coingecko.js`
  * Добавлены те же флаги в динамическую CD колонку и метод `getCDFormat()` в `coingecko.js`
  * Флаги передаются в компонент `cell-num` через метод `getColumnFormatProps()` и prop binding `v-bind="getFormatProps(column)"`
- **Функциональность**: Конфигурация колонок централизована и позволяет легко управлять форматированием и поведением числовых ячеек через флаги в конфигурации, обеспечивая единообразие отображения всех числовых колонок

