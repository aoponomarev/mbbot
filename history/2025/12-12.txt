# Дневной лог разработки - 12 декабря 2025

## UI (оформление)

### Коммит: "Add cell-coin component and favorites system for coins"
- **Что сделано**: Создан переиспользуемый компонент `cell-coin.js` для отображения монет в ячейках таблицы и добавлена система избранного для монет
- **Как сделано**:
  * Создан компонент `ui/components/cell-coin.js` с props: `iconUrl`, `ticker`, `fullName`, `coinId`, `cssClasses`
  * Добавлен x-template `#cell-coin-template` в `index.html` с разметкой для иконки и тикера монеты
  * Компонент эмитит событие `context-menu` при клике и контекстном меню (ПКМ) для интеграции с родительским компонентом
  * Зарегистрирован компонент в `app/app-ui-root.js` как `cell-coin`
  * Заменен `<div class="cg-coin-block">` на `<cell-coin>` в `table-data-template` для использования нового компонента
  * Полное название монеты отображается во всплывающей подсказке через атрибут `title`
  * Поддержка кастомизации через объект `cssClasses` с классами для `cell`, `icon`, `ticker`
- **Функциональность**: Компонент обеспечивает единообразное отображение монет во всех таблицах, обрабатывает клики и контекстное меню, интегрируется с существующей системой контекстного меню

## UX (паттерны взаимодействий)

### Коммит: "Add cell-coin component and favorites system for coins"
- **Что сделано**: Добавлена система избранного для монет с интеграцией в контекстное меню
- **Как сделано**:
  * Добавлено реактивное свойство `favoriteCoinIds` в `data()` компонента `coingecko.js` с загрузкой из `localStorage` под ключом `cgFavoriteCoinIds`
  * Добавлены методы `isFavorite(coinId)` для проверки статуса избранного и `toggleFavorite(coinId)` для переключения статуса
  * Метод `toggleFavorite` сохраняет изменения в `localStorage` и закрывает контекстное меню после переключения
  * Добавлен пункт "В избранное/Убрать из избранного" в контекстное меню монет в `index.html`
  * Пункт меню отображается с динамической иконкой звездочки (`fa-star`) с цветом `text-warning` для избранных и `text-muted` для не избранных
  * Текст пункта меню динамически меняется в зависимости от статуса избранного
- **Функциональность**: Пользователь может добавлять монеты в избранное и убирать их из избранного через контекстное меню. Состояние избранного сохраняется между сессиями через `localStorage` и автоматически восстанавливается при загрузке приложения

## Architect (архитектура, настройки)

### Коммит: "Add cell-coin component and favorites system for coins"
- **Что сделано**: Обновлена архитектурная документация с описанием системы компонентов ячеек таблицы и системы избранного
- **Как сделано**:
  * Добавлено описание компонента `cell-coin.js` в раздел "Текущее размещение файлов" в `architect.md`
  * Добавлен новый раздел "Система компонентов ячеек таблицы (Table Cell Components System)" в `architect.md` с описанием архитектурного принципа модульности и переиспользования компонентов для ячеек таблиц
  * Добавлен новый раздел "Система избранного (Favorites System)" в `architect.md` с описанием архитектурного принципа управления пользовательскими предпочтениями для монет
  * Обновлена структура проекта в `architect.md` с добавлением новых компонентов (`cell-num.js`, `cell-row-select.js`, `cell-coin.js`, `header-cell.js`, `header-cell-check.js`, `table-data.js`) в раздел "Структура проекта"
  * Обновлен раздел "Управление списком монет" в `ui/guide-ii.md` с описанием системы избранного и интеграции в контекстное меню
- **Функциональность**: Документация отражает текущее состояние архитектуры проекта, описывает новые системы и их интеграцию с существующими компонентами

## Architect (архитектура, настройки)

### Коммит: "Add rule for understanding 'внеси в правила' command"
- **Что сделано**: Добавлено правило понимания команды "внеси в правила" с распределением изменений по соответствующим документам
- **Как сделано**:
  * Добавлен раздел "КРИТИЧЕСКИ ВАЖНО - Понимание команды 'внеси в правила'" в секцию "Сопровождение документации проекта" в `.cursorrules`
  * Правило определяет, что при команде "внеси в правила" не следует автоматически предполагать, что речь идет только о `.cursorrules`
  * Правило требует анализа содержания просьбы и определения типа правил (правила работы ИИ-агента → `.cursorrules`, архитектурные правила → `architect.md`, правила UI/UX → `ui/guide-ii.md`, смешанные → декомпозировать и разместить в соответствующих документах)
  * Добавлено краткое напоминание в раздел "Стиль работы" со ссылкой на детальное правило
  * Добавлено в раздел "Текущие предпочтения пользователя" для фиксации предпочтения
  * Добавлена запись в "Историю изменений предпочтений" с датой 2025-12-12
- **Функциональность**: ИИ-агент теперь правильно понимает команду "внеси в правила" и распределяет изменения по соответствующим документам в зависимости от типа правил, обеспечивая правильную классификацию и размещение правил для поддержания структурированности и согласованности документации проекта

## Architect (архитектура, настройки)

### Коммит: "Add deterministic hashes for all component instances"
- **Что сделано**: Добавлены детерминированные уникальные хэши для всех экземпляров переиспользуемых компонентов и проведена ревизия всех компонентов
- **Как сделано**:
  * Создана утилита `ui/utils/hash-generator.js` для генерации детерминированных Base58 хэшей из строк
  * Добавлено computed свойство `instanceHash` во все переиспользуемые компоненты:
    - `cell-coin.js`: на основе `coinId` prop
    - `cell-row-select.js`: на основе `rowId` prop
    - `cell-num.js`: на основе `cellId` prop (опционально)
    - `header-cell.js`: на основе `sortField` или `label` prop
    - `header-cell-check.js`: на основе статического идентификатора `'header-cell-check-all'`
    - `sortable-header.js`: на основе `field` prop
    - `table-coin-row.js`: на основе `coin.id` или комбинации `coin.symbol` и `index`
  * Обновлены шаблоны в `index.html` для использования динамического `instanceHash` вместо статических хэшей
  * Добавлено обязательное правило "Детерминированные хэши для экземпляров компонентов" в `architect.md` с описанием требований и примеров
  * Обновлены описания компонентов в `architect.md` с указанием источника `instanceHash`
  * Добавлено описание утилиты `hash-generator.js` в раздел "Текущее размещение файлов" в `architect.md`
  * Обновлена структура проекта в `architect.md` с добавлением `hash-generator.js` в раздел utils
  * Добавлено правило в `.cursorrules` о детерминированных хэшах для экземпляров компонентов
- **Функциональность**: Все экземпляры переиспользуемых компонентов теперь имеют детерминированные уникальные хэши, стабильные между сессиями. Это позволяет стилизовать конкретные экземпляры компонентов через их уникальные классы, обеспечивая возможность кастомной стилизации отдельных экземпляров компонентов

