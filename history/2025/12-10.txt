# Дневной лог разработки - 2025-12-10

## UI (оформление)

### Коммит: "Optimize main layout: remove wrapper, center content, fix header spacing"
- **Что сделано**: Оптимизирована структура основного контента: убрана лишняя обертка `<div class="row">`, перенесен класс `row` на `<main>`, добавлено центрирование контента с ограничением ширины, исправлен отступ сверху (контент не перекрывается хедером), убраны `!important` из CSS.
- **Как сделано**:
  * В `index.html` убрана лишняя обертка `<div class="row">`, класс `row` перенесен на `<main class="avto-K9mP4rT row justify-content-center">`.
  * Убран пустой `<header class="mb-4"></header>`, который создавал лишний отступ сверху.
  * Убраны Bootstrap классы `pt-5 pb-4` из HTML, вместо них используется кастомный CSS селектор `.container-fluid.app-main-container` с достаточной специфичностью (два класса) для переопределения дефолтных стилей Bootstrap без `!important`.
  * В `ui/styles/layout.css` добавлены стили для `.container-fluid.app-main-container` с `padding-top: 60px` (хедер 50px + зазор 10px) и `padding-bottom: 20px`.
  * Добавлены стили для `.avto-K9mP4rT` с `max-width: 1400px`, `margin: 0 auto` для центрирования, адаптивными боковыми отступами (15px на десктопе, 10px на мобильных < 576px).
  * Убраны все `!important` из CSS, используется правильная специфичность селекторов.
- **Функциональность**: Контент теперь красиво центрирован с максимальной шириной 1400px, не перекрывается фиксированным хедером, имеет адаптивные отступы для мобильных устройств. Структура упрощена без лишних оберток, код чище и проще в поддержке.

### Коммит: "Add inverse theme for header dropdowns/tooltips and remove header side padding"
- **Что сделано**: Реализована инверсная тема для dropdown меню и всплывающих подсказок в хедере, убраны боковые паддинги в хедере, центральный блок занимает всю доступную ширину.
- **Как сделано**:
  * Добавлен метод `getInverseTheme()` и computed-свойство `inverseTheme` в `ui/interaction/header.js` для получения инверсной темы (light ↔ dark).
  * Dropdown меню используют инверсную тему через `:data-bs-theme="inverseTheme"` вместо `getCurrentTheme()`.
  * Реализована инициализация Bootstrap tooltips с инверсной темой через `data-bs-theme` в методе `initTooltips()`, tooltips обновляются при изменении темы приложения.
  * Убраны кастомные `border-radius: 4px` из `ui/styles/dropdown.css`, используются дефолтные значения Bootstrap (`var(--bs-border-radius)`).
  * Унифицированы стили dropdown для десктоп и мобильной версии (убрана медиа-запрос `@media (max-width: 767.98px)`, стили применяются ко всем `.app-header-dropdown-menu`).
  * Убраны боковые паддинги в хедере: добавлен класс `app-header-container-fluid` с `padding-left: 0` и `padding-right: 0` в `ui/styles/header.css`, убран класс `px-3` у центрального блока в `index.html`.
  * Центральный блок хедера использует `flex-grow-1` и занимает всю доступную ширину без боковых паддингов.
- **Функциональность**: Dropdown меню и всплывающие подсказки в хедере теперь инверсны включенной теме приложения (если тема light — dropdown/tooltip dark, и наоборот), обеспечивая визуальный контраст. Оформление идентично для десктоп и мобильной версии. Хедер не имеет боковых паддингов, центральный блок занимает всю доступную ширину.

## UX (паттерны взаимодействий)

### Коммит: "Fix component visibility toggle and tab switching logic"
- **Что сделано**: Исправлена логика переключения видимости компонентов `app-settings` и `app-coingecko` при взаимодействии с гамбургером и вкладкой "%". Исправлен баг, когда после открытия настроек через гамбургер вкладка "%" переставала переключаться.
- **Как сделано**:
  * Перенесено состояние `activeTab` из компонента header в корневой компонент (`app/app-ui-root.js`) для централизованного управления и доступа из разных компонентов.
  * В `ui/interaction/header.js` `activeTab` преобразован в computed-свойство, которое читает значение из корневого компонента (`this.$root.activeTab`).
  * Добавлен watch для `$root.activeTab` в `ui/interaction/header.js` для реактивного обновления computed-свойств при изменении активной вкладки.
  * Метод `toggleMenu()` в `ui/interaction/header.js` теперь только открывает настройки (`root.showSettings = true`), не переключает их.
  * Метод `switchTab()` в `ui/interaction/header.js` при переключении на вкладку "%" всегда закрывает настройки (`root.showSettings = false`), обеспечивая показ CoinGecko.
  * В `index.html` добавлен `@click="switchTab(tab.id)"` на label радиокнопок вкладок для обработки клика даже когда вкладка уже активна (HTML radio buttons не генерируют `@change` при клике на уже активную кнопку).
  * В `index.html` условия видимости компонентов используют `showSettings && activeTab === 'percent'` для `app-settings` и `!showSettings && activeTab === 'percent'` для `app-coingecko`.
- **Функциональность**: Гамбургер теперь только открывает настройки, не переключает их. Вкладка "%" всегда показывает CoinGecko и закрывает настройки при переключении. Клик на вкладку "%" работает даже когда она уже активна, исправляя баг с невозможностью переключения после открытия настроек через гамбургер.

### Коммит: "Fix settings visibility from any tab and add activeTab persistence"
- **Что сделано**: Исправлен баг, когда настройки не открывались при клике на гамбургер с любой вкладки кроме "%". Добавлено сохранение активной вкладки в localStorage.
- **Как сделано**:
  * В `index.html` убрано условие `activeTab === 'percent'` из `v-if` для `app-settings`, чтобы настройки показывались при `showSettings === true` независимо от активной вкладки.
  * Для `app-coingecko` оставлено условие `!showSettings && activeTab === 'percent'`, чтобы он показывался только на вкладке "%" когда настройки закрыты.
  * В `app/app-ui-root.js` добавлена загрузка сохраненной активной вкладки из localStorage при инициализации (`savedActiveTab = localStorage.getItem('activeTab')`).
  * В `app/app-ui-root.js` добавлен watch для `activeTab`, который сохраняет текущую вкладку в localStorage при изменении.
- **Функциональность**: Настройки теперь открываются при клике на гамбургер с любой вкладки, а не только с "%". Активная вкладка сохраняется в localStorage и восстанавливается при перезагрузке приложения.

## MM (математическая модель)

## Architect (архитектура, настройки)

### Коммит: "Refactor import/export to universal system and fix import bugs"
- **Что сделано**: Реализована универсальная система экспорта/импорта всех настроек проекта, удален экспорт messages (чат удален), исправлены баги с импортом (диалог выбора файла не открывался, тема не восстанавливалась).
- **Как сделано**:
  * В `ui/api/import-export.js` реализована универсальная система `collectAllSettings()`, которая автоматически собирает все настройки из localStorage, разделяя их на обычные (`regularSettings`) и обфусцированные (`secureData`).
  * Удален экспорт `messages` из формата экспорта (чат с Perplexity AI удален из интерфейса).
  * Добавлены массивы `SECURE_KEYS` (ключи обфусцированных данных) и `EXCLUDED_KEYS` (служебные ключи, не экспортируются).
  * Реализован метод `restoreAllSettings()` с поддержкой обратной совместимости форматов v1.0, v2.0 и v3.0.
  * Исправлен баг с диалогом выбора файла: `<input ref="fileInput">` перенесен из шаблона компонента `app-settings` в корневой `<div id="app">` в `index.html`, чтобы `this.$refs.fileInput` был доступен в корневом компоненте.
  * Исправлен баг с восстановлением темы: изменен порядок операций при импорте - сначала обновляется localStorage, затем Vue-свойство, чтобы watch в `cmpTheme` автоматически применил тему через `applyTheme()`.
  * В `architect.md` добавлен раздел "Расширяемая система экспорта/импорта настроек" с описанием принципов работы, правил для разработчиков, текущих настроек и примерами кода.
  * Обновлен `data-app.json` до формата v3.0 (универсальная система).
- **Функциональность**: Система экспорта/импорта теперь автоматически собирает все настройки из localStorage, не требуя изменений кода при добавлении новых настроек. При добавлении новой настройки в localStorage она автоматически попадает в экспорт/импорт. Обфусцированные данные (PIN, API-ключи) обрабатываются отдельно. Поддерживается обратная совместимость со старыми форматами. Диалог выбора файла теперь открывается корректно, все настройки (включая тему) восстанавливаются при импорте.

### Коммит: "Remove chat component registration from app-ui-root"
- **Что сделано**: Удалена регистрация компонента чата `window.cmpChat()` из `app/app-ui-root.js`, так как чат с Perplexity AI был убран из интерфейса.
- **Как сделано**:
  * В `app/app-ui-root.js` удалена строка `window.cmpChat && window.cmpChat()` из массива `parts`.
  * Добавлен комментарий `// window.cmpChat удален - чат с Perplexity AI убран из интерфейса` для ясности.
- **Функциональность**: Приложение больше не пытается зарегистрировать компонент чата, который был удален из интерфейса. Это завершает процесс удаления чата с Perplexity AI из проекта.

### Коммит: "Add automatic container marking system with avto- classes"
- **Что сделано**: Реализована система автоматической маркировки значимых контейнеров через CSS классы `avto-{Base58_8символов}` для удобной навигации в коде через DevTools и указания агенту места в разметке.
- **Как сделано**:
  * В `architect.md` добавлен раздел "Маркировка контейнеров" в секцию "Стандарты разработки" с полным описанием системы: назначение, формат маркировки (`avto-{Base58_8символов}`), правила применения (что маркировать, что не маркировать), изоляция (классы vs ID), примеры использования.
  * В `.cursorrules` добавлен пункт о маркировке контейнеров в раздел "При работе с файлами" → "HTML файлы" с ссылкой на полное описание в `architect.md` и правилами для ИИ-агента.
  * В `index.html` добавлены классы `avto-{hash}` к значимым контейнерам: корневой контейнер контента (`avto-X7pL2nQ`), основная секция `<main>` (`avto-K9mP4rT`), карточка настроек Perplexity AI (`avto-M3nP8qW`), карточка виджета CoinGecko (`avto-B7fN2kT`), информационная карточка (`avto-H5jR9vQ`).
  * Мелкие обертки (`.row`, `.col-*`, `.mb-3`, `.input-group`) и части компонентов (`.card-header`, `.card-body`) не маркируются согласно правилам.
  * JS-зависимые элементы (`id="apiKey"`, `id="model"`) остались с осмысленными ID, не используют `avto-*` классы.
- **Функциональность**: Система маркировки позволяет легко находить значимые контейнеры в DevTools по классам `avto-*` и указывать агенту место в коде через инспектор. Классы `avto-*` используются только для маркировки, не используются в JS/CSS, обеспечивая полную изоляцию от функциональности. Осмысленные ID используются только для JS-зависимых элементов.

### Коммит: "Add CoinGecko coin search with autocomplete and customizable list"
- **Что сделано**: Реализован поиск монет CoinGecko с автодополнением, замена колонки "60d %" на "14d %" и "200d %", сохранение полных данных монет в настройках, изменение логики обновления данных (только при загрузке и по кнопке).
- **Как сделано**:
  * В `ui/api/coingecko.js` заменен параметр запроса с `'1h,24h,7d,30d,60d'` на `'1h,24h,7d,14d,30d,200d'` для получения данных о процентных изменениях за 14 и 200 дней.
  * В `index.html` заменен заголовок таблицы "60d %" на "14d %" и "200d %", colspan ячеек обновлен с 8 на 9, добавлены соответствующие ячейки для отображения `price_change_percentage_14d_in_currency` и `price_change_percentage_200d_in_currency`.
  * В `ui/api/coingecko.js` добавлена инициализация данных из localStorage при монтировании компонента (`cgCoins`, `cgLastUpdated`, `cgSelectedCoins`).
  * При успешном запросе к API данные сохраняются в localStorage (`cgCoins`, `cgLastUpdated`, `cgSelectedCoins`).
  * Изменена логика в `mounted()`: данные загружаются только если `cgCoins.length === 0`, обеспечивая загрузку при старте только если нет сохраненных данных.
  * Список монет для запроса теперь берется из `cgSelectedCoins` вместо хардкодного списка `ids`, что позволяет пользователю настраивать список через поиск.
  * Добавлен метод `searchCoins(query)` для поиска монет через CoinGecko API `/search?query=...` с ограничением на 10 результатов.
  * Добавлен метод `addCoin(coinId)` для добавления монеты в `cgSelectedCoins` и обновления данных.
  * Добавлен метод `removeCoin(coinId)` для удаления монеты из списка.
  * Добавлен watch для `cgSearchQuery` с задержкой 500ms для автоматического поиска при вводе.
  * В `index.html` заменен заголовок "Топ-10 (CoinGecko)" на поле поиска с автодополнением (`input` с `v-model="cgSearchQuery"`, выпадающий список результатов с `v-for="result in cgSearchResults"`).
  * Первая колонка таблицы заменена с `#` на кнопку удаления монеты (`btn-outline-danger` с иконкой `fa-times` и `@click="removeCoin(coin.id)"`).
  * Кнопка "Обновить" теперь отображает только иконку обновления (`fa-sync-alt`) без текста, чтобы освободить место для поиска.
  * В `architect.md` обновлен раздел "Расширяемая система экспорта/импорта настроек" с упоминанием данных CoinGecko (`cgCoins`, `cgLastUpdated`, `cgSelectedCoins`).
- **Функциональность**: Пользователь может искать монеты по названию или тикеру (включая опечатки через API CoinGecko `/search`), добавлять их в список кликом на результат поиска, удалять монеты из списка через кнопку с иконкой крестика. Полные данные монет (включая список выбранных монет) автоматически сохраняются в localStorage и восстанавливаются при загрузке. Данные обновляются только при первой загрузке (если нет сохраненных) или по явному нажатию кнопки "Обновить", не обновляются при нажатии Refresh в хедере. Таблица отображает процентные изменения за 1h, 24h, 7d, 14d, 30d, 200d (вместо 60d).

### Коммит: "Create guide-ii.md and integrate with project documentation"
- **Что сделано**: Создан файл `ui/guide-ii.md` с двумя секциями (Interface и Interaction), интегрирован с `architect.md` и `.cursorrules`, исправлены несогласованности в документации, добавлены правила контроля качества и сопровождения документации.
- **Как сделано**:
  * Создан файл `ui/guide-ii.md` с секциями "Interface (оформление)" и "Interaction (паттерны UX)" на основе текущего состояния проекта (компоненты, стили, паттерны взаимодействия).
  * В `architect.md` заменены полные описания разделов UI и MM на ссылки на соответствующие документы (`ui/guide-ii.md` для UI/UX, `architect.md` для MM).
  * В `architect.md` добавлен раздел "Отслеживание согласованности архитектурных правил" с упоминанием всех трех документов.
  * В `.cursorrules` обновлено правило обработки команд UI:/UX:/MM: - команды UI: и UX: теперь обновляют разделы в `ui/guide-ii.md`, команда MM: обновляет раздел в `architect.md`.
  * Исправлены несогласованности: добавлен `ui/guide-ii.md` в раздел "Текущее размещение файлов" и "Структура проекта" в `architect.md`, исправлено дублирование папки `ui/` в структуре проекта, добавлены недостающие файлы (`header.js`, `footer.js`).
  * В `ui/guide-ii.md` добавлен раздел "Связанные документы" со ссылками на все три документа проекта.
  * В `.cursorrules` добавлен раздел "Сопровождение документации проекта" с правилами обновления документации при изменениях в проекте (список документов: `.cursorrules`, `architect.md`, `ui/guide-ii.md`, исключение: папка `docs/`).
  * В `.cursorrules` добавлен раздел "Контроль качества выполнения" в начало файла с требованием проверки соответствия документации после каждой задачи и самостоятельного исправления ошибок.
  * Усилено правило о тщательной проверке согласованности: добавлено требование проверять документацию насквозь, а не "кусками", обновлять структуру проекта при изменениях, не допускать дублирования.
- **Функциональность**: Документация проекта теперь разделена по специализациям: `architect.md` содержит архитектурные решения и принципы MM, `ui/guide-ii.md` содержит принципы интерфейса и паттерны взаимодействий, `.cursorrules` содержит правила работы ИИ-агента. Все документы связаны между собой и согласованы. ИИ-агент теперь обязан контролировать качество выполнения задач и поддерживать актуальность документации.

