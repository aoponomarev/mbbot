# Дневной лог разработки - 2025-12-09

## UI (оформление)

### Коммит: Improve footer mobile height for better touch interaction
- **Что сделано**: Увеличена высота футера на мобильных устройствах примерно в 3 раза для удобства нажатия пальцем.
- **Как сделано**:
  * В `index.html` изменен padding футера с `p-2` на `p-5 p-md-2` (на мобильных `p-5` ≈ 48px, на десктопе `p-2` ≈ 8px).
  * Разделены версии для мобильных и десктопа: десктопная версия обернута в `d-none d-md-inline small` (скрыта на мобильных, показана на десктопе с маленьким шрифтом), мобильная версия обернута в `d-block d-md-none` (показана на мобильных, скрыта на десктопе, без `small`).
- **Функциональность**: На мобильных устройствах футер стал значительно выше, что делает его более удобным для нажатия пальцем. На десктопе высота и стили остались без изменений.

### Коммит: Add footer with market indices and framework versions
- **Что сделано**: Создан компонент футера с индексами рынка и версиями фреймворков, вынесен модуль получения метрик рынка в отдельный файл, добавлены цветовые состояния иконок, реализована адаптивность для мобильных устройств.
- **Как сделано**:
  * Создан компонент `ui/interaction/footer.js` с Vue-компонентом футера, использующим x-template шаблон.
  * Создан модуль `ui/api/market-metrics.js` для получения метрик рынка (FGI, VIX, BTC Dominance, OI, FR, LSR) из внешних API, экспортирует функции через `window.marketMetrics`, включает утилиты `clamp()` и `safeNumber()`, метод `fetchAll()` для загрузки всех метрик одновременно.
  * В `index.html` добавлен x-template для футера с `position-fixed` внизу экрана, тень сверху, фон соответствует теме через `bg-body`.
  * Добавлены индексы рынка: FGI (Fear & Greed Index), VIX (Volatility Index), BTC Dominance, Open Interest, Funding Rate, Long/Short Ratio с иконками Font Awesome.
  * Реализованы цветовые состояния иконок через computed properties: BTC (цветная если доминирует >50%, серая если нет), FGI (красный 0-25, оранжевый 26-45, серый 46-55, зеленый 56-75, яркий зеленый 76-100), VIX (зеленый <20, серый 20-30, красный >30), FR (зеленый отрицательный, серый нейтральный, красный положительный), LSR (красный <1.0, серый =1.0, зеленый >1.0), OI (всегда серый).
  * BTC иконка вынесена первой в списке индексов.
  * Ширина ячеек изменена на `col-auto` для распределения по контенту, убрана вертикальная линия между секциями, все индикаторы объединены в один контейнер с `justify-content-between` для равномерного распределения.
  * Добавлена адаптивность: на десктопе (`d-md-flex`) показываются все индикаторы, на мобильных (`d-flex d-md-none`) только метрики рынка с горизонтальной прокруткой (`overflow-x-auto`, `-webkit-overflow-scrolling: touch`), версии фреймворков скрыты на мобильных.
  * В `architect.md` удален избыточный слой `data-sources/`, обновлен поток данных, добавлен `ui/api/market-metrics.js` в список файлов.
  * Компонент зарегистрирован в `app-ui-root.js` как `app-footer`, подключен скрипт в `index.html`.
- **Функциональность**: Футер зафиксирован внизу экрана и не дергается при прокрутке. Индексы рынка обновляются автоматически каждые 5 минут после разблокировки приложения. Цветовые состояния иконок визуально показывают состояние рынка (страх/жадность, волатильность, настроения трейдеров). На мобильных устройствах футер адаптируется: показываются только метрики рынка с возможностью горизонтальной прокрутки, версии фреймворков скрыты для экономии места. Модуль market-metrics переиспользуемый и может использоваться в других компонентах.

### Коммит: Add system language detection and simplify quote to single philosophical-predictive sentence
- **Что сделано**: Добавлено определение языка системы для генерации философского предложения на языке пользователя, упрощена структура предложения: одно предложение вместо двух (начинается с философии, заканчивается предсказанием для пользователя в другой сфере жизни).
- **Как сделано**:
  * В `ui/interaction/splash.js` добавлено определение языка системы через `navigator.language`, извлечение кода языка (например, "ru" из "ru-RU"), создан маппинг кодов языков на названия (ru→Russian, en→English, de, fr, es, it, pt, ja, zh, ko), добавлены поля `systemLanguage` и `targetLanguage` в data компонента.
  * Обновлен промпт для Perplexity API: добавлено требование генерировать на языке системы (`in ${this.targetLanguage}`), изменена структура с двух предложений на одно (философское размышление + предсказание для пользователя), объем увеличен до ~40 слов (не жестко, приоритет красоте и смыслу), предсказание должно быть в другой сфере жизни (медицина, экономика, отношения, образование, карьера, здоровье, семья, личностный рост, творчество, духовность), предсказание адресовано пользователю ("you", "your").
  * Упрощен парсинг ответа: убрана логика разделения на два предложения, теперь просто одно предложение.
  * В `index.html` убрано отображение `prediction` из шаблона.
- **Функциональность**: Философское предложение теперь генерируется на языке системы пользователя, что делает его более понятным и близким. Структура упрощена до одного предложения, которое начинается с философского размышления о коммите и заканчивается позитивным предсказанием для пользователя в другой сфере жизни, что делает сообщение более личным и вдохновляющим. Экономия API-запросов: один запрос вместо двух.

### Коммит: Improve splash screen loading indicator and API key field styling
- **Что сделано**: Улучшен индикатор загрузки цитаты на сплэш-экране (заменен спиннер на анимированные точки), установлен рекомендуемый объем философского предложения (30 слов), улучшена стилизация поля ввода API-ключа (скрыто до фокуса).
- **Как сделано**:
  * В `ui/interaction/splash.js` добавлены `loadingDots` и `loadingDotsInterval` в data компонента, реализованы методы `startLoadingDots()` и `stopLoadingDots()` для циклической анимации точек (1,2,3,4,5), добавлено computed свойство `loadingDotsString` для генерации строки точек, добавлена очистка интервала в `beforeUnmount`.
  * Обновлен промпт для Perplexity API: добавлено требование "approximately 30 words (not less than 25, not more than 35)" для философского предложения.
  * В `index.html` убран блок с текстом "Ищем цитату..." и спиннером, заменен на индикатор точек после имени коммита (`{{ loadingDotsString }}`), убрана черта под цитатой (удален `border-top border-secondary`).
  * Поле ввода API-ключа: убран класс `bg-dark`, добавлено динамическое управление `backgroundColor` (transparent по умолчанию, `var(--bs-dark)` при фокусе), добавлено управление `borderColor` (transparent по умолчанию, `var(--bs-secondary)` при фокусе), сохранена полупрозрачность текста (opacity: 0.5) до фокуса.
  * Текст "Perplexity API Key (optional):" заменен на "API:" с подсказкой `title="Perplexity API Key"`.
- **Функциональность**: Индикатор загрузки стал более минималистичным и элегантным (анимированные точки вместо спиннера). Поле ввода API-ключа полностью скрыто (прозрачный фон, прозрачная рамка, полупрозрачный текст) до получения фокуса, что делает интерфейс чище. Философские предложения теперь имеют рекомендуемый объем около 30 слов для оптимальной читаемости.

### Коммит: Add header component with model selector and display tabs, fix theme toggle
- **Что сделано**: Создан компонент хэдера приложения с гамбургер-меню, селектом математической модели, вкладками отображения и кнопками управления, исправлена работа переключалки темы для рабочей области и футера.
- **Как сделано**:
  * Создан компонент `ui/interaction/header.js` с Vue-компонентом хэдера, использующим x-template шаблон.
  * В `index.html` добавлен x-template для хэдера с тремя секциями: левая (гамбургер-меню), средняя (селект математической модели и вкладки отображения), правая (кнопки управления: переключение темы и обновление страницы).
  * Гамбургер-меню реализован через inline SVG для пиксельно-четкого отображения (24x24px, stroke-width: 2, stroke: currentColor).
  * Селект математической модели: выбор между "Медиана" и "Новости", полупрозрачная стрелка через data URI SVG, минимальный зазор (8px) между селектом и вкладками.
  * Вкладки отображения реализованы как Bootstrap радиокнопки (`btn-group`, `btn-check`, `btn-outline-secondary`): %, Компл. дельты, Градиенты MAX, min, Баланс Δ. Активная вкладка выделена цветом текста (`text-white`), при наведении подсвечивается фоном (`rgba(255, 255, 255, 0.1)`). Динамическое применение `rounded-start` и `rounded-end` для первой и последней вкладок.
  * Кнопки управления: переключение темы (Font Awesome иконки `fa-moon`/`fa-sun`) и обновление страницы (Font Awesome иконка `fa-refresh`).
  * Исправлена работа переключалки темы: в `header.js` методы `toggleTheme()` и `refreshPage()` используют `this.$root` для доступа к корневому компоненту, добавлен fallback `window.appRoot` в `app-ui-root.js` для хранения экземпляра приложения, добавлен `watch` на `$root.theme` для реактивности computed свойств.
  * Хэдер всегда в темной теме (не реагирует на переключалку темы), использует `bg-dark` и `text-white`.
  * Компонент зарегистрирован в `app-ui-root.js` как `app-header`, подключен скрипт в `index.html` после Bootstrap JS и перед Vue.js (для корректной загрузки x-template).
- **Функциональность**: Хэдер предоставляет централизованный доступ к основным функциям приложения: выбор математической модели, переключение режимов отображения данных, управление темой и обновление страницы. Гамбургер-меню готов для будущего бокового меню. Переключалка темы теперь корректно работает для всей рабочей области и футера. Хэдер зафиксирован вверху экрана и не реагирует на переключение темы (всегда темный).


## MM (математическая модель)

### Коммит: Align market metrics variables with source for mathematical model compatibility
- **Что сделано**: Приведены переменные метрик рынка в соответствие с первоисточником для использования в математической модели, добавлены глобальные переменные и экспорт в `window`.
- **Как сделано**:
  * В `ui/api/market-metrics.js` добавлены глобальные переменные: `fgiVal`, `vixVal`, `btcDomVal`, `oiVal`, `frVal`, `lsrVal` (числовые значения), `vixAvailable` (boolean флаг доступности VIX).
  * Добавлена функция `updateWindowMetrics()` для экспорта всех числовых значений в `window` (совместимость с первоисточником).
  * Добавлен третий источник VIX (Alpha Vantage) в fallback стратегию получения VIX.
  * Исправлено форматирование Open Interest: теперь `'$' + oiVal.toFixed(2)` вместо `'$' + (value / 1e9).toFixed(2) + 'B'` (как в первоисточнике).
  * Все функции теперь возвращают `numericValue` помимо форматированной строки для отображения.
  * Глобальные переменные инициализируются при загрузке модуля через `updateWindowMetrics()`.
- **Функциональность**: Переменные метрик рынка теперь полностью совпадают с первоисточником и доступны в `window` для использования в математической модели. Все числовые значения (`window.fgiVal`, `window.vixVal`, `window.btcDomVal`, `window.oiVal`, `window.frVal`, `window.lsrVal`, `window.vixAvailable`) экспортируются и обновляются при каждом запросе метрик. Это обеспечивает совместимость с математической моделью, которая будет использовать эти переменные для расчетов.

## Architect (архитектура, настройки)

### Коммит: Add rule for handling files outside project scope
- **Что сделано**: Добавлено правило в `.cursorrules` о работе с файлами за пределами проекта, чтобы предотвратить случайное редактирование файлов из других проектов.
- **Как сделано**:
  * В `.cursorrules` добавлен раздел "⚠️ КРИТИЧЕСКИ ВАЖНО - Работа с файлами за пределами проекта" в секцию "Общая информация о проекте".
  * Определено, что файлы за пределами проекта (вне папки `D:\Clouds\AO\OneDrive\Portfolio - CV\Refactoring\ToDo\Statistics\BOT`) рассматриваются только как примеры кода для понимания логики или структуры.
  * Добавлены запреты: никогда не редактировать, не изменять, не коммитить файлы за пределами проекта, никогда не добавлять файлы из других проектов в staging или коммиты текущего проекта.
  * Уточнено, что при использовании кода из файлов других проектов - только читать их для понимания, затем реализовывать аналогичную логику в файлах текущего проекта.
  * Указано, что если пользователь предоставляет файл из другого проекта - это пример для изучения, а не для редактирования.
- **Функциональность**: Правило предотвращает случайное редактирование файлов из других проектов, которые пользователь может предоставить как примеры кода. ИИ-агент теперь четко понимает, что файлы за пределами проекта используются только для изучения и понимания логики, а не для редактирования. Это защищает другие проекты от непреднамеренных изменений.

### Коммит: Restructure UI components into api/interaction folders
- **Что сделано**: Реструктурирована организация UI компонентов: переход от плоской структуры `ui/components/` к иерархической структуре по специализациям `<сектор>/<специализация>/<имя>.<ext>`, удалены префиксы `c-ui-` из имен файлов.
- **Как сделано**:
  * Созданы папки специализации: `ui/api/` (компоненты для работы с внешними API), `ui/interaction/` (компоненты взаимодействия с пользователем).
  * Перемещены и переименованы файлы: `c-ui-import-export.js` → `ui/api/import-export.js`, `c-ui-perplexity-settings.js` → `ui/api/perplexity.js`, `c-ui-coingecko.js` → `ui/api/coingecko.js`, `c-ui-splash.js` → `ui/interaction/splash.js`, `c-ui-theme.js` → `ui/interaction/theme.js`, `c-ui-chat.js` → `ui/interaction/chat.js`.
  * Обновлены пути к скриптам в `index.html` (строки 359-364).
  * Обновлен `architect.md`: удален раздел про префиксы файлов, обновлена структура папок, добавлено описание структуры по специализациям.
  * Удалена пустая папка `ui/components/`.
- **Функциональность**: Структура проекта теперь организована по специализациям, что улучшает навигацию и логическую группировку файлов. Папки специализации создаются по мере накопления файлов родственного назначения, имена файлов без префиксов (специализация понятна из пути папки).


### Коммит: Move architectural rules to architect.md and improve Markdown preview
- **Что сделано**: Перенесены архитектурные правила из `.cursorrules` в `architect.md`, добавлена настройка для автоматического открытия Markdown файлов в режиме preview, улучшено форматирование путей в архитектурном плане.
- **Как сделано**:
  * В `architect.md` добавлены разделы: "Стандарты разработки" (кодировка, окончания строк, HTML, стилизация), "Технические ограничения" (порядок загрузки x-template, размещение компонентов, внешние запросы), "Принципы разработки" (UI и MM разделы для добавления принципов по командам), "Обратная совместимость данных" (правило с примерами), обновлена "Структура проекта" с учетом новой организации папок.
  * В `.cursorrules` заменены архитектурные разделы на ссылки на соответствующие разделы в `architect.md`, добавлено правило отслеживания согласованности между двумя файлами, обновлена обработка команд UI:/UX:/MM: для обновления разделов в `architect.md`.
  * В `.vscode/settings.json` добавлена настройка `workbench.editorAssociations` для автоматического открытия Markdown файлов в режиме preview (`*.md` → `vscode.markdown.preview.editor`).
  * В `architect.md` обновлено форматирование путей в разделе "Текущее размещение файлов": пути выделены жирным шрифтом для лучшей читаемости.
- **Функциональность**: Архитектурные правила теперь централизованы в `architect.md`, что упрощает их поддержку и обновление. `.cursorrules` содержит только правила поведения ИИ-агента со ссылками на архитектуру. Markdown файлы автоматически открываются в режиме preview для удобного просмотра форматированного текста. Улучшена читаемость архитектурного плана за счет выделения путей файлов.


### Коммит: Add Architect section to daily logs and create docs folder
- **Что сделано**: Добавлена секция Architect в структуру дневных логов, проведена ревизия всех существующих логов с перемещением записей, связанных с архитектурой и настройками, создана папка `docs/` для справочных материалов, добавлено упоминание о будущей секции DOCS.
- **Как сделано**:
  * В `.cursorrules` обновлено описание структуры дневного лога: добавлена секция Architect (архитектура, настройки), упомянута будущая секция DOCS (документация).
  * Проведена ревизия всех дневных логов (12-06, 12-07, 12-08, 12-09): добавлена секция Architect, перемещены записи, связанные с настройками `.cursorrules`, `.vscode/settings.json`, регламентами коммитов, структурой проекта, архитектурными изменениями.
  * В пустые секции MM добавлены пометки об отсутствии изменений.
  * Создана пустая папка `docs/` в корне проекта для будущих справочных материалов.
  * Обновлена история изменений предпочтений в `.cursorrules`.
- **Функциональность**: Дневные логи теперь имеют четкую структуру по категориям (UI, UX, MM, Architect), что упрощает навигацию и поиск информации. Все записи, связанные с архитектурой и настройками, централизованы в секции Architect. Папка `docs/` готова для размещения справочных материалов. Структура логов готова к добавлению секции DOCS в будущем.


### Коммит: Add rule for working with source variables and code comments
- **Что сделано**: Добавлено правило в `.cursorrules` о работе с переменными первоисточников и комментировании кода при переносе из других проектов.
- **Как сделано**:
  * В `.cursorrules` в раздел "Текущие предпочтения пользователя" добавлено правило: использовать переменные первоисточников в приоритете, при конфликтах имен сообщать пользователю подробно, но разумно, подробно (но разумно) переносить комментарии первоисточников, всегда подробно комментировать переменные при их объявлении (о сущности и предназначении).
  * Добавлена запись в "Историю изменений предпочтений" с датой 2025-12-09 и описанием правила.
- **Функциональность**: Правило обеспечивает согласованность при переносе кода из первоисточников, сохраняя имена переменных и комментарии, что важно для совместимости с математической моделью и понимания кода другими разработчиками или ИИ-агентами.


### Коммит: Complete daily log entries and enforce full documentation before commit
- **Что сделано**: Добавлены недостающие записи в дневной лог для коммита "Improve footer mobile height and align market metrics with source", усилено правило о полном описании всех изменений в дневном логе перед коммитом.
- **Как сделано**:
  * В `history/2025/12-09.txt` добавлена запись для MM (математическая модель) с описанием выравнивания переменных метрик рынка с первоисточником.
  * В `history/2025/12-09.txt` добавлена запись для Architect с описанием правила работы с переменными первоисточников.
  * В `.cursorrules` в раздел "ШАГ 2: Записать в дневной лог" добавлено критически важное требование: в дневной лог должны быть внесены **ВСЕ** изменения из коммита. Если в коммите несколько изменений (например, UI, MM, Architect), то каждое изменение должно быть описано в соответствующей секции дневного лога. **НЕ создавать коммит, пока все изменения не описаны в дневном логе!**
- **Функциональность**: Дневной лог теперь содержит полное описание всех изменений из коммита, что обеспечивает полную прослеживаемость изменений. Правило гарантирует, что ИИ-агент не будет создавать коммиты с неполным описанием изменений, что важно для понимания истории разработки другим ИИ-агентом или разработчиком.

### Коммит: Add documentation style rule and revise jargon in project documentation
- **Что сделано**: Добавлено правило о стиле документации для ИИ-агентов в `.cursorrules`, проведена полная ревизия жаргона в `.cursorrules` и `architect.md` с заменой сомнительных фраз на профессиональную терминологию.
- **Как сделано**:
  * В `.cursorrules` добавлен раздел "⚠️ Стиль документации для ИИ-агентов" в начало файла с правилами: использовать профессиональную точную терминологию, избегать жаргона и сомнительных фразеологизмов, не копировать дословно неформальные выражения пользователя, переформулировать просьбы в профессиональные технические формулировки.
  * Проведена ревизия жаргона в `.cursorrules`: "Минимизация кастомности, упор на Bootstrap" → "Приоритет Bootstrap утилит над пользовательскими стилями", "болтаются просто так" → "присутствуют в проекте без явной необходимости", "просто так" → "без явной необходимости", "догоняния хешей" → "синхронизации хешей", "меньше воды" → "приоритет конкретным фактам над избыточными описаниями", "кастомные стили" → "пользовательские стили" (везде, кроме примера в правилах), "ненужных файлов" → "неиспользуемых файлов".
  * Проведена ревизия жаргона в `architect.md`: "данные тянем" → "данные получаем".
  * Добавлена запись в "Историю изменений предпочтений" в `.cursorrules` с датой 2025-12-09 и описанием правила о стиле документации.
- **Функциональность**: Документация проекта теперь использует профессиональную точную терминологию, что делает её более понятной для ИИ-агентов и разработчиков. Правило о стиле документации гарантирует, что будущие обновления документации будут следовать профессиональным стандартам, избегая жаргона и неформальных выражений. Документация предназначена для ИИ-агентов, а не для пользователя, поэтому требует точной и однозначной лексики.

