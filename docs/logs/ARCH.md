# Архитектура, структура файлов/компонентов, js/api/io

## Коммит от 21.12.2025 : Fix file counting and restore chart with GitHub data
◆ Исправлен подсчет файлов из GitHub и восстановлена диаграмма типов файлов. → Переписана функция `scanAllFilesIndependent()` для использования `ReviewDataPipeline.getFileIndex({ skipFS: true })` вместо хардкода, что обеспечивает получение данных из Git-репозитория (GitHub или DepGraph). Исправлена проблема с подсчетом файлов из `docs/`: удалены все запреты на `docs/` из `shouldExcludePath()` и `buildDepGraphIndex()`, добавлено явное включение всех файлов из `docs/` и `ui/styles/` в DepGraph индекс. Исправлена обработка ошибок чтения файлов: теперь даже при ошибке чтения файл добавляется в результаты с нулевыми значениями, что гарантирует учет всех файлов из индекса. Восстановлена диаграмма типов файлов (`renderFileTypesChart()`) с использованием данных из GitHub через `scanAllFilesIndependent()`. Добавлен popover при клике на карточку "Файлов" (слева от диаграммы), показывающий ту же таблицу типов файлов. Убрана линия под последней строкой таблицы в popover через добавление `!important` к правилу CSS. Удален неиспользуемый файл `ui/styles/chat.css`. ◉ Исправление подсчета файлов через использование Git-репозитория как источника данных демонстрирует приоритет точности над удобством: данные из репозитория более надежны, чем локальная файловая система. Восстановление диаграммы с новыми данными показывает итеративный подход к разработке: удаление и последующее восстановление с улучшениями позволяет переосмыслить архитектуру. Явное включение файлов из `docs/` и `ui/styles/` в DepGraph индекс решает проблему неполноты данных при использовании dependency graph.

## Коммит dc67625 от 20.12.2025 : Integrate independent file counting and dynamic badge coloring in review stats
◆ Интегрирован независимый метод подсчета файлов во все компоненты статистики review-страниц и реализована динамическая раскраска бейджей. → Все методы статистики (`renderMainStats()`, `renderFilesRanking()`, `renderFileTypesChart()`) переведены на использование `scanAllFilesIndependent()` вместо устаревшего `scanStats()` и `loadFilesData()`. Удалены методы `scanStats()`, `loadFilesData()`, `showStatsProgress()`, `hideStatsProgress()`, инициализация `codeStats: null`. Реализована динамическая раскраска бейджей в таблице рейтинга файлов: добавлен метод `getTypeColor()`, бейджи окрашиваются в цвета секторов диаграммы типов файлов (`this.fileTypesColors`), если тип файла представлен в диаграмме, иначе остаются серыми. Цвета диаграммы сохраняются в `this.fileTypesColors` для использования в бейджах. ◉ Независимый метод подсчета файлов обеспечивает точность статистики независимо от ограничений DepGraph и других источников данных. Динамическая связь цветов бейджей с диаграммой создает визуальную согласованность интерфейса: пользователь сразу видит соответствие между типами файлов на диаграмме и в таблице.

## Коммит 8e28b75 от 18.12.2025 : Refine Git workflow rules and header layout
◆ Формализован регламент работы с Git для ИИ-агента и настроено игнорирование служебных папок. → Переструктурирован раздел `.cursorrules` по работе с Git (регламент, протоколы "комить"/"закомить", "новый рабочий день", "завершаем день"). Добавлен `.cursorignore` с исключением `docs/` и `old_app_not_write/` из анализа и коммитов. ◉ Формализация регламента работы с Git заложила стандартизированные процессы: четкие протоколы для типовых операций (коммиты, начало/завершение дня) обеспечивают консистентность и предсказуемость работы с репозиторием. Использование `.cursorignore` демонстрирует принцип изоляции: служебные папки исключены из анализа ИИ-агентом, предотвращая их случайное редактирование или коммит, что критично для защиты личных данных и примеров кода.

## Коммит ce93b3d от 17.12.2025 : Sync documentation with current review pipeline and settings
◆ Приведена документация и настройки workspace в соответствие с фактическим состоянием проекта. → В `architect.md` добавлен раздел про единую DOM‑структуру всех review‑страниц и зафиксирован контракт `body → #app.container-fluid → контент` для интеграции с `ui/review-manager.js` и `ui/review-styles.css`. В `tools/review-data.md` обновлено описание сканера `scanStats` (актуальный список расширений `js/css/html/json/md/txt/rst/adoc`, исключаемые пути и использование ReviewDataPipeline). В `ui/guide-ii.md` уточнены описания каталогов иконок и цветов (`review-icons.html`, `review-colors.html`) с учётом новых категорий и фильтров (Statuses & Indicators, Frameworks & Brands, Primary/Info/Success/Warning/Danger и др.). В `.vscode/settings.json` и `.vscode/tasks.json` обновлены параметры автозагрузки рабочего файла: теперь при старте workspace открывается `docs/заметки.txt` вместо `docs/TODO.TXT`. ◉ Фиксация DOM-контракта для review-страниц заложила стандарт интеграции: единая структура обеспечивает корректную работу всех review-инструментов и упрощает создание новых review-страниц. Синхронизация документации с фактическим состоянием демонстрирует принцип "живой документации": правила для ИИ-агента и разработчиков должны отражать реальность, а не устаревшие представления. Это критично для эффективной работы и предотвращения ошибок из-за рассинхронизации.

## Коммит 4fe3082 от 17.12.2025 : Unify system messages and harden review data pipeline
◆ Проведена миграция системы сообщений и укреплён слой данных review‑страниц. → Завершена консолидация отображения системных сообщений через глобальное хранилище `window.AppMessages` и Vue‑компонент `<system-messages>` для основных контекстов (`global`, `splash`, `settings`, `coins`, review`). Удалены временные блоки инструментальной логгирования и устаревший DOM‑рендер алертов там, где их заменил единый компонент сообщений. Доработан `ReviewDataPipeline`: уточнён fallback‑chain источников (FS → GitHub → DepGraph → Cache), усилена проверка актуальности кэша и обработка ошибок. ◉ Создана единая система управления системными сообщениями: глобальное хранилище `window.AppMessages` и универсальный компонент обеспечивают консистентность отображения сообщений во всех контекстах приложения. Это демонстрирует принцип централизации состояния: все сообщения управляются из одного места, упрощая поддержку и обеспечивая единообразие. Укрепление review data pipeline через fallback-цепочку источников показывает подход к надежности: система деградирует gracefully, переключаясь на альтернативные источники данных при недоступности основных.

## Коммит aaef828 от 15.12.2025 : Review system: statistics page and UI improvements
◆ Создана страница статистики проекта `review-app.html` с рейтингом файлов, диаграммами и метриками, перенесен код статистики из `review-app-stats.js` в `ui/review-manager.js`, обновлена система review-файлов, улучшена визуализация диаграмм, обновлены стили review-файлов, обновлены настройки VS Code. → Создан `review-app.html` с карточками статистики, диаграммами и таблицами. Модуль `ProjectStats` добавлен в `ui/review-manager.js` с функциями подсчета строк кода, загрузки данных, отображения диаграмм. Обновлен `REVIEW_CONFIG` в `review-manager.js`: добавлена вкладка "Статистика" как первая вкладка. Реализована логика определения корневых папок и подпапок UI для диаграммы распределения контента. Обновлены стили в `review-styles.css`: убраны `box-shadow` и `outline`, изменены стили вкладок (синие названия, активная вкладка - серый градиент). Добавлена инициализация Bootstrap Popover для карточек статистики. Обновлен `.vscode/settings.json`: добавлены настройки `workbench.editor.enablePreview`, `workbench.editor.openPositioning`, `workbench.editor.splitOnDragAndDrop`. Обновлена документация в `architect.md` и `ui/guide-ii.md` о review-системе. Переименованы `icons-review.html` → `review-icons.html`, `colors-review.html` → `review-colors.html`. ◉ Создана инструментальная система для анализа проекта: статистика с визуализацией распределения контента и рейтингом файлов служит как инструмент разработки, помогая понимать структуру и размеры кодовой базы. Консолидация кода статистики в `review-manager.js` демонстрирует принцип модульности: связанная функциональность объединена в одном месте, упрощая поддержку. Унификация именования review-файлов (`review-*`) показывает системный подход к организации инструментов разработки.

## Коммит 16a2e4f от 15.12.2025 : Add alert-message component and review-messages page, fix close button for dark theme
◆ Создан компонент `alert-message.js`, создана страница `review-messages.html`, исправлен крестик закрытия для темной темы, обновлена документация. → Создан `ui/components/alert-message.js` с props: type, dismissible, small, show, customClass. Компонент управляет своей видимостью через внутреннее состояние `showAlert` при `dismissible=true`. Создан `ui/interaction/review-messages.html` с двумя карточками: Light Theme и Dark Theme. В шаблонах заменен `cmp-button` на обычную кнопку с inline SVG крестиком. SVG использует `stroke="currentColor"` для наследования цвета от родителя. Добавлены стили в `layout.css`: приглушенные цвета для alert-info и alert-warning, flex-раскладка с gap для контейнера сообщений. Цвет крестика использует `var(--bs-body-color)` для автоматической адаптации к теме ближайшего родителя. Удалены все блоки `#region agent log` и fetch запросы из `button.js` и `alert-message.js`. Добавлено ограничение `max-width: 1024px` для `.container-fluid` в `review-styles.css`. Обновлена документация в `architect.md` и `ui/guide-ii.md`. ◉ Создан переиспользуемый компонент для системных сообщений: инкапсуляция логики отображения и закрытия в отдельном компоненте упрощает использование во всех частях приложения. Использование `currentColor` для SVG демонстрирует подход к адаптивности: иконка автоматически наследует цвет текста, обеспечивая визуальную согласованность без дополнительных стилей. Приглушенные цвета для alert-сообщений показывают баланс между заметностью и навязчивостью: информация важна, но не должна доминировать в интерфейсе.

## Коммит 292108b от 15.12.2025 : Header: fix theme inheritance and remove tooltips
◆ Удалены все tooltips из хедера приложения, зафиксирована темная тема для всех элементов хедера, оптимизировано наследование темы, обновлена документация о системе иконок. → Удален метод `initTooltips()` и все связанные с tooltips код из `ui/interaction/header.js`. Удалены атрибуты `title` из шаблона хедера и компонента `horizon-input`. Добавлен `data-bs-theme="dark"` к элементу `<header>` в шаблоне хедера. Удалены явные `data-bs-theme="dark"` из дочерних элементов (dropdown меню, horizon-input). Обновлена логика `themeAttribute` в `dropdown-menu.js`: для dropdown в хедере (по instanceId) всегда возвращается 'dark'. Добавлена команда "stablecoins" с иконкой `fas fa-coins` в `ui-element-mapping.json` и встроенное содержимое в `ui-element-helper.js`. Обновлена документация в `architect.md` и `ui/guide-ii.md` о встроенном содержимом системы иконок. ◉ Изоляция хедера в темной теме создает визуальную границу между навигационным слоем и контентом, подчеркивая его роль как управляющего элемента. Автоматическое наследование темы через каскадность CSS показывает эффективное использование возможностей фреймворка: один атрибут на корневом элементе управляет всей поддеревом, упрощая поддержку. Удаление tooltips демонстрирует принцип минимализма: если элементы интерфейса интуитивно понятны, дополнительные подсказки избыточны.

## Коммит f2e566f от 14.12.2025 : Add docs/ to gitignore and remove from index
◆ Добавлена папка `docs/` в `.gitignore` и удалены все файлы из `docs/` из индекса Git. → Добавлено правило `docs/` в `.gitignore` с комментарием "Папка с личными заметками и черновиками (не коммитится)". Удалены из индекса Git все файлы из папки `docs/`: `docs/77.json`, `docs/TODO.TXT`, `docs/data-app.json`. Файлы остались на диске, но больше не отслеживаются Git. ◉ Исключение папки `docs/` из версионного контроля закрепляет разделение между личными заметками и основной документацией проекта: черновики и временные файлы не должны попадать в репозиторий, что поддерживает чистоту истории и предотвращает коммит личных данных. Это демонстрирует принцип осознанного управления репозиторием: только релевантные для проекта файлы отслеживаются Git.

## Коммит ce93b3d от 14.12.2025 : Rename coingecko.js to coins-manager.js and update documentation
◆ Переименован файл `ui/api/coingecko.js` в `ui/api/coins-manager.js`, обновлены все ссылки в документации и коде, исправлены несоответствия. → Переименован файл `ui/api/coingecko.js` → `ui/api/coins-manager.js`. Переименован компонент `window.cmpCoinGecko` → `window.cmpCoinsManager`. Обновлен template ID `#coingecko-template` → `#coins-manager-template`. Обновлено имя компонента в шаблоне `app-coingecko` → `app-coins-manager`. Обновлена регистрация компонента в `app-ui-root.js`. Обновлены все упоминания в `architect.md`: `ui/api/coingecko.js` → `ui/api/coins-manager.js`. Обновлены все упоминания в `migration-plan.md`: `ui/api/coingecko.js` → `ui/api/coins-manager.js`. Исправлен комментарий в `ui/config/table-columns-config.js`: `ui/api/coingecko.js` → `ui/api/coins-manager.js`. Добавлены примечания о переименовании в существующие записи дневного лога от 12-14. Упоминания старого файла дополнены указанием нового названия: `ui/api/coingecko.js` (теперь `ui/api/coins-manager.js`). ◉ Переименование файла для отражения его расширенной роли демонстрирует эволюцию архитектуры: компонент вырос за рамки работы только с CoinGecko API, став менеджером монет в целом. Обновление всех ссылок в документации и коде показывает внимание к консистентности: переименование должно быть полным, иначе возникают несоответствия и путаница. Добавление контекста в дневные логи демонстрирует принцип сохранения истории: будущие разработчики должны понимать причины переименования и связь между старым и новым названиями.

## Коммит 375bcfb от 14.12.2025 : Move review files to ui/, remove unused color variable, and update documentation
◆ Перемещены review-файлы из `docs/` в `ui/`, удалена неиспользуемая переменная `--color-primary-muted`, обновлена документация и исправлены несоответствия. → Перемещен `docs/review-manager.js` → `ui/review-manager.js`. Перемещен `docs/review-styles.css` → `ui/review-styles.css`. Обновлены пути в `ui/assets/icons-review.html` и `ui/styles/colors-review.html` на `../review-manager.js` и `../review-styles.css`. Обновлена логика определения путей в `ui/review-manager.js` для корректной навигации между review-файлами. Обновлены ссылки в `.cursorrules` на новые пути. Удалена переменная `--color-primary-muted` и связанные переменные (`--color-primary-muted-h`, `--color-primary-muted-s`, `--color-primary-muted-l`, `--color-primary-muted-rgb`) из `ui/styles/theme-colors.css` (светлая и темная темы). Удалены записи о `--color-primary-muted` и `--color-primary-muted-rgb` из `ui/styles/colors-review.html`. Удалена категория "Primary" из выпадающего списка категорий в `ui/styles/colors-review.html` (так как цветов с этой категорией больше нет). Убрана тень (`box-shadow`) у `.review-header` в `ui/review-styles.css`. Убран вертикальный гэп (`margin-bottom: 0`) между вкладками и блоком фильтров. Убрана внешняя рамка (`border: none`, `box-shadow: none`) у блока фильтров. Добавлено описание каталога цветов (`ui/styles/colors-review.html`) в `architect.md` и `ui/guide-ii.md`. Добавлено описание системы управления review-файлами (`ui/review-manager.js` и `ui/review-styles.css`) в `architect.md` и `ui/guide-ii.md`. Обновлена структура проекта в `architect.md`: добавлены `review-manager.js`, `review-styles.css`, `colors-review.html`. Исправлены несоответствия в структуре проекта: добавлены `button.js`, `dropdown-menu.js` в список компонентов и `button.css` в список стилей. Добавлено упоминание `ui/styles/button.css` в раздел "Текущее размещение файлов". ◉ Перемещение review-файлов в `ui/` демонстрирует логическую организацию: инструменты разработки находятся рядом с кодом, который они описывают, упрощая навигацию. Удаление неиспользуемых переменных показывает принцип поддержания чистоты кодовой базы: мертвый код удаляется, предотвращая путаницу и упрощая поддержку. Синхронизация документации с фактическим состоянием кода заложила практику регулярной ревизии: документация должна отражать реальность, а не устаревшие представления.

## Коммит f16b9f7 от 14.12.2025 : Refactor documentation structure and add mandatory documentation reading principle
◆ Разгружен `.cursorrules` от деталей в пользу `architect.md` и `ui/guide-ii.md`, добавлен принцип обязательного чтения документации перед выполнением заданий. → Убраны детали работы с HTML файлами (стилизация, вынесение стилей, маркировка контейнеров, детерминированные хэши, стандартные размеры чекбоксов, система иконок) - оставлены только ссылки на `architect.md` и `ui/guide-ii.md`. Убраны детали проверки зависимостей - оставлена ссылка на `architect.md`. Убраны детали протоколирования - оставлена ссылка на `architect.md`. Убраны детали синхронизации настроек - оставлена ссылка на `architect.md`. Удалены разделы "Заметки для будущих сессий" и "Рекомендации для улучшения". Оставлены только принципиальные правила работы ИИ-агента. Добавлен раздел "Проверка актуальности зависимостей" в `architect.md` с регламентом ежедневной проверки версий Vue.js и Bootstrap. Добавлен раздел "Протоколирование дневного чата" в `architect.md` с форматом записи, структурой секций и примером. Добавлен раздел "Синхронизация настроек Cursor → VS Code" в `architect.md` с механизмом отслеживания изменений и списком синхронизируемых настроек. Обновлен раздел "Отслеживание согласованности архитектурных правил" в `architect.md` для отражения нового распределения ответственности. Обновлен раздел "Контроль качества выполнения" в `.cursorrules`: добавлен блок "⚠️ ПЕРЕД ВЫПОЛНЕНИЕМ ЛЮБОГО ЗАДАНИЯ ПОЛЬЗОВАТЕЛЯ" с требованиями прочитать соответствующую документацию проекта перед началом выполнения, применить рекомендации и предписания из документации, учесть существующие решения, паттерны и компоненты, уточнена цель: ИИ-агент должен читать и применять документацию проекта перед выполнением заданий. Добавлена запись в "Текущие предпочтения пользователя" с правилом "Чтение документации перед выполнением заданий". Добавлена запись в "Историю изменений предпочтений" с датой 2025-12-14. ◉ Реструктуризация документации заложила принцип модульности знаний: `.cursorrules` содержит только правила поведения агента, детали перенесены в специализированные документы, что упрощает навигацию и поддержку. Принцип обязательного чтения документации перед выполнением заданий демонстрирует проактивный подход к качеству: агент должен понимать контекст и существующие решения перед началом работы, а не изобретать велосипед. Это заложило основу для высокого качества выполнения задач и соответствия установленным принципам проекта.

## Коммит 118d532 от 14.12.2025 : Extract Perplexity API utility and document core/api vs ui/api separation
◆ Вынесена функция запроса к Perplexity API в отдельную утилиту `core/api/perplexity.js`, обновлен компонент чата для использования утилиты, задокументировано правило разделения ответственности между `core/api/` и `ui/api/`. → Создан файл `core/api/perplexity.js` с функцией `sendPerplexityRequest()` для отправки запросов к Perplexity Chat Completions API. Функция поддерживает обработку ошибок, rate limiting (429), адаптивный таймаут (опционально). Экспорт через `window.perplexityAPI` для использования в других модулях. Утилита независима от Vue компонентов, может использоваться в любом контексте. Обновлен `ui/interaction/chat.js`: метод `askPerplexity()` теперь использует утилиту `window.perplexityAPI.sendPerplexityRequest()` вместо прямых `fetch` запросов. Добавлена проверка доступности модуля `perplexityAPI` перед использованием. Убрана прямая логика `fetch` запросов к Perplexity API. Добавлен скрипт `core/api/perplexity.js` в `index.html` в секции "API утилиты" перед компонентами. Добавлено правило в `architect.md` (раздел "Стандарты разработки"): подробное описание различий между `core/api/` (утилиты, не Vue) и `ui/api/` (Vue компоненты), характеристики каждого типа файлов с примерами, правило контроля для ИИ-агента с 4 пунктами проверки при создании нового функционала. Добавлена ссылка в `.cursorrules`: новый раздел "КРИТИЧЕСКИ ВАЖНО - Разделение ответственности между `core/api/` и `ui/api/`", краткое правило для быстрого контроля, ссылка на подробное описание в `architect.md`, 4 пункта для проверки при создании нового функционала для работы с API. Обновлен раздел "Текущее размещение файлов" в `architect.md`: добавлено описание `core/api/perplexity.js`. Обновлено описание `ui/interaction/chat.js` с указанием использования утилиты из `core/api/perplexity.js`. Обновлена структура проекта в `architect.md`: добавлена папка `core/api/` с файлами. ◉ Установлено критически важное правило разделения ответственности между слоями: `core/api/` для утилит и бизнес-логики, `ui/api/` для Vue-компонентов. Это заложило архитектурный принцип, который контролируется ИИ-агентом через чеклист проверки, предотвращая неправильную организацию кода. Вынос API-логики в утилиты демонстрирует принцип переиспользования: одна утилита может использоваться в разных контекстах (Vue компоненты, обычные скрипты), улучшая тестируемость и модульность.

## Коммит ee019fd от 14.12.2025 : Add math models docs to main docs, fix path, and align documentation with codebase
◆ Добавлена документация математических моделей в основные документы проекта, исправлен путь к документации, проведена полная ревизия документации и приведение в соответствие с фактическим состоянием кодовой базы. → Обновлен раздел "Список документов для сопровождения" в `.cursorrules`: добавлен пункт "Документация математических моделей" (`mm/<название_модели>.md`), указано, что все файлы документации математических моделей из папки `mm/` автоматически относятся к основным документам проекта и требуют сопровождения, указано, что при создании новой математической модели её документация должна быть добавлена в список основных документов, обновлены все упоминания ключевых документов в `.cursorrules` для включения документации математических моделей. Исправлен путь в `.cursorrules` с `mm/<название_модели>/<название_модели>.md` на `mm/<название_модели>.md` для соответствия фактической структуре файлов. Добавлено описание `core/api/coingecko.js` в раздел "Текущее размещение файлов" в `architect.md`. Добавлены описания новых утилит: `ui/utils/coins-cd-helpers.js`, `ui/utils/coins-favorites-helpers.js`. Добавлено описание `ui/config/table-columns-config.js`. Добавлено описание `ui/components/horizon-input.js`. Добавлены описания новых файлов математической модели: `mm/median/metrics/cd.js`, `mm/median.md`. Обновлена структура проекта в `architect.md`: добавлена папка `mm/` с полной структурой математической модели, добавлены все новые файлы в соответствующие разделы структуры. ◉ Интеграция документации математических моделей в основные документы проекта демонстрирует системный подход к управлению знаниями: все критичные документы находятся в едином списке сопровождения, обеспечивая их актуализацию. Полная ревизия документации и приведение в соответствие с кодовой базой показывает принцип "живой документации": документация должна отражать реальное состояние проекта, а не устаревшие представления. Это заложило основу для поддержания актуальности документации в процессе разработки.

## Коммит aed417d от 13.12.2025 : Add docs/ to .gitignore and remove tracked files
◆ Добавлена папка `docs/` в `.gitignore` и удалены из индекса Git файлы, которые должны игнорироваться. → Добавлена строка `docs/` в `.gitignore` для исключения всей папки с черновиками и документами из отслеживания Git. Удален `docs/TODO.TXT` из индекса Git через `git rm --cached docs/TODO.TXT` (файл остался на диске, но больше не отслеживается). Удален `data-app.json` из индекса Git (файл экспорта настроек с пользовательскими данными). Удален `77.json` из индекса Git (файл кэша данных приложения). ◉ Исключение папки `docs/` и файлов с пользовательскими данными из версионного контроля демонстрирует принцип защиты приватности: личные данные и черновики не должны попадать в репозиторий, что критично для безопасности и чистоты истории изменений. Использование `git rm --cached` показывает правильный способ удаления файлов из индекса без удаления с диска, что важно для сохранения локальных данных.

## Коммит 3c6ac65 от 13.12.2025 : Refactor archive to favorites system with migration
◆ Полностью переработан концепт архива монет в хранилище избранного с миграцией данных и переименованием всех упоминаний "архив" на "избранное". → Объединены `favoriteCoinIds` и `cgArchivedCoins` в единую систему `cgFavoriteCoins` при загрузке данных. Добавлена миграция localStorage: `cgArchivedCoins` → `cgFavoriteCoins` с сохранением обратной совместимости. Удалена отдельная система `favoriteCoinIds` (миграция в `cgFavoriteCoins`). Переименование переменных и методов: `cgArchivedCoins` → `cgFavoriteCoins`, `archivedCoins` → `favoriteCoins`, `showArchiveDropdown` → `showFavoritesDropdown`, `selectedArchivedCoin` → `selectedFavoriteCoin`, `archiveCoin()` → `removeFromTable()`, `archiveSelectedCoins()` → `removeSelectedFromTable()`, `restoreFromArchiveById()` → `addFavoriteToTableById()`, `restoreFromArchive()` → `addFavoriteToTable()`, `syncCoinWithArchive()` → `syncCoinWithFavorites()`, `syncAllCoinsWithArchive()` → `syncAllCoinsWithFavorites()`, `getArchivedCoin*()` → `getFavoriteCoin*()`, `isFailedArchivedCoin()` → `isFailedFavoriteCoin()`, `toggleArchiveDropdown()` → `toggleFavoritesDropdown()`, `closeArchiveDropdown()` → `closeFavoritesDropdown()`. Обновление логики работы: избранное теперь хранилище, а не архив: монета может быть одновременно в таблице и в избранном, `syncCoinWithFavorites()` не удаляет из избранного при добавлении в таблицу, `addFavoriteToTableById()` проверяет наличие монеты в таблице: если есть - закрывает dropdown (отметка показывается), если нет - добавляет, `removeFromTable()` и `removeSelectedFromTable()` удаляют из таблицы и добавляют в избранное. Обновление UI: "Архив" переименован в "Избранное" в кнопке и выпадающем списке, иконка изменена с `fa-archive` на `fa-star`, CSS классы: `.cg-archive-btn` → `.cg-favorites-btn`, `archive-dropdown` → `favorites-dropdown`, события/эмиты: `archive-selected-coins` → `remove-selected-coins`, `restore-from-archive` → `add-favorite-to-table`, ID элементов: `context-archive` → `context-remove-from-table`, `counter-archive` → `counter-remove-from-table`, тексты меню: "В архив" → "Убрать из таблицы", "Архивировать отмеченные" → "Убрать отмеченные из таблицы", в выпадающем списке избранного показываются отметки для монет, уже находящихся в таблице. Обновление документации: переписан раздел "Синхронизация данных между таблицей и архивом" в `architect.md` на "Хранилище избранного и работа с таблицей монет", обновлены все упоминания архива на избранное в `ui/guide-ii.md` (переписаны целые абзацы), обновлены комментарии в коде под новую концепцию, убраны все упоминания "архив" из кода, комментариев и документации (кроме истории и иконок для будущей функциональности). Миграция данных: при загрузке проверяются оба ключа: `cgArchivedCoins` (старый) и `cgFavoriteCoins` (новый), если есть старый ключ, но нет нового - данные мигрируются в новый ключ, старый ключ `cgFavoriteCoinIds` также мигрируется в `cgFavoriteCoins` при первом запуске. ◉ Концептуальная эволюция от "архива" к "избранному" демонстрирует переосмысление роли хранилища: избранное как хранилище предпочтений, а не временное скрытие, что меняет семантику взаимодействия (монета может быть одновременно в таблице и избранном). Миграция данных с сохранением обратной совместимости показывает принцип эволюции без потери: пользовательские данные не теряются, автоматическая миграция обеспечивает плавный переход. Полное переименование всех упоминаний демонстрирует внимание к консистентности: терминология должна отражать реальную функциональность, предотвращая путаницу и упрощая понимание кода.

## Коммит d313503 от 13.12.2025 : Systematize component patterns and approaches
◆ Агрегированы и систематизированы все подходы к компонентам, сформированные за день. → Добавлен раздел "Паттерны универсальных компонентов" в `architect.md` с подробным описанием: компонент `menu-item` (пункт меню) - структура, props, использование, компонент `dropdown-menu` (выпадающее меню) - структура, props, события, клавиатурная навигация, паттерн интеграции компонентов - правила использования универсальных компонентов, стилизация фокуса через рутовые переменные - общая переменная `--color-focus-bg`, единообразные стили пунктов меню - правила стилизации для консистентности. Добавлен раздел "Универсальные компоненты меню" в `ui/guide-ii.md` с описанием: структура и стилизация компонента `menu-item`, клавиатурная навигация и управление курсором в `dropdown-menu`, правила использования универсальных компонентов. Обновлен раздел "Доступность" в `ui/guide-ii.md` с информацией о клавиатурной навигации и управлении курсором. Обновлены описания компонентов в разделе "Текущее размещение файлов" в `architect.md` со ссылками на новый раздел. ◉ Систематизация паттернов компонентов заложила основу для консистентной разработки: документирование подходов, правил и примеров использования обеспечивает единообразие при создании новых компонентов. Это демонстрирует принцип накопления знаний: опыт разработки фиксируется в документации, становясь доступным для будущих сессий и других разработчиков, предотвращая повторное изобретение решений.

## Коммит 5797a8b от 13.12.2025 : Implement universal menu components (menu-item and dropdown-menu)
◆ Реализованы универсальные компоненты меню и их интеграция во все выпадающие меню приложения. → Создан компонент `ui/components/menu-item.js` - универсальный компонент пункта меню с иконкой, командой и индикатором. Создан компонент `ui/components/dropdown-menu.js` - универсальный компонент выпадающего меню с клавиатурной навигацией. Интегрированы компоненты во все выпадающие меню: счетчик, поиск, архив, контекстное меню, меню сортировки. Реализована стилизация фокуса через общую рутовую переменную `--color-focus-bg` для единообразия с выбранными строками таблицы. Добавлен prop `trigger-selector` в `dropdown-menu` для автоматической установки `cursor: pointer` на элементах-триггерах. Обновлены стили пунктов меню: паддинги на `<span>` элементах, фиксированные ширины для иконок и индикаторов. Обновлен `icons-helper.js` для синхронной загрузки иконок (встроен JSON для работы с file://). Расширен `icons-mapping.json` с поддержкой индикаторов (status, navigation). Зарегистрированы компоненты в `app-ui-root.js`. ◉ Создана универсальная система компонентов меню: единые компоненты для всех выпадающих меню обеспечивают консистентность интерфейса и упрощают поддержку. Клавиатурная навигация демонстрирует внимание к доступности: полная поддержка навигации с клавиатуры критична для пользователей, не использующих мышь. Автоматическое управление курсором через `trigger-selector` показывает принцип автоматизации: компонент сам настраивает визуальные подсказки, не требуя ручной настройки в каждом месте использования.

## Коммит 10e5000 от 13.12.2025 : Refactor icons system to ui-element-helper with button component and split tooltips
◆ Переименована система иконок в систему UI‑элементов (`ui-element-helper`), создан универсальный компонент кнопки. → Переименование иконок: `icons-mapping.json` → `ui-element-mapping.json`, `icons-helper.js` → `ui-element-helper.js`, `window.iconsHelper` → `window.uiElementHelper`, удалены старые файлы после миграции. Создан компонент `ui/components/button.js` с поддержкой вариантов Bootstrap, раздельных tooltips и состояния загрузки, добавлен `ui/styles/button.css` для переноса паддингов на дочерние элементы. Обновлён `menu-item.js` под `ui-element-helper`, перенесены паддинги и раздельные tooltips на `.menu-item-main` и `.menu-item-indicator`. В `architect.md` и `ui/guide-ii.md` обновлена документация системы UI‑элементов и раздельных tooltips. ◉ Эволюция системы иконок в систему UI-элементов демонстрирует масштабируемость архитектуры: расширение функциональности без изменения базовых принципов, что позволяет управлять не только иконками, но и другими визуальными элементами. Универсальный компонент кнопки заложил основу для стандартизации всех интерактивных элементов: единый API и поведение упрощают поддержку и обеспечивают визуальную согласованность. Раздельные tooltips показывают внимание к деталям UX: разная информация для основного элемента и индикатора улучшает информативность без перегрузки интерфейса.

## Коммит b04fb21 от 13.12.2025 : Update icons catalog and documentation
◆ Обновлена документация по системе иконок с информацией о каталоге иконок и SVG-иконках. → Обновлен раздел "Система UI элементов" в `architect.md`: добавлена информация о каталоге иконок `ui/assets/icons-review.html`, добавлена информация о SVG-иконках в `ui/assets/icons/`, добавлены функции для работы с SVG (`isSVGIcon`, `getSVGIconPath`), обновлена структура проекта с папкой `ui/assets/icons/` и файлом `icons-review.html`. Обновлен раздел "Иконки" в `ui/guide-ii.md`: добавлена информация о SVG-иконках и их хранении, добавлена информация о каталоге иконок, обновлена информация о функциях `ui-element-helper.js` для SVG. ◉ Расширение системы иконок на поддержку SVG демонстрирует универсальность архитектуры: единый интерфейс для работы с разными типами иконок (Font Awesome, SVG файлы) упрощает использование и обеспечивает консистентность. Каталог иконок как инструмент инвентаризации показывает проактивный подход к управлению визуальными элементами: полный обзор всех иконок проекта упрощает поиск и переиспользование, предотвращая дублирование.

## Коммит 19ebc7d от 12.12.2025 : Add colorization, rounding features and color adjustments to cell-num
◆ Обновлена конфигурация колонок таблицы с добавлением флагов цветизации и округления. → Добавлены флаги `colorize: true` и `roundToHalf: true` в объекты `format` всех процентных колонок (1h, 24h, 7d, 30d, 200d) в `tableColumns` в `coingecko.js`. Добавлены те же флаги в динамическую CD колонку и метод `getCDFormat()` в `coingecko.js`. Флаги передаются в компонент `cell-num` через метод `getColumnFormatProps()` и prop binding `v-bind="getFormatProps(column)"`. ◉ Централизованная конфигурация колонок через флаги демонстрирует декларативный подход к настройке поведения: все параметры форматирования (цветизация, округление) управляются из одного места, упрощая поддержку и обеспечивая единообразие. Это заложило принцип конфигурации через данные: добавление новых колонок или изменение поведения существующих требует только изменения конфигурации, а не кода компонентов.

## Коммит d629901 от 12.12.2025 : Add deterministic hashes for all component instances
◆ Добавлены детерминированные уникальные хэши для всех экземпляров переиспользуемых компонентов и проведена ревизия всех компонентов. → Создана утилита `ui/utils/hash-generator.js` для генерации детерминированных Base58 хэшей из строк. Добавлено computed свойство `instanceHash` во все переиспользуемые компоненты: `cell-coin.js` на основе `coinId` prop, `cell-row-select.js` на основе `rowId` prop, `cell-num.js` на основе `cellId` prop (опционально), `header-cell.js` на основе `sortField` или `label` prop, `header-cell-check.js` на основе статического идентификатора `'header-cell-check-all'`, `sortable-header.js` на основе `field` prop, `table-coin-row.js` на основе `coin.id` или комбинации `coin.symbol` и `index`. Обновлены шаблоны в `index.html` для использования динамического `instanceHash` вместо статических хэшей. Добавлено обязательное правило "Детерминированные хэши для экземпляров компонентов" в `architect.md` с описанием требований и примеров. Обновлены описания компонентов в `architect.md` с указанием источника `instanceHash`. Добавлено описание утилиты `hash-generator.js` в раздел "Текущее размещение файлов" в `architect.md`. Обновлена структура проекта в `architect.md` с добавлением `hash-generator.js` в раздел utils. Добавлено правило в `.cursorrules` о детерминированных хэшах для экземпляров компонентов. ◉ Детерминированные хэши для экземпляров компонентов заложили принцип стабильной идентификации: один и тот же экземпляр получает один и тот же хэш между сессиями, что критично для кастомной стилизации и отладки. Это демонстрирует подход к управлению состоянием компонентов: хэш генерируется на основе props, обеспечивая предсказуемость и воспроизводимость. Утилита генерации хэшей через Base58 показывает выбор компактного формата: короткие, читаемые идентификаторы без специальных символов, удобные для использования в CSS-классах.

## Коммит 78fbf79 от 12.12.2025 : Add cell-coin component and favorites system for coins
◆ Обновлена архитектурная документация с описанием системы компонентов ячеек таблицы и системы избранного. → Добавлено описание компонента `cell-coin.js` в раздел "Текущее размещение файлов" в `architect.md`. Добавлен новый раздел "Система компонентов ячеек таблицы (Table Cell Components System)" в `architect.md` с описанием архитектурного принципа модульности и переиспользования компонентов для ячеек таблиц. Добавлен новый раздел "Система избранного (Favorites System)" в `architect.md` с описанием архитектурного принципа управления пользовательскими предпочтениями для монет. Обновлена структура проекта в `architect.md` с добавлением новых компонентов (`cell-num.js`, `cell-row-select.js`, `cell-coin.js`, `header-cell.js`, `header-cell-check.js`, `table-data.js`) в раздел "Структура проекта". Обновлен раздел "Управление списком монет" в `ui/guide-ii.md` с описанием системы избранного и интеграции в контекстное меню. ◉ Документирование систем компонентов ячеек и избранного как архитектурных принципов заложило основу для масштабируемой архитектуры таблиц: модульные компоненты ячеек обеспечивают переиспользование и единообразие, а система избранного демонстрирует подход к персистентному хранению пользовательских предпочтений. Это создало четкую структуру для будущего расширения функциональности таблиц и управления данными.

## Коммит 6fc742f от 11.12.2025 : Refactor: remove complex-deltas component, add reusable sortable-header and table-coin-row components
◆ Удален компонент `complex-deltas.js`, функциональность перенесена в `coingecko.js`. Добавлены переиспользуемые компоненты `sortable-header.js` и `table-coin-row.js`. Обновлена логика переключения вкладок для поддержки вкладки "Компл. дельты". → Удален файл `ui/api/complex-deltas.js` - функциональность отображения комплексных дельт перенесена в компонент `coingecko.js`, таблица отображается на вкладке "Компл. дельты" через условный рендеринг того же компонента `app-coingecko`. Создан файл `ui/components/sortable-header.js` - переиспользуемый компонент для сортируемых заголовков таблиц. Компонент принимает props: `field` (поле для сортировки), `label` (текст заголовка), `sortBy` (текущее поле сортировки), `sortOrder` (текущий порядок сортировки). Computed свойства: `isActive()` - проверка активности сортировки, `sortIcon()` - определение иконки сортировки (fas fa-sort, fas fa-sort-up, fas fa-sort-down). Метод `handleClick()` эмитит событие `sort` с полем для сортировки. Использует x-template `#sortable-header-template`. Создан файл `ui/components/table-coin-row.js` - переиспользуемый компонент для первых двух колонок таблицы (№ и Тикер). Компонент обеспечивает единообразие отображения первых двух колонок во всех таблицах вкладок математической модели Median. Принимает props: `index` (индекс строки для номера), `coin` (объект монеты). Методы: `getBybitLink(ticker)` - формирование ссылки на Bybit, `getTicker(coin)` - получение тикера монеты. Использует x-template `#table-coin-row-template`. В `app/app-ui-root.js` удалена регистрация компонента `app-complex-deltas`, добавлена регистрация компонента `sortable-header`. Компонент регистрируется глобально для использования в любых таблицах. В `ui/interaction/header.js` обновлена логика переключения вкладок: метод `switchTab()` теперь закрывает настройки при переключении на вкладку "Компл. дельты" (в дополнение к вкладке "%"). Убрана замена "Компл. дельты" на "Дельты" в мобильной версии из computed свойства `selectedTabLabel()` - теперь всегда отображается полное название "Компл. дельты". ◉ Консолидация функциональности в единый компонент демонстрирует принцип DRY: условный рендеринг одного компонента для разных представлений упрощает поддержку и обеспечивает единообразие логики. Создание переиспользуемых компонентов (`sortable-header`, `table-coin-row`) заложило основу для стандартизации интерфейса: единый вид и поведение во всех таблицах приложения, что критично для консистентности UX. Глобальная регистрация компонентов показывает подход к переиспользованию: компоненты доступны везде без явного импорта, упрощая использование в любых контекстах.

## Коммит 211135a от 11.12.2025 : Add reusable column visibility mixin and document view switching pattern
◆ Создан переиспользуемый Vue mixin для управления видимостью колонок таблицы через вкладки, добавлена подробная документация парадигмы переключения представлений (View Switching Pattern) и её взаимосвязи с управлением видимостью колонок. → Создан файл `ui/utils/column-visibility-mixin.js` с переиспользуемым Vue mixin для управления видимостью колонок таблицы. Mixin содержит computed свойства: `activeTab()` - реактивное получение активного представления из корневого компонента, `columnVisibilityClasses()` - вычисление CSS классов видимости для колонок на основе конфигурации и активного представления. Поддерживается префиксное совпадение классов (например, 'col-percent' скрывает все 'col-percent-*'). Опциональный метод `getColumnClasses()` для явного указания всех классов колонок. В `ui/api/coingecko.js` подключен mixin `columnVisibilityMixin`, добавлена конфигурация `columnVisibilityConfig` в `data()` с маппингом представлений на скрываемые колонки. Добавлен метод `getColumnClasses()` для явного указания классов колонок. Удалена старая логика `columnVisibilityClasses()` из computed, заменена на использование mixin. В `ui/styles/layout.css` обновлены CSS правила для универсальности: убрана привязка к конкретному классу `.cg-coins-table`, добавлено универсальное правило `table th.col-hidden, table td.col-hidden { display: none; }` для работы с любыми таблицами. Правило `col.col-hidden { width: 0; }` оставлено для скрытия колонок через colgroup. В `architect.md` добавлен новый раздел "Парадигма переключения представлений (View Switching Pattern)" с подробным описанием архитектурной модели (Single Source of Truth), компонентов парадигмы (централизованное состояние, управление переключением, реактивное распространение, UI компоненты), преимуществ, структуры данных, правил использования и связи с другими паттернами. Обновлен раздел "Переиспользуемая фича: Управление видимостью колонок таблицы через вкладки" с описанием архитектурной интеграции с парадигмой переключения представлений, зависимости от централизованного состояния, реактивного обновления, конфигурации представлений и мгновенного переключения. ◉ Создан архитектурный паттерн переключения представлений (View Switching Pattern) как Single Source of Truth: централизованное состояние в корневом компоненте распространяется реактивно на все дочерние компоненты, обеспечивая единообразие и предсказуемость. Переиспользуемый mixin для управления видимостью колонок демонстрирует принцип композиции: функциональность инкапсулирована в mixin, который может применяться к любым таблицам без дублирования кода. Использование CSS классов для переключения видимости показывает оптимизацию производительности: мгновенное переключение без перерисовки таблицы, что критично для больших наборов данных.

## Коммит 3d6f705 от 11.12.2025 : Remove defaultCoins, fix search input, add top N coins feature, fix group archiving
◆ Убран список монет по умолчанию, исправлен поиск монет, добавлена функциональность добавления топ N монет по числу, исправлено групповое архивирование. → В `ui/api/coingecko.js` удален массив `defaultCoins`, теперь список монет по умолчанию пустой (`[]`). Пользователь сам формирует список монет через поиск или вставку тикеров. Исправлен метод `handleSearchInput()`: теперь принимает значение напрямую (строку из компонента `header-coins`), а не объект события. Добавлена обратная совместимость для случаев, когда передается объект события. Добавлена функциональность добавления топ N монет: при вводе числа (например, "50") в поле поиска автоматически появляются два кастомных пункта ("Топ N по капитализации" и "Топ N по дневному объему"). Добавлены методы `addTopCoinsByMarketCap(count)` и `addTopCoinsByVolume(count)` для загрузки топ монет из CoinGecko API. Метод `handleAddCoin()` проверяет тип результата поиска и вызывает соответствующий метод для кастомных пунктов. Исправлен порядок операций в методе `archiveSelectedCoins()`: сначала находится монета в `cgCoins`, затем синхронизируется (удаляется из таблицы), затем добавляется в архив. Это исправляет проблему, когда монеты удалялись вместо архивирования при групповом архивировании. В `index.html` обновлен шаблон результатов поиска для корректного отображения кастомных пунктов (без иконки, без проверки выбранности). В `ui/guide-ii.md` обновлено описание поиска монет с упоминанием функциональности добавления топ N монет. В `architect.md` обновлено описание компонента `coingecko.js` с упоминанием добавления топ N монет. ◉ Удаление списка монет по умолчанию демонстрирует принцип персонализации: пользователь получает полный контроль над составом данных с первого запуска, что создает более релевантный опыт. Кастомные пункты для топ N монет показывают гибкость интерфейса: одно поле поиска может обрабатывать разные типы запросов (поиск по имени/тикеру и добавление топ монет), упрощая UX. Исправление порядка операций при архивировании демонстрирует важность последовательности действий: правильный порядок предотвращает потерю данных и обеспечивает корректное состояние системы.

## Коммит 897cec7 от 11.12.2025 : Add centralized color and z-index system with HSL/HSLA model
◆ Добавлена документация о системе цветов HSL/HSLA и системе z-index слоев как архитектурных принципах проекта. → В `ui/guide-ii.md` добавлен раздел "Цветовая модель HSL/HSLA" с описанием принципа, преимуществ (интуитивность, легкость создания вариаций, адаптация под темы, централизованное управление), реализации в проекте и связи с Bootstrap. Обновлены упоминания z-index в компонентах (хедер, футер, сплэш-экран) с указанием используемых переменных. В `architect.md` добавлено упоминание системы z-index слоев в раздел "Стандарты разработки" и создан новый раздел "Система z-index слоев" с описанием принципа, преимуществ, структуры переменных, правил использования и связи с Bootstrap. Добавлено упоминание цветовой модели HSL/HSLA в стандартах разработки. ◉ Документирование систем цветов и z-index как архитектурных принципов заложило фундамент для масштабируемой дизайн-системы: централизованное управление через CSS-переменные обеспечивает единообразие и упрощает глобальные изменения. HSL/HSLA модель демонстрирует преимущества семантической цветовой модели: интуитивность настройки (изменение насыщенности, яркости без изменения оттенка) и автоматическая адаптация под темы. Система z-index через переменные предотвращает конфликты слоев и обеспечивает предсказуемую иерархию визуальных элементов.

## Коммит ddb24d2 от 11.12.2025 : Add centralized icon system as architectural principle
◆ Система иконок задокументирована как архитектурный принцип проекта, аналогичный цветовой модели HSL/HSLA и системе z-index слоев. → В `architect.md` усилен раздел "Система иконок" с добавлением подраздела "Концепт централизованного управления иконками". Описаны принципы разделения ответственности: декларативная конфигурация (JSON), стили через CSS переменные, программный доступ через утилиту. Указано, что это архитектурный принцип проекта, аналогичный цветовой модели HSL/HSLA и системе z-index слоев. Обновлен раздел "Стандарты разработки" с упоминанием системы иконок как архитектурного принципа. Обновлена структура проекта с добавлением `ui/config/` и `ui/utils/icons-helper.js`. В `ui/guide-ii.md` расширено описание централизованной системы иконок в разделе "Иконки" с указанием, что это архитектурный принцип проекта. ◉ Возведение системы иконок в ранг архитектурного принципа демонстрирует понимание её фундаментальной роли: централизованное управление визуальными элементами через декларативную конфигурацию обеспечивает масштабируемость и консистентность дизайн-системы. Постановка наравне с цветовой моделью и z-index показывает системный подход к визуальным параметрам: все они управляются централизованно через переменные и конфигурации, создавая единую архитектуру стилизации.

## Коммит 32b78cc от 11.12.2025 : Update migration plan: multiple math models architecture with median model
◆ Обновлена архитектура математических моделей: теперь в приложении будет несколько математических моделей (в отличие от старого приложения, где была только одна). Текущая модель - "median" (модель расчета AGR по медианам). Обновлена структура папок и экспорты функций. → В `migration-plan.md` обновлена структура папок: `mm/utils/`, `mm/core/`, `mm/metrics/` → `mm/median/utils/`, `mm/median/core/`, `mm/median/metrics/`. Обновлены все пути к файлам в плане миграции (12 этапов) с учетом новой структуры. Обновлены экспорты функций: `window.mm*` → `window.mmMedian*` (например, `window.mmPRCWeights` → `window.mmMedianPRCWeights`). Добавлено описание AGR как конечного показателя пригодности монеты к торговле (в разных масштабах и размерностях для разных математических моделей). Добавлено примечание о возможности добавления других моделей в будущем (например, `mm/momentum/`, `mm/trend/`). В `architect.md` добавлен раздел "Архитектура математических моделей" в секции "MM (математическая модель)" с описанием структуры и принципов. Обновлена иерархия метрик в `migration-plan.md` с указанием, что это модель "median". ◉ Установлена расширяемая архитектура математических моделей: структура папок по моделям (`mm/median/`, `mm/momentum/` и т.д.) заложила принцип изоляции, где каждая модель существует независимо. Префиксы экспортов (`mmMedian*`) демонстрируют пространство имен: функции разных моделей не конфликтуют, обеспечивая возможность одновременного использования нескольких моделей. Определение AGR как абстрактного показателя показывает гибкость архитектуры: разные модели могут вычислять его по-разному, сохраняя единый интерфейс.

## Коммит 70e4822 от 11.12.2025 : Add migration plan for mathematical model and transform CoinGecko data to PV format
◆ Создан подробный план миграции математической модели из старого приложения, добавлена трансформация данных CoinGecko в формат со старыми переменными (pvs). → Создан файл `migration-plan.md` в корне проекта с пошаговым планом миграции (12 этапов). Каждый этап содержит: цель, конкретные шаги, команды для проверки в консоли, описание следующего элемента интерфейса для проверки. Добавлен раздел "Проблемы и решения миграции" с описанием 4 ключевых проблем (изменение интервалов, зависимость от рыночных индикаторов, корреляция с BTC, независимость MDN). Создана функция `transformCoinGeckoToPV()` в `ui/api/coingecko.js` для трансформации данных CoinGecko в формат со старыми переменными: массив `pvs` из 6 элементов (PV1h, PV24h, PV7d, PV14d, PV30d, PV200d), отдельные переменные PV1h, PV24h, PV7d, PV14d, PV30d, PV200d для совместимости. Применена трансформация во всех местах получения данных от CoinGecko API: в `fetchCoinGecko()` - основной метод загрузки данных, в `addTopCoinsByMarketCap()` - добавление топ монет по капитализации, в `addTopCoinsByVolume()` - добавление топ монет по объему, при загрузке из localStorage - для обратной совместимости со старыми данными. Добавлена секция "Проблемы миграции математической модели" в `architect.md` с описанием текущих проблем и ссылками на план миграции. Обновлен `.cursorrules` с ссылкой на план миграции в разделе о работе со старыми файлами. Все изменения подробно прокомментированы с указанием источника (old_app_not_write/parsing.js). ◉ Создан стратегический план миграции с детальным описанием каждого этапа: это заложило методологию переноса функциональности из старого приложения, обеспечивая систематический подход и возможность проверки прогресса. Трансформация данных в формат со старыми переменными демонстрирует принцип обратной совместимости: существующие функции расчета могут использоваться без изменений, упрощая миграцию. Документирование проблем миграции показывает проактивный подход к рискам: потенциальные сложности идентифицированы заранее, что упрощает их решение.

## Коммит d3a41e2 от 11.12.2025 : Document card header creation pattern as architectural principle
◆ Задокументирован паттерн создания заголовков карточек как архитектурный принцип проекта. → Добавлено правило в `.cursorrules` о паттерне создания заголовков карточек. Добавлен раздел в `architect.md` с описанием паттерна создания заголовков карточек как архитектурного принципа. Добавлено упоминание в `ui/guide-ii.md`. Обновлен `core/cfg-app.js` с новым значением `lastCommitMessage`. ◉ Фиксация паттерна создания заголовков карточек как архитектурного принципа обеспечивает единообразие интерфейса и упрощает создание новых компонентов.

## Коммит 0a67ba3 от 10.12.2025 : Create guide-ii.md and integrate with project documentation
◆ Создан файл `ui/guide-ii.md` с двумя секциями (Interface и Interaction), интегрирован с `architect.md` и `.cursorrules`, исправлены несогласованности в документации, добавлены правила контроля качества и сопровождения документации. → Создан файл `ui/guide-ii.md` с секциями "Interface (оформление)" и "Interaction (паттерны UX)" на основе текущего состояния проекта (компоненты, стили, паттерны взаимодействия). В `architect.md` заменены полные описания разделов UI и MM на ссылки на соответствующие документы (`ui/guide-ii.md` для UI/UX, `architect.md` для MM). В `architect.md` добавлен раздел "Отслеживание согласованности архитектурных правил" с упоминанием всех трех документов. В `.cursorrules` обновлено правило обработки команд UI:/UX:/MM: - команды UI: и UX: теперь обновляют разделы в `ui/guide-ii.md`, команда MM: обновляет раздел в `architect.md`. Исправлены несогласованности: добавлен `ui/guide-ii.md` в раздел "Текущее размещение файлов" и "Структура проекта" в `architect.md`, исправлено дублирование папки `ui/` в структуре проекта, добавлены недостающие файлы (`header.js`, `footer.js`). В `ui/guide-ii.md` добавлен раздел "Связанные документы" со ссылками на все три документа проекта. ◉ Установлена модульная структура документации: разделение по специализациям (архитектура, UI/UX, правила агента) создает четкую иерархию знаний, упрощая навигацию и поддержку. Замена полных описаний на ссылки демонстрирует принцип DRY в документации: информация хранится в одном месте, предотвращая рассинхронизацию. Междокументные ссылки обеспечивают целостность системы знаний, позволяя быстро находить связанную информацию.

## Коммит 88af77b от 10.12.2025 : Add automatic container marking system with avto- classes
◆ Реализована система автоматической маркировки значимых контейнеров через CSS классы `avto-{Base58_8символов}` для удобной навигации в коде через DevTools и указания агенту места в разметке. → В `architect.md` добавлен раздел "Маркировка контейнеров" в секцию "Стандарты разработки" с полным описанием системы: назначение, формат маркировки (`avto-{Base58_8символов}`), правила применения (что маркировать, что не маркировать), изоляция (классы vs ID), примеры использования. В `index.html` добавлены классы `avto-{hash}` к значимым контейнерам: корневой контейнер контента (`avto-X7pL2nQ`), основная секция `<main>` (`avto-K9mP4rT`), карточка настроек Perplexity AI (`avto-M3nP8qW`), карточка виджета CoinGecko (`avto-B7fN2kT`), информационная карточка (`avto-H5jR9vQ`). Мелкие обертки (`.row`, `.col-*`, `.mb-3`, `.input-group`) и части компонентов (`.card-header`, `.card-body`) не маркируются согласно правилам. JS-зависимые элементы (`id="apiKey"`, `id="model"`) остались с осмысленными ID, не используют `avto-*` классы. ◉ Система маркировки `avto-{hash}` заложила архитектурный принцип навигации по коду: детерминированные хэши через Base58 обеспечивают уникальную идентификацию контейнеров для быстрого поиска в DevTools и точного указания местоположения при работе с ИИ-агентом. Изоляция маркировки от функциональности (классы не используются в JS/CSS) демонстрирует принцип разделения ответственности: маркировка служит только для навигации, не влияя на поведение приложения.

## Коммит 950f57d от 10.12.2025 : Remove chat component registration from app-ui-root
◆ Удалена регистрация компонента чата `window.cmpChat()` из `app/app-ui-root.js`, так как чат с Perplexity AI был убран из интерфейса. → В `app/app-ui-root.js` удалена строка `window.cmpChat && window.cmpChat()` из массива `parts`. Добавлен комментарий `// window.cmpChat удален - чат с Perplexity AI убран из интерфейса` для ясности. ◉ Удаление неиспользуемого кода демонстрирует поддержание чистоты кодовой базы: после удаления функциональности из интерфейса все связанные регистрации и ссылки должны быть удалены, предотвращая ошибки и путаницу. Комментарий в коде показывает внимание к документированию причин удаления для будущих разработчиков.

## Коммит fa2f2cf от 10.12.2025 : Refactor import/export to universal system and fix import bugs
◆ Реализована универсальная система экспорта/импорта всех настроек проекта, удален экспорт messages (чат удален), исправлены баги с импортом (диалог выбора файла не открывался, тема не восстанавливалась). → В `ui/api/import-export.js` реализована универсальная система `collectAllSettings()`, которая автоматически собирает все настройки из localStorage, разделяя их на обычные (`regularSettings`) и обфусцированные (`secureData`). Удален экспорт `messages` из формата экспорта (чат с Perplexity AI удален из интерфейса). Добавлены массивы `SECURE_KEYS` (ключи обфусцированных данных) и `EXCLUDED_KEYS` (служебные ключи, не экспортируются). Реализован метод `restoreAllSettings()` с поддержкой обратной совместимости форматов v1.0, v2.0 и v3.0. Исправлен баг с диалогом выбора файла: `<input ref="fileInput">` перенесен из шаблона компонента `app-settings` в корневой `<div id="app">` в `index.html`, чтобы `this.$refs.fileInput` был доступен в корневом компоненте. Исправлен баг с восстановлением темы: изменен порядок операций при импорте - сначала обновляется localStorage, затем Vue-свойство, чтобы watch в `cmpTheme` автоматически применил тему через `applyTheme()`. В `architect.md` добавлен раздел "Расширяемая система экспорта/импорта настроек" с описанием принципов работы, правил для разработчиков, текущих настроек и примерами кода. Обновлен `data-app.json` до формата v3.0 (универсальная система). ◉ Создана саморасширяемая система экспорта/импорта: автоматический сбор всех настроек из localStorage без необходимости изменений кода при добавлении новых настроек демонстрирует принцип "convention over configuration". Разделение на обычные и обфусцированные данные показывает внимание к безопасности: чувствительные данные обрабатываются отдельно, сохраняя защиту при экспорте. Поддержка обратной совместимости форматов заложила принцип эволюции без разрыва: старые форматы продолжают работать, новые добавляются без потери функциональности.

## Коммит 0cb545e от 10.12.2025 : Add adaptive timeout for rate limiting and sync table/archive
◆ Реализован адаптивный таймаут для обработки rate limiting CoinGecko API (экспоненциальный backoff), добавлена синхронизация данных между таблицей и архивом монет, реализовано восстановление автоматически заархивированных монет с обработкой failed- монет, добавлена визуальная дифференциация автоматически заархивированных монет (иконка рефреша), улучшена читабельность желтых элементов (темно-оранжевый цвет), добавлены стили для disabled полей в темной теме, скорректировано позиционирование панельки загрузки монет. → В `ui/api/coingecko.js` реализован адаптивный таймаут для обработки rate limiting: добавлены свойства `adaptiveTimeout` (текущий таймаут, начинается с 300ms), `adaptiveTimeoutBase` (300ms), `adaptiveTimeoutMax` (10000ms), `lastSuccessfulRequest` (время последнего успешного запроса), метод `increaseAdaptiveTimeout()` удваивает таймаут при получении 429 ошибки, ограничен максимумом 10 секунд, метод `decreaseAdaptiveTimeout()` уменьшает таймаут на 20% при успешных запросах и если прошло более 5 секунд без ошибок, не ниже базового значения, метод `resetAdaptiveTimeout()` сбрасывает таймаут к базовому значению при начале нового процесса, обработка 429 ошибок во всех методах API: `fetchCoinGecko()`, `getCoinIdBySymbol()`, `searchCoins()`, `archiveFailedTicker()`, адаптивный таймаут применяется в `processTickersQueue()` как задержка между последовательными запросами и между повторными попытками неудачных тикеров. Реализована синхронизация данных между таблицей и архивом: метод `syncCoinWithArchive(coinId, action)` синхронизирует одну монету - при `action === 'add'` удаляет из архива, при `action === 'archive'` удаляет из таблицы, метод `syncAllCoinsWithArchive()` очищает дубликаты при загрузке приложения, удаляет из архива все монеты, присутствующие в таблице, синхронизация применяется в: `addCoin()`, `processTickersQueue()`, `archiveCoin()`, `archiveSelectedCoins()`, `restoreFromArchiveById()`, вызов `syncAllCoinsWithArchive()` в `mounted()` для проверки дубликатов при загрузке. Улучшено восстановление монет из архива: метод `restoreFromArchiveById()` стал асинхронным, обрабатывает монеты с префиксом `failed-{ticker}`, при восстановлении автоматически заархивированной монеты извлекается тикер и находится реальный CoinGecko ID через `getCoinIdBySymbol()`, если монета не найдена - возвращается в архив, процесс не продолжается, после добавления в таблицу проверяется успешность загрузки данных через `fetchCoinGecko()` и наличие монеты в таблице, при ошибке добавления или отсутствии монеты в таблице - откат изменений: монета удаляется из таблицы и возвращается в архив с оригинальным ID. Визуальная дифференциация автоматически заархивированных монет: метод `isFailedArchivedCoin(archivedCoin)` проверяет, является ли монета автоматически заархивированной по префиксу `failed-` в ID, метод `getArchivedCoinIcon()` для монет с префиксом `failed-` возвращает `null`, чтобы показать иконку рефреша в шаблоне, в `index.html` добавлена условная отрисовка: для автоматически заархивированных монет показывается иконка Font Awesome `fa-sync-alt` (рефреш) вместо фирменной иконки монеты, иконка рефреша стилизована серым цветом (`text-muted`) и имеет размер 20x20px для соответствия обычным иконкам. В `architect.md` добавлены разделы "Адаптивный таймаут для обработки rate limiting API" и "Синхронизация данных между таблицей и архивом монет" с полным описанием принципов работы. В `ui/guide-ii.md` обновлены разделы: добавлена информация об отключенных полях ввода, цветовых состояниях предупреждений, панельке загрузки монет, синхронизации таблицы и архива, восстановлении монет из архива, линейном добавлении монет списком тикеров с адаптивным таймаутом. ◉ Реализован адаптивный механизм обработки rate limiting через экспоненциальный backoff: система автоматически подстраивается под ограничения API, удваивая задержки при ошибках и постепенно уменьшая при успешных запросах. Это демонстрирует устойчивость к внешним ограничениям и оптимизацию производительности. Синхронизация данных между таблицей и архивом заложила принцип единого источника истины: монета не может существовать одновременно в обоих местах, что предотвращает рассинхронизацию и упрощает логику управления данными. Механизм отката при ошибках восстановления показывает надежность системы: неудачные операции не оставляют данные в неконсистентном состоянии.

## Коммит ec0208b от 10.12.2025 : Add CoinGecko coin search with autocomplete and customizable list
◆ Реализован поиск монет CoinGecko с автодополнением, замена колонки "60d %" на "14d %" и "200d %", сохранение полных данных монет в настройках, изменение логики обновления данных (только при загрузке и по кнопке). → В `ui/api/coingecko.js` заменен параметр запроса с `'1h,24h,7d,30d,60d'` на `'1h,24h,7d,14d,30d,200d'` для получения данных о процентных изменениях за 14 и 200 дней. В `index.html` заменен заголовок таблицы "60d %" на "14d %" и "200d %", colspan ячеек обновлен с 8 на 9, добавлены соответствующие ячейки для отображения `price_change_percentage_14d_in_currency` и `price_change_percentage_200d_in_currency`. В `ui/api/coingecko.js` добавлена инициализация данных из localStorage при монтировании компонента (`cgCoins`, `cgLastUpdated`, `cgSelectedCoins`). При успешном запросе к API данные сохраняются в localStorage (`cgCoins`, `cgLastUpdated`, `cgSelectedCoins`). Изменена логика в `mounted()`: данные загружаются только если `cgCoins.length === 0`, обеспечивая загрузку при старте только если нет сохраненных данных. Список монет для запроса теперь берется из `cgSelectedCoins` вместо хардкодного списка `ids`, что позволяет пользователю настраивать список через поиск. Добавлен метод `searchCoins(query)` для поиска монет через CoinGecko API `/search?query=...` с ограничением на 10 результатов. Добавлен метод `addCoin(coinId)` для добавления монеты в `cgSelectedCoins` и обновления данных. Добавлен метод `removeCoin(coinId)` для удаления монеты из списка. Добавлен watch для `cgSearchQuery` с задержкой 500ms для автоматического поиска при вводе. В `index.html` заменен заголовок "Топ-10 (CoinGecko)" на поле поиска с автодополнением (`input` с `v-model="cgSearchQuery"`, выпадающий список результатов с `v-for="result in cgSearchResults"`). Первая колонка таблицы заменена с `#` на кнопку удаления монеты (`btn-outline-danger` с иконкой `fa-times` и `@click="removeCoin(coin.id)"`). В `architect.md` обновлен раздел "Расширяемая система экспорта/импорта настроек" с упоминанием данных CoinGecko (`cgCoins`, `cgLastUpdated`, `cgSelectedCoins`). ◉ Переход от статического списка монет к динамическому через поиск демонстрирует эволюцию архитектуры: пользователь получает полный контроль над составом данных, что критично для персонализации. Персистентность данных через localStorage создает ощущение непрерывности работы: состояние приложения сохраняется между сессиями. Логика обновления только по запросу показывает принцип экономии ресурсов: данные не обновляются автоматически, снижая нагрузку на API и улучшая производительность.

## Коммит a2bf815 от 10.12.2025 : Improve CoinGecko search: sort by ticker match, add hover effects, cache icons
◆ Улучшена сортировка результатов поиска (полные совпадения по тикеру выше), реализовано кэширование иконок монет для мгновенной загрузки. → В `ui/api/coingecko.js` метод `searchCoins()` дополнен сортировкой результатов: полные совпадения с тикером (case-insensitive) выводятся первыми, затем тикеры, начинающиеся с запроса, затем остальные по `market_cap_rank` (популярности). В `ui/api/coingecko.js` реализовано кэширование иконок монет в `localStorage`: добавлено поле `cgIconsCache` в `data()` для реактивного доступа к кэшу иконок, метод `cacheCoinsIcons(coins)` добавляет иконки в кэш и сохраняет в `localStorage` под ключом `cgIconsCache`, метод `getCoinIcon(coin)` возвращает иконку из кэша или из объекта монеты с автоматическим кэшированием, при загрузке данных из API (`fetchCoinGecko()`) иконки автоматически кэшируются через `cacheCoinsIcons()`, при добавлении монеты через поиск (`addCoin()`) иконка из результатов поиска сразу кэшируется. ◉ Реализована интеллектуальная сортировка результатов поиска по релевантности: точные совпадения приоритезируются, что ускоряет поиск часто используемых монет. Кэширование иконок в localStorage демонстрирует стратегию оптимизации производительности: ресурсы загружаются один раз и переиспользуются, критично для статического приложения без CDN-кэширования, обеспечивая мгновенную загрузку при повторном отображении.

## Коммит dc6b0e2 от 10.12.2025 : Add table sorting, context menu, coin archive, and UI improvements
◆ Реализована глобальная система сортировки таблиц, контекстное меню для операций с монетами, архив монет. → Создан глобальный Vue mixin `ui/utils/table-sort-mixin.js` для циклической сортировки таблиц (3 состояния: null → asc → desc → null). Mixin добавляет методы `handleSort(field)`, `sortData(data, defaultOrder)`, `getSortValue(item, field)`, `getSortIcon(field)` и data-свойства `sortBy`, `sortOrder`. В `ui/api/coingecko.js` подключен mixin через `mixins: [window.tableSortMixin]`, добавлен computed-свойство `sortedCoins()`. Реализовано контекстное меню по клику/правому клику на блок монеты: операции "В начало", "Вверх", "Вниз", "В конец", "В архив", "Удалить". В `ui/api/coingecko.js` добавлены методы: `openContextMenu()`, `closeContextMenu()`, `moveToPosition(position)`, `archiveCoin()`. Добавлено хранилище архивированных монет (`cgArchivedCoins`) в localStorage. ◉ Создан переиспользуемый архитектурный паттерн сортировки через Vue mixin: это заложило основу для единообразной сортировки во всех таблицах проекта, упрощая добавление функциональности в новые компоненты. Контекстное меню как основной способ взаимодействия с элементами таблицы демонстрирует подход к интерактивности: действия скрыты до запроса, сохраняя чистоту интерфейса. Архив как отдельное хранилище показывает принцип организации данных: временно скрытые элементы сохраняются отдельно от активных, позволяя легко восстанавливать их без потери структуры.

## Коммит 3f9d71c от 10.12.2025 : Fix archive dropdown, context menu actions, and add multi-coin search
◆ Реализован множественный поиск монет через разделители, исправлены кнопки перемещения в контекстном меню. → Реализован множественный поиск монет: метод `searchCoins()` теперь разбивает запрос на термины через регулярное выражение `/[^a-zA-Z0-9]+/` (все разделители кроме букв и цифр), выполняет отдельные запросы для каждого термина и объединяет результаты с удалением дубликатов. Исправлен метод `moveToPosition()`: изменена логика перемещения - для 'up' и 'down' используется обмен местами вместо splice, что исправляет баг с неработающими кнопками. ◉ Множественный поиск через разделители демонстрирует гибкость ввода: пользователь может использовать естественные разделители (запятые, пробелы, слэши), что улучшает UX при работе с несколькими монетами одновременно. Исправление логики перемещения через обмен местами показывает важность выбора правильного алгоритма: простое решение (splice) создавало баги, более надежный подход (обмен) обеспечивает корректную работу.

## Коммит 665d722 от 10.12.2025 : Add pluralize utility, convert coins count to button, remove archive indicator
◆ Создана глобальная утилита для склонения русских числительных. → Создан файл `ui/utils/pluralize.js` с глобальной функцией `window.pluralize(number, forms)` для склонения русских числительных по правилам русского языка (1 монета, 2-4 монеты, 5+ монет, 11-19 монет). Подключен `pluralize.js` в `index.html` после `table-sort-mixin.js`. В `ui/api/coingecko.js` добавлен метод `pluralizeCoins(count)` для склонения слова "монета" с использованием глобальной утилиты. В `architect.md` добавлена информация о новой утилите `pluralize.js` в раздел "Текущее размещение файлов" → "UI Utilities". ◉ Создана переиспользуемая утилита локализации для русского языка: правильное склонение числительных улучшает читаемость интерфейса и демонстрирует внимание к деталям локализации. Глобальная доступность через `window.pluralize` обеспечивает использование во всех компонентах без импортов, что упрощает интеграцию в существующий код.

## Коммит a2c1ec1 от 10.12.2025 : Change archive structure to store coin ticker and name separately
◆ Изменена структура хранения архива монет: теперь сохраняются объекты с полями `id`, `symbol` и `name` вместо простых ID. → В `ui/api/coingecko.js` изменена структура `cgArchivedCoins`: теперь массив объектов `{id, symbol, name}` вместо массива строк (ID). При загрузке из localStorage добавлена обратная совместимость: если загружен массив строк (старый формат) - автоматически преобразуется в объекты с fallback значениями. Метод `archiveCoin()` теперь сохраняет объект с тремя полями: `id` (ID монеты), `symbol` (тикер в uppercase), `name` (полное название). Метод `restoreFromArchiveById()` обновлен для работы с объектами: поиск по `archived.id` вместо прямого сравнения строк. Добавлен метод `getArchivedCoinId(archivedCoin)` для получения ID из объекта или строки (обратная совместимость). Методы `getArchivedCoinSymbol()` и `getArchivedCoinIcon()` обновлены для работы с объектами: проверяют `archivedCoin.symbol` и `archivedCoin.id` соответственно. ◉ Миграция структуры данных с сохранением обратной совместимости демонстрирует принцип эволюции без разрыва: пользовательские данные не теряются при обновлении формата, автоматическая миграция обеспечивает плавный переход. Структурированное хранение (объекты вместо строк) улучшает типобезопасность и расширяемость: добавление новых полей не требует изменения логики доступа, что упрощает будущие расширения функциональности.

## Коммит 89b6f62 от 10.12.2025 : Add caching for icons and market metrics, improve archive UI
◆ Реализовано кэширование иконок монет и метрик рынка (не чаще 1 раза в час), добавлена фильтрация символов анимации из кэша. → В `ui/api/coingecko.js` добавлено кэширование иконок монет с проверкой времени: обновление не чаще 1 раза в час через `cgIconsCacheTimestamp` в localStorage. В `ui/interaction/footer.js` реализовано кэширование метрик рынка (FGI, VIX, BTC Dominance, OI, FR, LSR) с проверкой времени (не чаще 1 раза в час). Добавлена функция `filterSpinnerChars()` для фильтрации символов анимации (`|`, `/`, `-`, `\`) из метрик перед сохранением в кэш (заменяются на "—"). При загрузке из кэша: если есть неопределенные метрики ("—"), они продолжают загружаться из API с показом анимации слешами. Кэшируются только успешно загруженные метрики с реальными значениями (пустые значения не кэшируются). ◉ Внедрена стратегия кэширования с временными ограничениями: обновление не чаще раза в час балансирует между актуальностью данных и нагрузкой на API, критично для статического приложения без серверной инфраструктуры. Фильтрация символов анимации из кэша демонстрирует внимание к качеству данных: кэш содержит только валидные значения, а не промежуточные состояния UI, что обеспечивает надежность восстановления состояния приложения.

## Коммит 590f10c от 09.12.2025 : Move market-metrics to core/api and unify header select styles
◆ Перемещен модуль `market-metrics.js` из `ui/api/` в `core/api/` для правильного разделения ответственности. → Создана папка `core/api/` и перемещен `market-metrics.js` из `ui/api/` в `core/api/` (утилита для работы с API, не Vue компонент). Обновлен путь в `index.html`: `./ui/api/market-metrics.js` → `./core/api/market-metrics.js`. Обновлен `architect.md`: добавлен раздел `core/api/` в описание слоев, уточнено назначение `ui/api/` (только Vue компоненты), обновлен список файлов. ◉ Установлена четкая граница между слоями: `core/api/` для утилит и бизнес-логики, `ui/api/` для Vue-компонентов. Это заложило принцип разделения ответственности, упрощающий понимание зависимостей и навигацию по коду: утилиты не зависят от Vue, компоненты используют утилиты.

## Коммит 4cb097a от 09.12.2025 : Restructure UI components into api/interaction folders
◆ Реструктурирована организация UI компонентов: переход от плоской структуры `ui/components/` к иерархической структуре по специализациям `<сектор>/<специализация>/<имя>.<ext>`, удалены префиксы `c-ui-` из имен файлов. → Созданы папки специализации: `ui/api/` (компоненты для работы с внешними API), `ui/interaction/` (компоненты взаимодействия с пользователем). Перемещены и переименованы файлы: `c-ui-import-export.js` → `ui/api/import-export.js`, `c-ui-perplexity-settings.js` → `ui/api/perplexity.js`, `c-ui-coingecko.js` → `ui/api/coingecko.js`, `c-ui-splash.js` → `ui/interaction/splash.js`, `c-ui-theme.js` → `ui/interaction/theme.js`, `c-ui-chat.js` → `ui/interaction/chat.js`. Обновлены пути к скриптам в `index.html` (строки 359-364). Обновлен `architect.md`: удален раздел про префиксы файлов, обновлена структура папок, добавлено описание структуры по специализациям. Удалена пустая папка `ui/components/`. ◉ Переход к иерархической структуре по специализациям заложил принцип организации кода по функциональному назначению: папки `api/` и `interaction/` создают логическую группировку, упрощая навигацию и понимание архитектуры. Удаление префиксов из имен файлов демонстрирует доверие к структуре папок: специализация понятна из пути, что упрощает именование и делает структуру более читаемой.

## Коммит 5059249 от 08.12.2025 : Fix x-template loading order and sync VS Code settings
◆ Исправлен порядок загрузки x-template шаблона (сплэш не отображался), добавлено правило в `.cursorrules`. → В `index.html` перемещен `<script type="text/x-template" id="splash-template">` из конца файла (после всех скриптов) в начало - перед загрузкой Vue.js и компонентов. Это критично, так как Vue должен найти шаблон в DOM до монтирования компонента. В `.cursorrules` добавлено правило "⚠️ Порядок загрузки x-template шаблонов" в раздел "Технические особенности" с описанием правильного порядка: Bootstrap JS → x-template шаблоны → Vue.js → компоненты → app-ui-root.js. ◉ Установлен критический порядок загрузки ресурсов: x-template шаблоны должны быть в DOM до инициализации Vue, что демонстрирует зависимость от порядка выполнения в браузерной среде. Документирование этого правила предотвращает повторение ошибок и обеспечивает правильную инициализацию компонентов.

## Коммит 0dd9d6d от 08.12.2025 : Unify UX into UI: remove separate UX prefix and section
◆ Объединение UX с UI в единую систему: удален префикс `ux-` из системы именования файлов. → В `architect.md` удален префикс `ux-` из списка секторов, обновлено описание: `ui-` теперь включает "оформление и взаимодействие/UX", добавлено примечание что UX является неотъемлемой частью UI и веб-компоненты содержат и визуальное оформление, и логику взаимодействия одновременно, поэтому используется единый префикс `ui-` вместо искусственного разделения. ◉ Унификация UI и UX демонстрирует понимание природы веб-компонентов: визуальное оформление и логика взаимодействия неразделимы в современных интерфейсах. Удаление искусственного разделения упрощает навигацию и принятие решений при создании новых компонентов, отражая реальную архитектуру веб-приложений.

## Коммит 6b5544a от 08.12.2025 : Add security layer with obfuscation and API key field in splash
◆ Добавлена архитектура безопасности с обфускацией чувствительных данных (PIN, API-ключи), система префиксов `sec-` для security-модулей. → Создана папка `core/security/` и модуль `u-sec-obfuscate.js` с методами обфускации/деобфускации через Base64 (`obfuscate`, `deobfuscate`, `saveSecure`, `loadSecure`, `removeSecure`, `hasSecure`). В `architect.md` добавлен слой `core/security/`, сектор `sec-` в систему префиксов, примеры использования (`u-sec-obfuscate.js`, `cfg-sec-keys.js`). В `c-ui-splash.js` добавлено поле `apiKeyPerplexity` (было `apiKey`) с методами `loadApiKey()`, `saveApiKey()`, обфускацией через `window.securityObfuscate`, PIN теперь хранится обфусцированным. В `c-ui-perplexity-settings.js` обновлено хранение API-ключа через обфусцированное хранилище вместо прямого localStorage. В `c-ui-import-export.js` обновлён формат экспорта до v2.0: чувствительные данные экспортируются обфусцированными в блок `secureData` с полями `pin` и `apiKeyPerplexity`, поддержка импорта v1.0 (legacy, открытый текст) и v2.0 (обфусцированный). В `core/cfg-app.js` добавлены комментарии про обфусцированное хранение через `u-sec-obfuscate.js`. Переименовано `apiKey` → `apiKeyPerplexity` во всех компонентах для явности и готовности к расширению (другие API). ◉ Создан архитектурный слой безопасности: обфускация через Base64 обеспечивает базовую защиту чувствительных данных от случайного просмотра в DevTools, не претендуя на криптографическую стойкость. Версионирование формата экспорта демонстрирует принцип обратной совместимости: старые форматы поддерживаются, новые добавляются без разрыва функциональности. Префикс `sec-` и папка `core/security/` заложили основу для расширения системы безопасности при добавлении новых API.

## Коммит 62cdc3e от 08.12.2025 : Reorganize files into core/ui/app folders
◆ Реорганизована структура проекта: файлы перемещены в папки `core/`, `ui/components/`, `app/` согласно архитектуре проекта. → Созданы папки `core/`, `ui/components/`, `app/`. Перемещены файлы: `cfg-app.js` → `core/cfg-app.js`, `c-ui-*.js` → `ui/components/c-ui-*.js`, `app-ui-root.js` → `app/app-ui-root.js`. Обновлены пути в `index.html` для подключения скриптов из новых местоположений. Обновлён `architect.md` с описанием новой структуры папок. ◉ Установлена слоистая архитектура проекта: разделение на `core/` (базовая логика), `ui/` (интерфейс), `app/` (корневая сборка) создает четкую иерархию ответственности. Это заложило фундамент для масштабирования: каждый слой имеет свою роль, что упрощает добавление новых компонентов и понимание зависимостей.

## Коммит ba3f222 от 08.12.2025 : Adopt file prefix naming and rename scripts
◆ Добавлены правила именования файлов с префиксами, переименованы существующие скрипты под новую схему. → Переименованы `config.js`, `cmp-*.js`, `app.js` в `cfg-app.js`, `c-ui-*.js`, `app-ui-root.js`; пути обновлены в `index.html`. В `architect.md` описан желаемый пул префиксов и расширено требование его поддерживать. ◉ Установлена система префиксов именования файлов как архитектурный стандарт: префиксы (`cfg-`, `c-ui-`, `app-`) сразу указывают на тип и назначение файла, упрощая навигацию по кодовой базе. Это заложило основу для масштабируемой структуры проекта, где новые файлы автоматически следуют установленным правилам.

## Коммит f38c6bf от 08.12.2025 : Refactor splash screen into Vue component with x-template
◆ Рефакторинг сплэш-экрана в полноценный Vue компонент с x-template для разделения HTML и JavaScript логики. → В `c-ui-splash.js` преобразован из функции, возвращающей объект с data/methods, в полноценный Vue компонент: добавлен `template: '#splash-template'`, `props: { lastCommitMessage }`, `data()` возвращает объект вместо объекта в `data`, константы (`DEFAULT_PIN`, `PIN_LENGTH`, `STORAGE_KEY_PIN`, `STORAGE_KEY_API`) перенесены в `data()` для доступа через `this`. В `app-ui-root.js` удален `window.cmpSplash()` из массива `parts` (больше не мержится в главное приложение), добавлена регистрация компонента через `app.component('splash-screen', window.cmpSplash)` перед монтированием. Компонент теперь полностью инкапсулирован: вся логика сплэша (PIN, API-ключ, анимация) находится внутри компонента, не влияет на остальное приложение. ◉ Использование x-template для разделения HTML и JavaScript заложило архитектурный паттерн компонентов: разметка отделена от логики, что улучшает читаемость и упрощает поддержку. Полная инкапсуляция компонента демонстрирует принцип изоляции: сплэш-экран не влияет на остальное приложение, что упрощает тестирование и переиспользование.

## Коммит 7927917 от 08.12.2025 : Ensure splash blocks external requests until unlock
◆ Гарантировано, что внешние запросы (например, CoinGecko) не запускаются до ввода пароля через систему событий. → В `c-ui-coingecko.js` добавлен слушатель `app-unlocked`, чтобы запросы к CoinGecko запускались только после разблокировки и не происходили под слоем. В `c-ui-splash` устанавливается `window.appUnlocked` и отправляется событие `app-unlocked`, по которому компоненты начинают свои запросы. ◉ Создана архитектура контроля доступа через события: система событий `app-unlocked` обеспечивает правильную последовательность инициализации компонентов, предотвращая выполнение внешних запросов до авторизации. Это заложило паттерн для всех компонентов, требующих разблокировки приложения.

## Коммит fa1e338 от 07.12.2025 : Add CoinGecko top-10 widget (price & % change)
◆ Добавлен новый компонент `cmp-coingecko.js` для работы с API CoinGecko. → Создан компонент `cmp-coingecko.js`: запрос к `api.coingecko.com/coins/markets` с `price_change_percentage=1h,24h,7d,30d,60d`, форматирование цены/процентов и класс роста/падения. Подключение компонента в `app.js`. Обновление данных при загрузке страницы и по кнопке «Обновить»; поддержка работы без ключей и прокси. ◉ Интеграция внешнего API демонстрирует расширяемость архитектуры: новый компонент легко добавляется в существующую структуру без изменения других модулей. Поддержка работы без ключей показывает принцип graceful degradation: приложение функционирует даже при отсутствии внешних зависимостей, обеспечивая базовую функциональность.

## Коммит 249aee0 от 07.12.2025 : Refactor: вынести Vue в отдельные обычные скрипты без сборки
◆ Разбита логика приложения на отдельные модули-компоненты и собрана в `app.js`. → Тема, настройки Perplexity, чат и импорт/экспорт вынесены в независимые объекты-компоненты (`cmp-theme.js`, `cmp-perplexity-settings.js`, `cmp-chat.js`, `cmp-import-export.js`), подключаемые в `app.js`. `app.js` агрегирует компоненты, подключает список моделей из конфига, монтирует Vue-приложение и синхронизирует с `localStorage`. `index.html` подключает все скрипты как обычные `<script>` для совместимости с `file://`. ◉ Создана модульная архитектура компонентов: разделение по функциональным областям (тема, настройки, чат, импорт/экспорт) обеспечивает переиспользуемость, тестируемость и упрощает навигацию по коду. Централизованный стейт через `app.js` гарантирует синхронизацию данных между компонентами без дублирования логики.

## Коммит 89297a9 от 07.12.2025 : Add Perplexity AI integration with export/import settings to JSON
◆ Добавлена интеграция с Perplexity AI и система экспорта/импорта настроек в JSON. → В `index.html` добавлен компонент для работы с Perplexity AI: настройки API-ключа, выбор модели, чат с AI, экспорт/импорт настроек в JSON формат. Реализован интерфейс чата с поддержкой отправки сообщений и получения ответов от Perplexity API. ◉ Интеграция Perplexity AI заложила основу для AI-функциональности приложения: пользователь может взаимодействовать с AI-моделью для получения информации и помощи. Система экспорта/импорта настроек демонстрирует принцип переносимости данных: пользователь может сохранить свои настройки и восстановить их на другом устройстве.

## Коммит 8eba1ea от 07.12.2025 : Restore Vue init into external scripts (config.js/app.js)
◆ Вынесена инициализация Vue из инлайна в отдельные скрипты `config.js` и `app.js` для работы без сборки. → В `config.js` добавлен `window.appConfig` с дефолтными значениями темы, модели Perplexity и API-ключом по умолчанию. В `app.js` создан `createApp` без `type="module"`: загрузка/сохранение темы и ключа в `localStorage`, форматирование сообщений, экспорт/импорт настроек, автопрокрутка чата. `index.html` теперь подключает глобальный Vue и внешние скрипты `config.js`/`app.js` вместо большого инлайн-блока. ◉ Разделение конфигурации и логики приложения заложило архитектурный принцип модульности: конфигурация (`config.js`) содержит статические данные и настройки, логика (`app.js`) - динамическое поведение. Это упрощает поддержку и тестирование, а также позволяет работать без сборки, что критично для статического приложения на GitHub Pages.

## Коммит 34cd3fb от 06.12.2025 : Update logging system: switch to manual daily protocol, add .gitignore, remove Python dependencies
◆ Обновлена структура проекта: добавлен `.gitignore`, удалены Python-зависимости. → Добавлен `.gitignore` (Python артефакты, временные файлы, системные файлы) и удалены `log_chat.py`/`__pycache__`. ◉ Установлен стандарт чистоты репозитория: `.gitignore` предотвращает попадание временных файлов и артефактов сборки в версионный контроль, что критично для поддержания читаемости истории изменений. Удаление Python-зависимостей показывает переход к чисто фронтенд-архитектуре без серверных компонентов.

## Коммит ce3e564 от 06.12.2025 : Remove unused ui.js file
◆ Удалён устаревший `ui.js` после миграции логики в Vue. → Выполнен `git rm ui.js`, проверено отсутствие ссылок на файл, затем создан коммит через `git.exe`. ◉ Удаление устаревшего кода демонстрирует принцип поддержания чистоты кодовой базы: после миграции логики в Vue внешний файл стал избыточным, его удаление упрощает навигацию и предотвращает путаницу. Это заложило практику регулярной очистки проекта от неиспользуемых артефактов.

## Коммит 52f6e11 от 06.12.2025 : Add Font Awesome icons and theme toggle button with dark/light mode support
◆ Логика переключения темы перенесена обратно во Vue-приложение, исключена необходимость внешнего скрипта. → Атрибут `:data-bs-theme="theme"` повешен прямо на `<html>`. Внутри `createApp` добавлены `methods.applyTheme`, `methods.toggleTheme`, `watch.theme` и загрузка из `localStorage` в `mounted`. Кнопка теперь напрямую вызывает Vue-метод, а `localStorage` обновляется из компонента. ◉ Консолидация логики темы в Vue-приложении демонстрирует принцип централизации состояния: все управление темой происходит через реактивную систему Vue, обеспечивая синхронизацию между UI и хранилищем. Использование `data-bs-theme` на корневом элементе показывает эффективное использование возможностей Bootstrap: один атрибут управляет всей цветовой схемой приложения через каскадность CSS.

## Коммит 7be4bde от 06.12.2025 : Add Font Awesome, theme toggle button, and extract UI functionality to ui.js
◆ Логика переключения темы вынесена в отдельный файл `ui.js`, UI-логика стала модульной. → Создан файл `ui.js`: функции `initThemeToggle`, `applyTheme`, `toggleTheme`, watcher `theme`, загрузка/сохранение `localStorage` и установка `data-bs-theme` на `<html>`. Vue-конфигурация теперь собирается в `appConfig`, обрабатывается `initThemeToggle` и только потом монтируется. ◉ Установлен принцип модульности: выделение UI-логики в отдельный файл создало предпосылку для разделения ответственности между разметкой и логикой. Это заложило основу для будущей архитектуры компонентов, где каждый модуль отвечает за свою область функциональности.

## Коммит e245cda от 06.12.2025 : Add Principles section and Vue.js 3 + Bootstrap 5 integration
◆ Подключены Vue 3 и Bootstrap 5.3.2, создан стартовый Vue-компонент и структура приложения. → Подключён Vue 3 (`https://unpkg.com/vue@3/dist/vue.global.js`), создан `createApp({ data, mounted })` и смонтирован в `#app`. В разметке добавлен `container-fluid` с заголовками и местом под будущие виджеты. ◉ Заложен фундамент архитектуры приложения: выбор Vue 3 как реактивного фреймворка обеспечивает декларативный подход к UI, а Bootstrap 5 предоставляет готовую систему компонентов и утилит. Это создало основу для масштабируемого фронтенд-приложения без необходимости сборки, работающего напрямую в браузере.