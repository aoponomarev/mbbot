# Руководство по интерфейсу и взаимодействию

> Оглавление `docs/guide-ii.md`
- § *Понятия* — термины и определения для UI/UX
- § *Принципы стилизации* — общие подходы к оформлению
- § *Системы управления* — цветовая модель, z-index, маркировка, иконки
- § *Компоненты интерфейса* — хедер, футер, сплэш-экран, карточки, меню
- § *Паттерны взаимодействия* — навигация, формы, обратная связь, доступность
- § *Управление состоянием* — персистентность, кэширование, парадигмы переключения представлений
- § *Review-страницы* — документация UI элементов

> § <br> **ПОНЯТИЯ**

- **Interface** — оформление, визуальные стили, компоненты интерфейса
- **Interaction** — паттерны UX, базовые паттерны взаимодействия приложения
- **Маркировка контейнеров** — автоматическая маркировка значимых контейнеров через CSS классы `avto-{Base58_8символов}` для навигации в коде через DevTools и указания агенту места в разметке. Классы `avto-*` используются только для маркировки, не используются в JS/CSS
- **Детерминированный хэш экземпляра** — уникальный Base58 хэш, генерируемый через computed свойство `instanceHash` на основе props компонента для возможности кастомной стилизации конкретных экземпляров переиспользуемых компонентов
- **Парадигма переключения представлений (View Switching Pattern)** — централизованное управление состоянием активного представления через единую точку истины в корневом компоненте приложения с реактивным распространением состояния между компонентами
- **Страница** — контейнер с классом `avto-X7pL2nQ` (корневой контейнер контента приложения). ИИ-агент должен понимать, что когда пользователь говорит "страница", речь идет именно об этом контейнере

> § <br> **ПРИНЦИПЫ СТИЛИЗАЦИИ**

## Приоритет Bootstrap

Использовать Bootstrap классы и утилиты в приоритете. Минимизировать кастомные CSS стили, inline стили и секции `<style>` в HTML файлах.

## Вынесение стилей в отдельные файлы

Все кастомные CSS стили выносятся в отдельные файлы в структуре `ui/styles/`. Стили группируются по компонентам.

## Динамические стили

Динамические стили в JavaScript (вычисляемые значения, анимации) могут оставаться в JS, но базовые стили должны быть в CSS файлах.

## Радиусы скругления

Использовать дефолтные значения Bootstrap (`var(--bs-border-radius)`). Избегать кастомных `border-radius`, если не требуется специфичное оформление.

## Документирование CSS

**Принцип трансляции конкретики CSS в комментарии**: Конкретные значения свойств, размеры, цвета, отступы и другие детали реализации CSS правил должны документироваться в комментариях соответствующих CSS файлов, а не в `guide-ii.md`. В `guide-ii.md` остаются только общие подходы, принципы и концепты.

**Правила переноса**:
- Конкретные значения свойств (размеры, отступы, цвета, z-index) → комментарии в соответствующих CSS файлах
- Детали реализации компонентов (структура, селекторы, медиа-запросы) → комментарии в соответствующих CSS файлах
- Общие принципы и концепты (приоритет Bootstrap, HSL модель, система z-index) → остаются в `guide-ii.md`
- Паттерны использования и правила применения → остаются в `guide-ii.md`

## Цветовая схема и темы

Поддержка светлой (`light`) и темной (`dark`) темы через Bootstrap `data-bs-theme`. Хедер всегда в темной теме, не реагирует на переключение темы приложения. Футер фон соответствует теме, тень сверху для визуального отделения.

## Типографика

Моноширинный шрифт используется для метрик и числовых значений для предотвращения "дергания" строки при анимации. Базовый размер шрифта Bootstrap, метрики с увеличенным размером для визуального совпадения.

## Анимации и переходы

Индикатор загрузки метрик: вращающиеся символы вместо тире во время загрузки. Индикатор загрузки цитаты: анимированные точки на сплэш-экране. Плавные переходы для hover состояний.

## Адаптивность

Использование стандартных breakpoints Bootstrap. Упрощенный интерфейс на мобильных (dropdown вместо селектов, скрытие второстепенной информации). Увеличенные области нажатия на мобильных для touch-friendly интерфейса.

## Адаптивные отступы (Spacing)

**ОБЯЗАТЕЛЬНО**: Для управления горизонтальными отступами на мобильных устройствах **ВСЕГДА** использовать Bootstrap утилиты отступов (Spacing utilities), а не кастомные CSS стили или медиа-запросы.

Bootstrap использует mobile-first подход. Для обнуления горизонтальных отступов на мобильных устройствах используется класс `px-0`. Если требуется восстановить отступы на больших экранах, используются responsive классы с префиксами.

Не использовать кастомные CSS правила или медиа-запросы для управления отступами, если это можно сделать через Bootstrap утилиты. Это обеспечивает консистентность, упрощает поддержку и следует принципу приоритета Bootstrap классов.

## Полосы прокрутки

Вертикальная полоса прокрутки всегда видна глобально для предотвращения "дергания" интерфейса при появлении/исчезновении полосы. Горизонтальная полоса прокрутки скрыта визуально глобально, но горизонтальная прокрутка доступна через Shift + колесико мыши (или пальцем на мобильных).

> § <br> **СИСТЕМЫ УПРАВЛЕНИЯ**

## Цветовая модель HSL/HSLA

**Принцип**: Проект использует цветовую модель **HSL (Hue, Saturation, Lightness)** с альфа-каналом (**HSLA**) как основу для всех цветовых определений. Это архитектурное решение, обеспечивающее консистентность, удобство настройки и поддержки цветовой схемы.

**Преимущества**:
- Интуитивность настройки: параметры Hue (тон), Saturation (насыщенность), Lightness (яркость) соответствуют человеческому восприятию цвета
- Легкость создания вариаций: изменение одного параметра позволяет создавать семейства связанных цветов без пересчета RGB значений
- Удобство адаптации под темы: легко создавать варианты цветов для светлой и темной темы, изменяя только Lightness при сохранении Hue и Saturation
- Централизованное управление: все цвета определяются через HSL переменные в `ui/styles/theme-colors.css`
- Оптимизация и переиспользование: общие значения (Hue, Saturation) могут быть вынесены в переменные для переиспользования

**Реализация**:
- Все цвета определяются через HSL/HSLA переменные в `ui/styles/theme-colors.css`
- Формат: `hsl(h, s%, l%)` или `hsla(h, s%, l%, alpha)`
- Структура переменных: разделение на компоненты (H, S, L) позволяет переиспользовать общие значения
- Избегание альтернативных форматов: не использовать `rgba()`, `rgb()`, hex-коды в CSS правилах

**Связь с Bootstrap**: Кастомные цвета отталкиваются от рутовых переменных Bootstrap. Переопределение Bootstrap переменных через HSL значения обеспечивает совместимость с компонентами Bootstrap при сохранении кастомизации. RGB значения для Bootstrap совместимости вычисляются из HSL и хранятся в `--bs-primary-rgb` и аналогичных переменных.

## Система z-index слоев

**Принцип**: Все значения `z-index` определяются через CSS переменные в `ui/styles/z-index.css` и связаны с Bootstrap z-index переменными для обеспечения консистентности и совместимости с компонентами Bootstrap.

**Преимущества**:
- Единая точка управления: все z-index значения находятся в одном файле
- Совместимость с Bootstrap: переменные связаны с Bootstrap z-index переменными
- Предотвращение конфликтов: централизованное управление предотвращает случайные конфликты z-index
- Легкость изменения: изменение z-index значения в одном месте автоматически применяется ко всем элементам

**Правила использования**:
- Все z-index значения должны использовать переменные из `ui/styles/z-index.css`
- Избегать хардкодных значений `z-index` в CSS правилах и inline стилях
- При необходимости нового z-index слоя добавить переменную в `z-index.css` с учетом иерархии Bootstrap
- Значения должны быть связаны с Bootstrap переменными где возможно для обеспечения совместимости

## Маркировка контейнеров

**Назначение**: Автоматическая маркировка значимых контейнеров через CSS классы для удобной навигации в коде через DevTools и указания агенту места в разметке.

**Формат**: Префикс `avto-`, формат `avto-{Base58_8символов}`. Признак: класс начинается с `avto-` → чистый контейнер без JS/CSS зависимостей.

**Правила применения**:
1. **Маркировать автоматическим классом** (`avto-{hash}`): основные секции (`<main>`, `<section>`, корневые `.container-fluid`), функциональные блоки (`.card`, корневые контейнеры виджетов), корневые контейнеры компонентов без JS-зависимостей
2. **НЕ маркировать**: мелкие обертки без функционального значения, части компонентов внутри родительских, элементы только для сетки (`.row`, `.col-*`)
3. **Осмысленные ID** (не `avto-*`): элементы с JS-зависимостями, элементы с CSS-селекторами по ID, элементы форм, привязанные к JS

**Изоляция**: Классы `avto-*` используются только для маркировки, не используются в JS/CSS. ID используются только для JS-зависимых элементов. Полная изоляция: классы = маркировка, ID = функциональность.

**Детерминированные хэши для экземпляров компонентов**: Все экземпляры переиспользуемых компонентов должны иметь детерминированные уникальные хэши для возможности кастомной стилизации конкретных экземпляров. Каждый экземпляр компонента должен иметь computed свойство `instanceHash`, которое генерирует детерминированный Base58 хэш на основе уникального идентификатора экземпляра через утилиту `window.hashGenerator.generateMarkupClass(uniqueId)`. Уникальный идентификатор берется из props компонента. Хэш добавляется в шаблон компонента через computed свойство `instanceHash` и используется в `:class` биндинге вместе с другими CSS классами. Исключения: компоненты-контейнеры, которые используются только один раз в приложении, могут использовать статический хэш или не иметь хэша. Компоненты без уникальных идентификаторов могут не иметь `instanceHash` (но рекомендуется добавить prop для идентификации).

## Система иконок

**Принцип**: Архитектурный принцип централизованного управления UI элементами (иконки, кнопки, меню) через декларативную конфигурацию (JSON) и стили через CSS переменные, зарутованные от Bootstrap.

**Концепт централизованного управления**: Система UI элементов построена на принципе разделения ответственности:
- **Декларативная конфигурация** (JSON): все соответствия иконок и команд описаны в структурированном JSON файле `ui/config/ui-element-mapping.json`
- **Стили через CSS переменные**: все стили иконок определяются через CSS переменные в `ui/styles/icons.css`, зарутованные от Bootstrap переменных
- **Программный доступ**: утилита `ui/utils/ui-element-helper.js` предоставляет функции для получения конфигурации UI элементов по категориям

**Преимущества**:
- Единая точка управления: все соответствия иконок и команд находятся в одном JSON файле
- Консистентность стилей: стили иконок определяются через CSS переменные, зарутованные от Bootstrap переменных
- Легкость добавления новых элементов: добавление нового UI элемента требует только обновления JSON файла и при необходимости CSS переменных
- Централизованное управление цветами: цвета иконок фреймворков и статусов определяются через CSS переменные
- Раздельные tooltips: система поддерживает раздельные tooltips для основной части (иконка + текст) и индикатора в компонентах button и menu-item

**Структура системы**:
- **JSON файл соответствий** (`ui/config/ui-element-mapping.json`): содержит схему соответствий. Схема `icons` (одна иконка → много команд) позволяет одной иконке соответствовать нескольким командам. Индикаторы хранятся в схеме `icons` как команды с `category: "indicators"`
- **CSS файл стилей** (`ui/styles/icons.css`): определяет CSS переменные для цветов иконок, зарутованные от Bootstrap переменных
- **Утилита** (`ui/utils/ui-element-helper.js`): предоставляет функции для получения конфигурации UI элементов (иконки, labels, tooltips, цвета) по категориям и командам, функции для индикаторов и SVG-иконок
- **Review-файлы**: статистика проекта, каталог иконок, каталог цветов, каталог сообщений используют единую систему управления через `ui/review-manager.js` и `ui/review-styles.css`
- **SVG-иконки**: хранятся в `ui/assets/icons/` с префиксом `icon-`, поддерживают CSS переменные для настройки цвета и толщины линий, загружаются через `<object>` тег для поддержки `currentColor` и CSS переменных

**Правила использования**:
- Единая схема "одна иконка → много команд": все иконки и команды хранятся в схеме `icons`
- Все соответствия иконок и команд должны быть описаны в `ui/config/ui-element-mapping.json`
- **⚠️ ВАЖНО - Встроенное содержимое**: Для избежания CORS проблем при работе с `file://` протоколом, содержимое `ui-element-mapping.json` встроено непосредственно в `ui/utils/ui-element-helper.js` как константа `uiElementMapping`. При добавлении новой иконки или команды **ОБЯЗАТЕЛЬНО** обновлять оба места
- Индикаторы хранятся как команды с `category: "indicators"`: индикаторы имеют дополнительные поля `type` и `value`
- Стили иконок должны использовать CSS переменные из `ui/styles/icons.css`: избегать хардкодных цветов в CSS правилах и inline стилях
- Цвета иконок должны быть зарутованы от Bootstrap переменных для автоматической адаптации к темам
- Компоненты `button` и `menu-item` используют схему `icons`: при указании `icon-command` компоненты ищут команду в схеме `icons` через `uiElementHelper`
- Раздельные tooltips: компоненты `button` и `menu-item` поддерживают раздельные tooltips для основной части (иконка + текст) и индикатора. Паддинги Bootstrap переносятся на дочерние элементы для корректной работы tooltips
- SVG-иконки: определяются через `uiElementHelper.isSVGIcon()` и загружаются через `uiElementHelper.getSVGIconPath()`

**Связь с Bootstrap**: CSS переменные иконок используют Bootstrap переменные как основу, что обеспечивает автоматическую адаптацию цветов иконок к темам приложения (light/dark) и консистентность с остальными элементами интерфейса.

> § <br> **КОМПОНЕНТЫ ИНТЕРФЕЙСА**

## Хедер

Фиксированный сверху, z-index через переменную из системы z-index слоев. Темный фон, не реагирует на переключение темы приложения. Боковые паддинги отсутствуют для десктоп и мобильной версии. Структура: 3 секции (левая: гамбургер, средняя: селект/вкладки, правая: кнопки управления). Селекты: полупрозрачный фон, белый текст, полупрозрачная стрелка. Вкладки: Bootstrap `btn-group` с `btn-check`, активная/неактивная вкладка различаются прозрачностью текста. Кнопки управления: без ободков, только иконки, легкая подсветка при наведении. Dropdown меню: всегда в темной теме, идентичное оформление для десктоп и мобильной версии, используют дефолтные радиусы скругления Bootstrap. Всплывающие подсказки (tooltips): всегда в темной теме, инициализируются через Bootstrap Tooltip API. Адаптивность: на десктопе селект модели, на мобильных — dropdown. Вкладки: десктоп — радиокнопки, мобильные — dropdown.

## Футер

Фиксированный внизу, z-index через переменную из системы z-index слоев, тень сверху. Адаптивность: десктоп — все индикаторы равномерно распределены, мобильные — только метрики рынка с горизонтальной прокруткой, версии фреймворков скрыты. Метрики: моноширинный шрифт с увеличенным размером для предотвращения "дергания" строки при анимации.

## Сплэш-экран

Фиксированный, полный экран, z-index через переменную из системы z-index слоев, темный фон. Контейнер: ограниченная максимальная ширина, адаптивная ширина. Поле ввода API-ключа: по умолчанию прозрачное, при фокусе становится видимым. Индикатор загрузки: анимированные точки вместо спиннера.

## Карточки

**Паттерн создания хедеров карточек**: Все хедеры карточек изначально создаются с простым заголовком, затем дополняются специфичными контролами. Это обеспечивает единообразие структуры, упрощает поддержку и позволяет постепенно наращивать функциональность. Эталонный пример: компонент `ui/components/header-coins.js`. Правила создания: начинать с простого заголовка и базовой структуры, добавлять специфичные контролы постепенно, использовать props для получения данных и emits для взаимодействия с родительским компонентом, следовать структуре и паттернам эталонного компонента.

Хедер карточки: увеличенные вертикальные паддинги для улучшенной читаемости, более темный фон для визуального отделения от основного контента. Кнопки в хедере карточки: единый стиль для всех кнопок, адаптируются под тему, фиксированная ширина для предотвращения "прыжков" интерфейса. Выпадающие меню внутри `<main>`: единый стиль для всех выпадающих меню, контрастная рамка и тень, цвет текста одинаковый во всех состояниях, подсветка только через фон. Стиль фокуса: фокус пунктов меню использует общую рутовую переменную (такой же стиль, как у выбранных строк таблицы), без черной рамки Bootstrap.

## Универсальные компоненты меню

**Принцип**: Использование универсальных компонентов `menu-item` и `dropdown-menu` для обеспечения единообразия всех выпадающих меню в приложении.

**Компонент `menu-item` (пункт меню)**: Структура: иконка (слева) + Текст команды (центр) + Индикатор (справа). Стилизация: все паддинги на дочерних элементах, фиксированные ширины для иконки и индикатора, минимальная высота. Интеграция с системой UI элементов: использует `uiElementHelper` для загрузки конфигурации (иконки, labels, tooltips) из `ui-element-mapping.json`. Индикаторы: универсальный объект `indicator` для статусов (selected, disabled, loading, warning, error) или язычков переходов (submenu, external, modal).

**Компонент `dropdown-menu` (выпадающее меню)**: Клавиатурная навигация: `Escape` — закрытие меню, `ArrowDown` / `ArrowUp` — перемещение по пунктам, `Home` / `End` — переход к первому/последнему пункту, `Tab` — стандартная навигация. Автофокус: автоматический фокус на первом элементе при открытии. Управление курсором: prop `trigger-selector` автоматически устанавливает `cursor: pointer` на элементе-триггере. Позиционирование: гибкое позиционирование (absolute/fixed) с различными размещениями (bottom-start, bottom-end, top-start, top-end). Закрытие: закрытие по клику вне меню, по Escape, через событие `@close`.

**Правила использования**: Все выпадающие меню должны использовать компонент `dropdown-menu`. Все пункты меню должны использовать компонент `menu-item`. Каждый экземпляр должен иметь уникальный `instanceId` для `instanceHash`. Элементы-триггеры должны иметь `trigger-selector` для автоматической установки курсора.

Подробнее см. раздел "Паттерны универсальных компонентов" в `docs/architect.md`.

## Специализированные компоненты

**Счетчик монет**: Кнопка счетчика: фиксированная ширина для двузначных чисел, выравнивание текста по центру, формат отображения зависит от состояния выбора. Выпадающее меню счетчика: опции массовых операций, подсветка работает корректно для всех элементов, включая disabled.

**Отключенные поля ввода**: Disabled поля в темной теме: глобальные стили для всех типов disabled полей ввода, кастомные стили с `!important` для переопределения Bootstrap (Bootstrap по умолчанию применяет белый фон для disabled элементов, что плохо видно в темной теме).

**Цветовые состояния предупреждений**: Неудачные тикеры при добавлении монет: кастомные цвета для лучшей читабельности на светлом фоне, стандартный желтый цвет Bootstrap заменен на более контрастный темно-оранжевый.

**Панелька загрузки монет**: Позиционирование: верхний край панельки выровнен с верхней границей card-header, реализовано через отрицательный margin-top с использованием единиц `ex` для точного вертикального позиционирования.

> § <br> **ПАТТЕРНЫ ВЗАИМОДЕЙСТВИЯ**

## Навигация

Хедер: фиксированный сверху, всегда видимый, обеспечивает быстрый доступ к основным функциям. Гамбургер-меню: левая секция хедера, готов к реализации бокового меню. Вкладки отображения (View Tabs): переключение между режимами отображения данных. Реализует парадигму переключения представлений (View Switching Pattern) с централизованным управлением состоянием через корневой компонент. Активное представление сохраняется в `localStorage` для персистентности между сессиями.

## Формы и ввод данных

PIN-код: PIN для разблокировки приложения, автоматическая валидация при вводе. API-ключ: поле ввода на сплэш-экране, скрыто до фокуса, автоматическое сохранение при вводе. Селекты: десктоп — нативный `<select>`, мобильные — Bootstrap dropdown для лучшего UX.

## Обратная связь

Индикаторы загрузки: вращающиеся символы для метрик рынка, анимированные точки для цитаты на сплэш-экране. Цветовые состояния: визуальная обратная связь через цвет иконок метрик. Сообщения об ошибках: Alert компоненты Bootstrap для отображения ошибок.

## Состояния компонентов

Загрузка: флаги `isLoading` для отслеживания состояния загрузки, визуальные индикаторы. Активность: выделение активных элементов (вкладки, выбранные опции). Отключенные элементы: `disabled` состояние для кнопок и полей ввода во время загрузки.

## Доступность

Подсказки: `title` атрибуты для кнопок и элементов управления. Bootstrap tooltips с инверсной темой для визуального контраста с хедером. Клавиатурная навигация: стандартная навигация через Tab, полная поддержка клавиатурной навигации в выпадающих меню (Escape, стрелки, Home/End) через компонент `dropdown-menu`, автофокус на первом элементе при открытии меню. Семантическая разметка: использование правильных HTML элементов. Курсор: автоматическая установка `cursor: pointer` на элементах-триггерах выпадающих меню через prop `trigger-selector` компонента `dropdown-menu`.

## Паттерны взаимодействия

Переключение темы: кнопка в хедере, мгновенное применение через `data-bs-theme`. Обновление страницы: кнопка рефреша в хедере. Разблокировка приложения: PIN-код на сплэш-экране, автоматическая проверка при вводе. Настройка API: поле ввода на сплэш-экране, сохранение при нажатии кнопки сохранения. Глобальное закрытие выпадающих списков: клик за пределами любого выпадающего списка закрывает все открытые выпадающие элементы одновременно. Реализовано через глобальный обработчик в корневом компоненте (`closeAllDropdowns()`), который использует событие `close-all-dropdowns` для уведомления всех компонентов. Обеспечивает консистентное поведение и чистый интерфейс (одновременно открыт только один элемент).

**Управление списком монет**:
- Поиск монет: поле поиска с автодополнением, поддержка множественного поиска через разделители, результаты сортируются по релевантности, автоматическое закрытие выпадающего списка при клике вне области, кастомные пункты для быстрого добавления топ монет при вводе числа
- Избранное монет (хранилище избранного): избранное — это хранилище: монета может одновременно присутствовать в таблице и в избранном. При добавлении монеты в таблицу она НЕ удаляется из избранного. При удалении монеты из таблицы она добавляется в избранное (если ещё не там)
- Контекстное меню: доступно по клику на блок иконка+тикер, операции: открытие на внешних ресурсах, управление избранным, удаление из таблицы, автоматическое закрытие при клике вне области
- Система избранного: персистентное хранение избранных монет в `localStorage`, состояние сохраняется между сессиями и автоматически восстанавливается при загрузке приложения, управление доступно через контекстное меню монет
- Счетчик монет: интерактивная кнопка с выпадающим меню для массовых операций, отображает количество выбранных монет или общее число, формат зависит от состояния выбора
- Сортировка таблицы: циклическая сортировка по клику на заголовок колонки, первый клик по несортированной колонке начинается с сортировки по убыванию, глобальный mixin для переиспользования
- Линейное добавление монет списком тикеров: режим автоматически активируется при вставке списка тикеров, тикеры разделяются не-алфавитными символами и автоматически фильтруются, добавление происходит последовательно с визуальной обратной связью, используется адаптивный таймаут для обработки rate limiting API
- Добавление монет из избранного в таблицу: при добавлении монеты из избранного с неудачным тикером система автоматически находит реальный ID по тикеру

> § <br> **УПРАВЛЕНИЕ СОСТОЯНИЕМ**

## Персистентность

Тема: сохранение выбранной темы в `localStorage`. API-ключ: сохранение API-ключа в `localStorage` (обфусцированно). PIN-код: сохранение PIN-кода в `localStorage` (обфусцированно). Активная вкладка (Active View State): сохранение идентификатора активного представления в `localStorage` через Vue watcher в корневом компоненте. Состояние автоматически восстанавливается при перезагрузке приложения. Все компоненты получают активное представление реактивно через `this.$root.activeTab` или `window.appRoot.activeTab`. Список монет: сохранение выбранных монет, избранных монет, данных CoinGecko в `localStorage`.

## Кэширование данных

Иконки монет: кэшируются в localStorage с временным ограничением, обеспечивают мгновенную загрузку при повторном отображении. Метрики рынка: кэшируются в localStorage с временным ограничением, неопределенные метрики продолжают загружаться из API с показом анимации. Фильтрация анимации: символы анимации не попадают в кэш, заменяются перед сохранением. Валидация кэша: кэшируются только успешно загруженные данные с реальными значениями. Пустые значения не кэшируются.

## Многоязычность

Определение языка: автоматическое определение языка системы через `navigator.language`. Генерация контента: философские предложения генерируются на языке системы пользователя.

## Парадигма переключения представлений (View Switching Pattern)

**Принцип**: Централизованное управление состоянием активного представления (view) через единую точку истины в корневом компоненте приложения. Парадигма обеспечивает реактивное распространение состояния между компонентами и синхронизацию UI элементов с активным представлением.

**Архитектурная модель**: Single Source of Truth (SSOT) для состояния представления с реактивным распространением через Vue.js реактивную систему.

**Компоненты парадигмы**:
1. **Централизованное состояние** (`app/app-ui-root.js`): `activeTab` — реактивное свойство корневого компонента, хранящее идентификатор активного представления. Персистентность: сохранение состояния в `localStorage` через Vue watcher для восстановления при перезагрузке. Инициализация: загрузка сохраненного состояния из `localStorage` при монтировании приложения
2. **Управление переключением** (`ui/interaction/header.js`): `switchTab(tabId)` — метод переключения активного представления, обновляющий `activeTab` в корневом компоненте. `displayTabs` — конфигурация доступных представлений (массив объектов с `id` и `label`). Побочные эффекты: автоматическое управление видимостью компонентов
3. **Реактивное распространение состояния**: доступ к состоянию через `this.$root.activeTab` или `window.appRoot.activeTab`, computed свойства для автоматического обновления при изменении, условный рендеринг через `v-if` и `v-show`
4. **UI компоненты переключения**: десктоп — Bootstrap `btn-group` с радиокнопками (`btn-check`), мобильные устройства — Bootstrap dropdown, визуальная обратная связь через CSS классы

**Преимущества**: Единая точка истины, реактивность, персистентность, расширяемость, разделение ответственности.

**Структура данных**: Состояние `activeTab` хранится в корневом компоненте, персистентность через `localStorage`. Конфигурация представлений определяется в компоненте хедера через массив `displayTabs`.

**Правила использования**: Все компоненты должны получать `activeTab` из корневого компонента, не хранить локальную копию. Переключение представлений должно происходить только через метод `switchTab()` компонента хедера. Новые представления добавляются в массив `displayTabs` компонента хедера. Компоненты, зависящие от активного представления, должны использовать computed свойства для реактивности.

**Связь с другими паттернами**: Условный рендеринг через `v-if="activeTab === 'percent'"`. Column Visibility Management: использование `activeTab` для управления видимостью колонок таблиц. State Management: парадигма является частью общей архитектуры управления состоянием приложения.

## Управление видимостью колонок таблицы через вкладки

**Принцип**: Переиспользуемый Vue mixin для управления видимостью колонок таблицы на основе активного представления (active view). Реализует паттерн View-based Column Visibility Management, интегрируясь с парадигмой переключения представлений через реактивное отслеживание `activeTab` из корневого компонента.

**Файл**: `ui/utils/column-visibility-mixin.js`

**Архитектурная интеграция**: Mixin является расширением парадигмы переключения представлений (View Switching Pattern), используя централизованное состояние `activeTab` для управления видимостью колонок таблиц. Это обеспечивает синхронизацию отображения данных с активным представлением пользователя.

**Использование**: Подключить mixin к компоненту, определить конфигурацию колонок в `data()`, добавить `<colgroup>` с `<col>` тегами в таблицу, добавить классы к `<th>` и `<td>` элементам. Опционально: определить метод `getColumnClasses()` для явного указания всех классов колонок.

**Пример конфигурации**: Объект с ключами-идентификаторами вкладок и значениями-объектами с массивом классов колонок для скрытия.

**Преимущества**: Переиспользуемость, гибкость конфигурации с поддержкой префиксного совпадения классов, мгновенное переключение через CSS классы, автоматическое определение активной вкладки из корневого компонента.

**Структура mixin**: Computed свойства для получения активной вкладки и вычисления классов видимости, watchers для автоматического пересчета ширины колонок, методы для расчета и установки ширины колонок, hooks для инициализации при монтировании компонента.

**CSS правила**: Скрытие колонок реализовано через CSS классы на `<col>`, `<th>` и `<td>` элементах для мгновенного переключения без перерисовки таблицы.

**Правила использования**: Конфигурация должна быть определена в `data()` компонента, классы колонок должны быть добавлены к соответствующим элементам, для префиксного совпадения использовать базовый класс.

**Интеграция с парадигмой переключения представлений**: Зависимость от централизованного состояния, реактивное обновление, конфигурация представлений, мгновенное переключение.

**Автоматический расчет ширины колонок**: Mixin автоматически рассчитывает и устанавливает ширину колонок на основе числа видимых колонок на текущей вкладке для равномерного распределения пространства. Пересчет происходит автоматически при переключении вкладок, изменении видимости колонок и монтировании компонента.

**Связь с другими фичами**: Используется вместе с `table-sort-mixin.js` для полнофункциональных таблиц, CSS правила универсальны и работают с любыми таблицами, является частью общей архитектуры управления состоянием представлений.

> § <br> **REVIEW-СТРАНИЦЫ**

## Единая DOM-структура review-страниц

**Цель**: Обеспечить единообразную, предсказуемую структуру DOM для всех вкладок/страниц ревью-файлов (статистика, цвета, иконки, сообщения и т.п.), чтобы стили из `ui/review-styles.css` и общие стили корректно применялись ко всем вкладкам без дублирования правил, `ui/review-manager.js` мог безусловно вставлять хедер с вкладками и каркас системных сообщений, не "ломая" верстку отдельных страниц, было проще сопровождать и развивать новые review-страницы по единому контракту.

**Базовый шаблон DOM**: В `<head>` обязательно подключаются Bootstrap CSS, Font Awesome, единые стили обзора, общие стили приложения и иконок, единый менеджер ревью строго до любых других скриптов. В `<body>` нет собственных хедеров/футеров: глобальный review-хедер с вкладками и секция системных сообщений вставляются динамически менеджером поверх разметки страницы.

**Структура контента**: Единственный корневой контейнер `<div id="app" class="container-fluid">` обязателен для всех вкладок ревью и должен быть прямым потомком `<body>`. Внутри `#app` располагается только контент конкретной вкладки, без дублирования глобального хедера, футера и внешних контейнеров.

**Поведение менеджера**: При загрузке страницы менеджер находит `#app` и вставляет общий review-хедер с вкладками и секцию системных сообщений, далее оставляет нетронутым основной контент страницы внутри `#app`.

**Правила создания review-страниц**: Новые review-страницы обязаны иметь ровно один `#app` контейнер, не вставлять собственные хедеры/футеры вне `#app`, использовать внутри `#app` стандартные Bootstrap-карточки и сетку для единообразия стилей. Любые изменения в DOM-структуре должны проверяться на совместимость с менеджером и сохранение применимости общих стилей.

## Review-файлы документации UI

Review-файлы — автономные HTML-страницы для документации UI элементов проекта (иконки, цвета, сообщения, статистика). Используют единую систему управления через `ui/review-manager.js` и `ui/review-styles.css`. Каждый review-файл следует единому контракту DOM-структуры и использует общий менеджер для хедера с вкладками и системных сообщений.

---

## Связанные документы

Этот документ является частью системы документации проекта:
- **`.cursorrules`** — правила работы ИИ-агента с проектом
- **`docs/architect.md`** — архитектурный план проекта, принципы математической модели, технические ограничения
- **`docs/guide-ii.md`** (этот файл) — руководство по интерфейсу и взаимодействию

**ВАЖНО**: При изменении принципов UI/UX в этом документе необходимо проверить согласованность с другими документами проекта. См. раздел "Отслеживание согласованности архитектурных правил" в `docs/architect.md` и `.cursorrules`.

---

*Документ обновляется по мере развития проекта и изменения требований*

